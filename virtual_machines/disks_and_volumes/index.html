
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for KubeVirt">
      
      
      
        <link rel="canonical" href="https://kubevirt.io/user-guide/virtual_machines/disks_and_volumes/">
      
      
        <link rel="prev" href="../numa/">
      
      
        <link rel="next" href="../interfaces_and_networks/">
      
      <link rel="icon" href="../../assets/favicon32x32.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.8">
    
    
      
        <title>Disks and Volumes - KubeVirt user guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ded33207.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#disks-and-volumes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KubeVirt user guide" class="md-header__button md-logo" aria-label="KubeVirt user guide" data-md-component="logo">
      
  <img src="../../assets/KubeVirt_icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KubeVirt user guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Disks and Volumes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../architecture/" class="md-tabs__link">
      Architecture
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../quickstarts/" class="md-tabs__link">
      Quickstarts
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../operations/installation/" class="md-tabs__link">
        Operations
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../virtual_machine_instances/" class="md-tabs__link md-tabs__link--active">
        Virtual Machines
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../release_notes/" class="md-tabs__link">
      Release Notes
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../contributing/" class="md-tabs__link">
      Contributing
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KubeVirt user guide" class="md-nav__button md-logo" aria-label="KubeVirt user guide" data-md-component="logo">
      
  <img src="../../assets/KubeVirt_icon.png" alt="logo">

    </a>
    KubeVirt user guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../quickstarts/" class="md-nav__link">
        Quickstarts
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Operations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Operations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/updating_and_deletion/" class="md-nav__link">
        Updating and deletion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/basic_use/" class="md-nav__link">
        Basic use
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/customize_components/" class="md-nav__link">
        Customize components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/api_validation/" class="md-nav__link">
        API Validation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/debug/" class="md-nav__link">
        Debug
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/virtctl_client_tool/" class="md-nav__link">
        Download and Install the virtctl Command Line Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/live_migration/" class="md-nav__link">
        Live Migration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/hotplug_interfaces/" class="md-nav__link">
        Hotplug Network Interfaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/hotplug_volumes/" class="md-nav__link">
        Hotplug Volumes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/client_passthrough/" class="md-nav__link">
        Client Passthrough
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/snapshot_restore_api/" class="md-nav__link">
        Snapshot Restore API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/scheduler/" class="md-nav__link">
        KubeVirt Scheduler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/hugepages/" class="md-nav__link">
        Hugepages support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/component_monitoring/" class="md-nav__link">
        Component monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/authorization/" class="md-nav__link">
        Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/annotations_and_labels/" class="md-nav__link">
        Annotations and labels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/node_assignment/" class="md-nav__link">
        Node assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/node_maintenance/" class="md-nav__link">
        Node maintenance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/node_overcommit/" class="md-nav__link">
        Node overcommit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/unresponsive_nodes/" class="md-nav__link">
        Unresponsive nodes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/containerized_data_importer/" class="md-nav__link">
        Containerized Data Importer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/activating_feature_gates/" class="md-nav__link">
        Activating feature gates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/export_api/" class="md-nav__link">
        Export API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/clone_api/" class="md-nav__link">
        Clone API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/memory_dump/" class="md-nav__link">
        Virtual machine memory dump
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/mediated_devices_configuration/" class="md-nav__link">
        Mediated devices and virtual GPUs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/migration_policies/" class="md-nav__link">
        Migration Policies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/gitops/" class="md-nav__link">
        Managing KubeVirt with GitOps
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Virtual Machines
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Virtual Machines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../virtual_machine_instances/" class="md-nav__link">
        Virtual Machines Instances
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../creating_vms/" class="md-nav__link">
        Creating VirtualMachines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lifecycle/" class="md-nav__link">
        Lifecycle
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../run_strategies/" class="md-nav__link">
        Run Strategies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../instancetypes/" class="md-nav__link">
        Instance types and preferences
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../presets/" class="md-nav__link">
        Presets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../virtual_hardware/" class="md-nav__link">
        Virtual hardware
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dedicated_cpu_resources/" class="md-nav__link">
        Dedicated CPU resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../numa/" class="md-nav__link">
        NUMA
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Disks and Volumes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Disks and Volumes
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#disks" class="md-nav__link">
    Disks
  </a>
  
    <nav class="md-nav" aria-label="Disks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lun" class="md-nav__link">
    lun
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk" class="md-nav__link">
    disk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cdrom" class="md-nav__link">
    cdrom
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    Volumes
  </a>
  
    <nav class="md-nav" aria-label="Volumes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudinitnocloud" class="md-nav__link">
    cloudInitNoCloud
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudinitconfigdrive" class="md-nav__link">
    cloudInitConfigDrive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistentvolumeclaim" class="md-nav__link">
    persistentVolumeClaim
  </a>
  
    <nav class="md-nav" aria-label="persistentVolumeClaim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datavolume" class="md-nav__link">
    dataVolume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datavolume-vm-behavior" class="md-nav__link">
    DataVolume VM Behavior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datavolume-vmi-behavior" class="md-nav__link">
    DataVolume VMI Behavior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enabling-datavolume-support" class="md-nav__link">
    Enabling DataVolume support.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ephemeral" class="md-nav__link">
    ephemeral
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerdisk" class="md-nav__link">
    containerDisk
  </a>
  
    <nav class="md-nav" aria-label="containerDisk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-a-containerdisk" class="md-nav__link">
    When to use a containerDisk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-not-to-use-a-containerdisk" class="md-nav__link">
    When Not to use a containerDisk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerdisk-workflow-example" class="md-nav__link">
    containerDisk Workflow Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-disk-image-path" class="md-nav__link">
    Custom disk image path
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emptydisk" class="md-nav__link">
    emptyDisk
  </a>
  
    <nav class="md-nav" aria-label="emptyDisk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-an-emptydisk" class="md-nav__link">
    When to use an emptyDisk
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hostdisk" class="md-nav__link">
    hostDisk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configmap" class="md-nav__link">
    configMap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret" class="md-nav__link">
    secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serviceaccount" class="md-nav__link">
    serviceAccount
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downwardmetrics" class="md-nav__link">
    downwardMetrics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#high-performance-features" class="md-nav__link">
    High Performance Features
  </a>
  
    <nav class="md-nav" aria-label="High Performance Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iothreads" class="md-nav__link">
    IOThreads
  </a>
  
    <nav class="md-nav" aria-label="IOThreads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shared" class="md-nav__link">
    Shared
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto" class="md-nav__link">
    Auto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iothreads-with-dedicated-pinned-cpus" class="md-nav__link">
    IOThreads with Dedicated (pinned) CPUs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iothreads-with-qemu-emulator-thread-and-dedicated-pinned-cpus" class="md-nav__link">
    IOThreads with QEMU Emulator thread and Dedicated (pinned) CPUs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shared-iothreads" class="md-nav__link">
    Shared IOThreads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-iothreads" class="md-nav__link">
    Auto IOThreads
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtio-block-multi-queue" class="md-nav__link">
    Virtio Block Multi-Queue
  </a>
  
    <nav class="md-nav" aria-label="Virtio Block Multi-Queue">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-device-cache" class="md-nav__link">
    Disk device cache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-sharing" class="md-nav__link">
    Disk sharing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sharing-directories-with-vms" class="md-nav__link">
    Sharing Directories with VMs
  </a>
  
    <nav class="md-nav" aria-label="Sharing Directories with VMs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sharing-persistent-volume-claims" class="md-nav__link">
    Sharing Persistent Volume Claims
  </a>
  
    <nav class="md-nav" aria-label="Sharing Persistent Volume Claims">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-configuration" class="md-nav__link">
    Cluster Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-inside-the-vm" class="md-nav__link">
    Configuration Inside the VM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sharing-node-directories" class="md-nav__link">
    Sharing Node Directories
  </a>
  
    <nav class="md-nav" aria-label="Sharing Node Directories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-inside-the-node" class="md-nav__link">
    Configuration Inside the Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-configuration_1" class="md-nav__link">
    Cluster Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-inside-the-vm_1" class="md-nav__link">
    Configuration Inside the VM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../interfaces_and_networks/" class="md-nav__link">
        Interfaces and Networks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../istio_service_mesh/" class="md-nav__link">
        Istio service mesh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../networkpolicy/" class="md-nav__link">
        NetworkPolicy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../host-devices/" class="md-nav__link">
        Host Devices Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../windows_virtio_drivers/" class="md-nav__link">
        Windows virtio drivers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guest_operating_system_information/" class="md-nav__link">
        Guest Operating System Information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guest_agent_information/" class="md-nav__link">
        Guest Agent information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../liveness_and_readiness_probes/" class="md-nav__link">
        Liveness and Readiness Probes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../accessing_virtual_machines/" class="md-nav__link">
        Accessing Virtual Machines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../startup_scripts/" class="md-nav__link">
        Startup Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../service_objects/" class="md-nav__link">
        Service objects
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../templates/" class="md-nav__link">
        Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tekton_tasks/" class="md-nav__link">
        KubeVirt Tekton
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../replicaset/" class="md-nav__link">
        VirtualMachineInstanceReplicaSet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pool/" class="md-nav__link">
        VirtualMachinePool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dns/" class="md-nav__link">
        DNS records
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../boot_from_external_source/" class="md-nav__link">
        Booting From External Source
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../confidential_computing/" class="md-nav__link">
        Confidential computing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vsock/" class="md-nav__link">
        VSOCK
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../release_notes/" class="md-nav__link">
        Release Notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#disks" class="md-nav__link">
    Disks
  </a>
  
    <nav class="md-nav" aria-label="Disks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lun" class="md-nav__link">
    lun
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk" class="md-nav__link">
    disk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cdrom" class="md-nav__link">
    cdrom
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    Volumes
  </a>
  
    <nav class="md-nav" aria-label="Volumes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudinitnocloud" class="md-nav__link">
    cloudInitNoCloud
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudinitconfigdrive" class="md-nav__link">
    cloudInitConfigDrive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistentvolumeclaim" class="md-nav__link">
    persistentVolumeClaim
  </a>
  
    <nav class="md-nav" aria-label="persistentVolumeClaim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datavolume" class="md-nav__link">
    dataVolume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datavolume-vm-behavior" class="md-nav__link">
    DataVolume VM Behavior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datavolume-vmi-behavior" class="md-nav__link">
    DataVolume VMI Behavior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enabling-datavolume-support" class="md-nav__link">
    Enabling DataVolume support.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ephemeral" class="md-nav__link">
    ephemeral
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerdisk" class="md-nav__link">
    containerDisk
  </a>
  
    <nav class="md-nav" aria-label="containerDisk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-a-containerdisk" class="md-nav__link">
    When to use a containerDisk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-not-to-use-a-containerdisk" class="md-nav__link">
    When Not to use a containerDisk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerdisk-workflow-example" class="md-nav__link">
    containerDisk Workflow Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-disk-image-path" class="md-nav__link">
    Custom disk image path
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emptydisk" class="md-nav__link">
    emptyDisk
  </a>
  
    <nav class="md-nav" aria-label="emptyDisk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-an-emptydisk" class="md-nav__link">
    When to use an emptyDisk
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hostdisk" class="md-nav__link">
    hostDisk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configmap" class="md-nav__link">
    configMap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret" class="md-nav__link">
    secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serviceaccount" class="md-nav__link">
    serviceAccount
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downwardmetrics" class="md-nav__link">
    downwardMetrics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#high-performance-features" class="md-nav__link">
    High Performance Features
  </a>
  
    <nav class="md-nav" aria-label="High Performance Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iothreads" class="md-nav__link">
    IOThreads
  </a>
  
    <nav class="md-nav" aria-label="IOThreads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shared" class="md-nav__link">
    Shared
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto" class="md-nav__link">
    Auto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iothreads-with-dedicated-pinned-cpus" class="md-nav__link">
    IOThreads with Dedicated (pinned) CPUs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iothreads-with-qemu-emulator-thread-and-dedicated-pinned-cpus" class="md-nav__link">
    IOThreads with QEMU Emulator thread and Dedicated (pinned) CPUs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shared-iothreads" class="md-nav__link">
    Shared IOThreads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-iothreads" class="md-nav__link">
    Auto IOThreads
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtio-block-multi-queue" class="md-nav__link">
    Virtio Block Multi-Queue
  </a>
  
    <nav class="md-nav" aria-label="Virtio Block Multi-Queue">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-device-cache" class="md-nav__link">
    Disk device cache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-sharing" class="md-nav__link">
    Disk sharing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sharing-directories-with-vms" class="md-nav__link">
    Sharing Directories with VMs
  </a>
  
    <nav class="md-nav" aria-label="Sharing Directories with VMs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sharing-persistent-volume-claims" class="md-nav__link">
    Sharing Persistent Volume Claims
  </a>
  
    <nav class="md-nav" aria-label="Sharing Persistent Volume Claims">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-configuration" class="md-nav__link">
    Cluster Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-inside-the-vm" class="md-nav__link">
    Configuration Inside the VM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sharing-node-directories" class="md-nav__link">
    Sharing Node Directories
  </a>
  
    <nav class="md-nav" aria-label="Sharing Node Directories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-inside-the-node" class="md-nav__link">
    Configuration Inside the Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-configuration_1" class="md-nav__link">
    Cluster Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-inside-the-vm_1" class="md-nav__link">
    Configuration Inside the VM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/kubevirt/user-guide/edit/main/docs/virtual_machines/disks_and_volumes.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/kubevirt/user-guide/raw/main/docs/virtual_machines/disks_and_volumes.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="disks-and-volumes">Disks and Volumes<a class="headerlink" href="#disks-and-volumes" title="Permanent link">&para;</a></h1>
<p>Making persistent storage in the cluster (<strong>volumes</strong>) accessible to VMs consists of three parts. First, volumes are specified in <code>spec.volumes</code>. Second, disks are added to the VM by specifying them in <code>spec.domain.devices.disks</code>. Finally, a reference to the specified volume is added to the disk specification by name.</p>
<h2 id="disks">Disks<a class="headerlink" href="#disks" title="Permanent link">&para;</a></h2>
<p>Like all other vmi devices a <code>spec.domain.devices.disks</code> element has a
mandatory <code>name</code>, and furthermore, the disk's <code>name</code> must reference the
<code>name</code> of a volume inside <code>spec.volumes</code>.</p>
<p>A disk can be made accessible via four different types:</p>
<ul>
<li>
<p><a href="#lun"><strong>lun</strong></a></p>
</li>
<li>
<p><a href="#disk"><strong>disk</strong></a></p>
</li>
<li>
<p><a href="#cdrom"><strong>cdrom</strong></a></p>
</li>
</ul>
<p>All possible configuration options are available in the <a href="https://kubevirt.github.io/api-reference/master/definitions.html#_v1_disk">Disk API
Reference</a>.</p>
<p>All types allow you to specify the <code>bus</code> attribute. The <code>bus</code> attribute
determines how the disk will be presented to the guest operating system.</p>
<h3 id="lun">lun<a class="headerlink" href="#lun" title="Permanent link">&para;</a></h3>
<p>A <code>lun</code> disk will expose the volume as a LUN device to the VM. This
allows the VM to execute arbitrary iSCSI command passthrough.</p>
<p>A minimal example which attaches a <code>PersistentVolumeClaim</code> named <code>mypvc</code>
as a <code>lun</code> device to the VM:</p>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-lun
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mypvcdisk
        # This makes it a lun device
        lun: {}
  volumes:
    - name: mypvcdisk
      persistentVolumeClaim:
        claimName: mypvc
</code></pre></div>
<h3 id="disk">disk<a class="headerlink" href="#disk" title="Permanent link">&para;</a></h3>
<p>A <code>disk</code> disk will expose the volume as an ordinary disk to the VM.</p>
<p>A minimal example which attaches a <code>PersistentVolumeClaim</code> named <code>mypvc</code>
as a <code>disk</code> device to the VM:</p>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-disk
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mypvcdisk
        # This makes it a disk
        disk: {}
  volumes:
    - name: mypvcdisk
      persistentVolumeClaim:
        claimName: mypvc
</code></pre></div>
<p>You can set the disk <code>bus</code> type, overriding the defaults, which in turn
depends on the chipset the VM is configured to use:</p>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-disk
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mypvcdisk
        # This makes it a disk
        disk:
          # This makes it exposed as /dev/vda, being the only and thus first
          # disk attached to the VM
          bus: virtio
  volumes:
    - name: mypvcdisk
      persistentVolumeClaim:
        claimName: mypvc
</code></pre></div>
<h3 id="cdrom">cdrom<a class="headerlink" href="#cdrom" title="Permanent link">&para;</a></h3>
<p>A <code>cdrom</code> disk will expose the volume as a cdrom drive to the VM. It is
read-only by default.</p>
<p>A minimal example which attaches a <code>PersistentVolumeClaim</code> named <code>mypvc</code>
as a <code>cdrom</code> device to the VM:</p>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-cdrom
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mypvcdisk
        # This makes it a cdrom
        cdrom:
          # This makes the cdrom writeable
          readOnly: false
          # This makes the cdrom be exposed as SATA device
          bus: sata
  volumes:
    - name: mypvcdisk
      persistentVolumeClaim:
        claimName: mypvc
</code></pre></div>
<h2 id="volumes">Volumes<a class="headerlink" href="#volumes" title="Permanent link">&para;</a></h2>
<p>Supported volume sources are</p>
<ul>
<li>
<p><a href="#cloudinitnocloud"><strong>cloudInitNoCloud</strong></a></p>
</li>
<li>
<p><a href="#cloudinitconfigdrive"><strong>cloudInitConfigDrive</strong></a></p>
</li>
<li>
<p><a href="#persistentvolumeclaim"><strong>persistentVolumeClaim</strong></a></p>
</li>
<li>
<p><a href="#datavolume"><strong>dataVolume</strong></a></p>
</li>
<li>
<p><a href="#ephemeral"><strong>ephemeral</strong></a></p>
</li>
<li>
<p><a href="#containerdisk"><strong>containerDisk</strong></a></p>
</li>
<li>
<p><a href="#emptydisk"><strong>emptyDisk</strong></a></p>
</li>
<li>
<p><a href="#hostdisk"><strong>hostDisk</strong></a></p>
</li>
<li>
<p><a href="#configmap"><strong>configMap</strong></a></p>
</li>
<li>
<p><a href="#secret"><strong>secret</strong></a></p>
</li>
<li>
<p><a href="#serviceaccount"><strong>serviceAccount</strong></a></p>
</li>
<li>
<p><a href="#downwardmetrics"><strong>downwardMetrics</strong></a></p>
</li>
</ul>
<p>All possible configuration options are available in the <a href="https://kubevirt.github.io/api-reference/master/definitions.html#_v1_volume">Volume API
Reference</a>.</p>
<h3 id="cloudinitnocloud">cloudInitNoCloud<a class="headerlink" href="#cloudinitnocloud" title="Permanent link">&para;</a></h3>
<p>Allows attaching <code>cloudInitNoCloud</code> data-sources to the VM. If the VM
contains a proper cloud-init setup, it will pick up the disk as a
user-data source.</p>
<p>A simple example which attaches a <code>Secret</code> as a cloud-init <code>disk</code>
datasource may look like this:</p>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-cloudinitnocloud
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mybootdisk
        lun: {}
      - name: mynoclouddisk
        disk: {}
  volumes:
    - name: mybootdisk
      persistentVolumeClaim:
        claimName: mypvc
    - name: mynoclouddisk
      cloudInitNoCloud:
        secretRef:
          name: testsecret
</code></pre></div>
<h3 id="cloudinitconfigdrive">cloudInitConfigDrive<a class="headerlink" href="#cloudinitconfigdrive" title="Permanent link">&para;</a></h3>
<p>Allows attaching <code>cloudInitConfigDrive</code> data-sources to the VM. If the
VM contains a proper cloud-init setup, it will pick up the disk as a
user-data source.</p>
<p>A simple example which attaches a <code>Secret</code> as a cloud-init <code>disk</code>
datasource may look like this:</p>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-cloudinitconfigdrive
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mybootdisk
        lun: {}
      - name: myconfigdrivedisk
        disk: {}
  volumes:
    - name: mybootdisk
      persistentVolumeClaim:
        claimName: mypvc
    - name: myconfigdrivedisk
      cloudInitConfigDrive:
        secretRef:
          name: testsecret
</code></pre></div>
<h3 id="persistentvolumeclaim">persistentVolumeClaim<a class="headerlink" href="#persistentvolumeclaim" title="Permanent link">&para;</a></h3>
<p>Allows connecting a <code>PersistentVolumeClaim</code> to a VM disk.</p>
<p>Use a PersistentVolumeClaim when the VirtualMachineInstance's disk needs
to persist after the VM terminates. This allows for the VM's data to
remain persistent between restarts.</p>
<p>A <code>PersistentVolume</code> can be in "filesystem" or "block" mode:</p>
<ul>
<li>
<p>Filesystem: For KubeVirt to be able to consume the disk present on a
    PersistentVolume's filesystem, the disk must be named <code>disk.img</code> and
    be placed in the root path of the filesystem. Currently the disk is
    also required to be in raw format. <strong>&gt; Important:</strong> The
    <code>disk.img</code> image file needs to be owned by the user-id <code>107</code> in
    order to avoid permission issues.</p>
<blockquote>
<p><strong>Note:</strong> If the <code>disk.img</code> image file has not been created manually
before starting a VM then it will be created automatically with the
<code>PersistentVolumeClaim</code> size. Since not every storage provisioner
provides volumes with the exact usable amount of space as requested (e.g.
due to filesystem overhead), KubeVirt tolerates up to 10% less available
space. This can be configured with the
<code>developerConfiguration.pvcTolerateLessSpaceUpToPercent</code> value in the
KubeVirt CR (<code>kubectl edit kubevirt kubevirt -n kubevirt</code>).</p>
</blockquote>
</li>
<li>
<p>Block: Use a block volume for consuming raw block devices. Note: you
    need to enable the <code>BlockVolume</code>
    <a href="../../operations/activating_feature_gates/#how-to-activate-a-feature-gate">feature gate</a>.</p>
</li>
</ul>
<p>A simple example which attaches a <code>PersistentVolumeClaim</code> as a <code>disk</code>
may look like this:</p>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-pvc
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mypvcdisk
        lun: {}
  volumes:
    - name: mypvcdisk
      persistentVolumeClaim:
        claimName: mypvc
</code></pre></div>
<h4 id="datavolume">dataVolume<a class="headerlink" href="#datavolume" title="Permanent link">&para;</a></h4>
<p>DataVolumes are a way to automate importing virtual machine disks onto
PVCs during the virtual machine's launch flow. Without using a
DataVolume, users have to prepare a PVC with a disk image before
assigning it to a VM or VMI manifest. With a DataVolume, both the PVC
creation and import is automated on behalf of the user.</p>
<h4 id="datavolume-vm-behavior">DataVolume VM Behavior<a class="headerlink" href="#datavolume-vm-behavior" title="Permanent link">&para;</a></h4>
<p>DataVolumes can be defined in the VM spec directly by adding the
DataVolumes to the <code>dataVolumeTemplates</code> list. Below is an example.</p>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachine
metadata:
  labels:
    kubevirt.io/vm: vm-alpine-datavolume
  name: vm-alpine-datavolume
spec:
  running: false
  template:
    metadata:
      labels:
        kubevirt.io/vm: vm-alpine-datavolume
    spec:
      domain:
        devices:
          disks:
          - disk:
              bus: virtio
            name: datavolumedisk1
        resources:
          requests:
            memory: 64M
      volumes:
      - dataVolume:
          name: alpine-dv
        name: datavolumedisk1
  dataVolumeTemplates:
  - metadata:
      name: alpine-dv
    spec:
      pvc:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 2Gi
      source:
        http:
          url: http://cdi-http-import-server.kubevirt/images/alpine.iso
</code></pre></div>
<p>You can see the DataVolume defined in the dataVolumeTemplates section
has two parts. The <strong>source</strong> and <strong>pvc</strong></p>
<p>The <strong>source</strong> part declares that there is a disk image living on an
http server that we want to use as a volume for this VM. The <strong>pvc</strong>
part declares the spec that should be used to create the PVC that hosts
the <strong>source</strong> data.</p>
<p>When this VM manifest is posted to the cluster, as part of the launch
flow a PVC will be created using the spec provided and the source data
will be automatically imported into that PVC before the VM starts. When
the VM is deleted, the storage provisioned by the DataVolume will
automatically be deleted as well.</p>
<h4 id="datavolume-vmi-behavior">DataVolume VMI Behavior<a class="headerlink" href="#datavolume-vmi-behavior" title="Permanent link">&para;</a></h4>
<p>For a VMI object, DataVolumes can be referenced as a volume source for
the VMI. When this is done, it is expected that the referenced
DataVolume exists in the cluster. The VMI will consume the DataVolume,
but the DataVolume's life-cycle will not be tied to the VMI.</p>
<p>Below is an example of a DataVolume being referenced by a VMI. It is
expected that the DataVolume <em>alpine-datavolume</em> was created prior to
posting the VMI manifest to the cluster. It is okay to post the VMI
manifest to the cluster while the DataVolume is still having data
imported. KubeVirt knows not to start the VMI until all referenced
DataVolumes have finished their clone and import phases.</p>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-alpine-datavolume
  name: vmi-alpine-datavolume
spec:
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: disk1
    machine:
      type: &quot;&quot;
    resources:
      requests:
        memory: 64M
  terminationGracePeriodSeconds: 0
  volumes:
  - name: disk1
    dataVolume:
      name: alpine-datavolume
</code></pre></div>
<h4 id="enabling-datavolume-support">Enabling DataVolume support.<a class="headerlink" href="#enabling-datavolume-support" title="Permanent link">&para;</a></h4>
<p>A DataVolume is a custom resource provided by the Containerized Data
Importer (CDI) project. KubeVirt integrates with CDI in order to provide
users a workflow for dynamically creating PVCs and importing data into
those PVCs.</p>
<p>In order to take advantage of the DataVolume volume source on a VM or
VMI, CDI must be installed.</p>
<p><strong>Installing CDI</strong></p>
<p>Go to the <a href="https://github.com/kubevirt/containerized-data-importer/releases">CDI release
page</a></p>
<p>Pick the latest stable release and post the corresponding
cdi-controller-deployment.yaml manifest to your cluster.</p>
<h3 id="ephemeral">ephemeral<a class="headerlink" href="#ephemeral" title="Permanent link">&para;</a></h3>
<p>An ephemeral volume is a local COW (copy on write) image that uses a
network volume as a read-only backing store. With an ephemeral volume,
the network backing store is never mutated. Instead all writes are
stored on the ephemeral image which exists on local storage. KubeVirt
dynamically generates the ephemeral images associated with a VM when the
VM starts, and discards the ephemeral images when the VM stops.</p>
<p>Ephemeral volumes are useful in any scenario where disk persistence is
not desired. The COW image is discarded when VM reaches a final state
(e.g., succeeded, failed).</p>
<p>Currently, only <code>PersistentVolumeClaim</code> may be used as a backing store
of the ephemeral volume.</p>
<p>Up-to-date information on supported backing stores can be found in the
<a href="http://kubevirt.io/api-reference/master/definitions.html#_v1_ephemeralvolumesource">KubeVirt
API</a>.</p>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-ephemeral-pvc
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mypvcdisk
        lun: {}
  volumes:
    - name: mypvcdisk
      ephemeral:
        persistentVolumeClaim:
          claimName: mypvc
</code></pre></div>
<h3 id="containerdisk">containerDisk<a class="headerlink" href="#containerdisk" title="Permanent link">&para;</a></h3>
<p><strong>containerDisk was originally registryDisk, please update your code
when needed.</strong></p>
<p>The <code>containerDisk</code> feature provides the ability to store and distribute
VM disks in the container image registry. <code>containerDisks</code> can be
assigned to VMs in the disks section of the VirtualMachineInstance spec.</p>
<p>No network shared storage devices are utilized by <code>containerDisks</code>. The
disks are pulled from the container registry and reside on the local
node hosting the VMs that consume the disks.</p>
<h4 id="when-to-use-a-containerdisk">When to use a containerDisk<a class="headerlink" href="#when-to-use-a-containerdisk" title="Permanent link">&para;</a></h4>
<p><code>containerDisks</code> are ephemeral storage devices that can be assigned to
any number of active VirtualMachineInstances. This makes them an ideal
tool for users who want to replicate a large number of VM workloads that
do not require persistent data. <code>containerDisks</code> are commonly used in
conjunction with VirtualMachineInstanceReplicaSets.</p>
<h4 id="when-not-to-use-a-containerdisk">When Not to use a containerDisk<a class="headerlink" href="#when-not-to-use-a-containerdisk" title="Permanent link">&para;</a></h4>
<p><code>containerDisks</code> are not a good solution for any workload that requires
persistent root disks across VM restarts.</p>
<h4 id="containerdisk-workflow-example">containerDisk Workflow Example<a class="headerlink" href="#containerdisk-workflow-example" title="Permanent link">&para;</a></h4>
<p>Users can inject a VirtualMachineInstance disk into a container image in
a way that is consumable by the KubeVirt runtime. Disks must be placed
into the <code>/disk</code> directory inside the container. Raw and qcow2 formats
are supported. Qcow2 is recommended in order to reduce the container
image's size. <code>containerdisks</code> can and should be based on <code>scratch</code>. No
content except the image is required.</p>
<blockquote>
<p><strong>Note:</strong> Prior to kubevirt 0.20, the containerDisk image needed to
have <strong>kubevirt/container-disk-v1alpha</strong> as base image.</p>
<p><strong>Note:</strong> The containerDisk needs to be readable for the user with the UID
107 (qemu).</p>
</blockquote>
<p>Example: Inject a local VirtualMachineInstance disk into a container image.</p>
<div class="highlight"><pre><span></span><code>cat &lt;&lt; END &gt; Dockerfile
FROM scratch
ADD --chown=107:107 fedora25.qcow2 /disk/
END

docker build -t vmidisks/fedora25:latest .
</code></pre></div>
<p>Example: Inject a remote VirtualMachineInstance disk into a container image.</p>
<div class="highlight"><pre><span></span><code>cat &lt;&lt; END &gt; Dockerfile
FROM scratch
ADD --chown=107:107 https://cloud.centos.org/centos/7/images/CentOS-7-x86_64-GenericCloud.qcow2 /disk/
END
</code></pre></div>
<p>Example: Upload the ContainerDisk container image to a registry.</p>
<div class="highlight"><pre><span></span><code>docker push vmidisks/fedora25:latest
</code></pre></div>
<p>Example: Attach the ContainerDisk as an ephemeral disk to a VM.</p>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-containerdisk
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: containerdisk
        disk: {}
  volumes:
    - name: containerdisk
      containerDisk:
        image: vmidisks/fedora25:latest
</code></pre></div>
<p>Note that a <code>containerDisk</code> is file-based and therefore cannot be
attached as a <code>lun</code> device to the VM.</p>
<h4 id="custom-disk-image-path">Custom disk image path<a class="headerlink" href="#custom-disk-image-path" title="Permanent link">&para;</a></h4>
<p>ContainerDisk also allows to store disk images in any folder, when
required. The process is the same as previous. The main difference is,
that in custom location, kubevirt does not scan for any image. It is
your responsibility to provide full path for the disk image. Providing
image <code>path</code> is optional. When no <code>path</code> is provided, kubevirt searches
for disk images in default location: <code>/disk</code>.</p>
<p>Example: Build container disk image:</p>
<div class="highlight"><pre><span></span><code>cat &lt;&lt; END &gt; Dockerfile
FROM scratch
ADD fedora25.qcow2 /custom-disk-path/fedora25.qcow2
END

docker build -t vmidisks/fedora25:latest .
docker push vmidisks/fedora25:latest
</code></pre></div>
<p>Create VMI with container disk pointing to the custom location:</p>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-containerdisk
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: containerdisk
        disk: {}
  volumes:
    - name: containerdisk
      containerDisk:
        image: vmidisks/fedora25:latest
        path: /custom-disk-path/fedora25.qcow2
</code></pre></div>
<h3 id="emptydisk">emptyDisk<a class="headerlink" href="#emptydisk" title="Permanent link">&para;</a></h3>
<p>An <code>emptyDisk</code> works similar to an <code>emptyDir</code> in Kubernetes. An extra
sparse <code>qcow2</code> disk will be allocated and it will live as long as the
VM. Thus it will survive guest side VM reboots, but not a VM
re-creation. The disk <code>capacity</code> needs to be specified.</p>
<p>Example: Boot cirros with an extra <code>emptyDisk</code> with a size of <code>2GiB</code>:</p>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  name: testvmi-nocloud
spec:
  terminationGracePeriodSeconds: 5
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: containerdisk
        disk:
          bus: virtio
      - name: emptydisk
        disk:
          bus: virtio
  volumes:
    - name: containerdisk
      containerDisk:
        image: kubevirt/cirros-registry-disk-demo:latest
    - name: emptydisk
      emptyDisk:
        capacity: 2Gi
</code></pre></div>
<h4 id="when-to-use-an-emptydisk">When to use an emptyDisk<a class="headerlink" href="#when-to-use-an-emptydisk" title="Permanent link">&para;</a></h4>
<p>Ephemeral VMs very often come with read-only root images and limited
tmpfs space. In many cases this is not enough to install application
dependencies and provide enough disk space for the application data.
While this data is not critical and thus can be lost, it is still needed
for the application to function properly during its lifetime. This is
where an <code>emptyDisk</code> can be useful. An emptyDisk is often used and
mounted somewhere in <code>/var/lib</code> or <code>/var/run</code>.</p>
<h3 id="hostdisk">hostDisk<a class="headerlink" href="#hostdisk" title="Permanent link">&para;</a></h3>
<p>A <code>hostDisk</code> volume type provides the ability to create or use a disk
image located somewhere on a node. It works similar to a <code>hostPath</code> in
Kubernetes and provides two usage types:</p>
<ul>
<li>
<p><code>DiskOrCreate</code> if a disk image does not exist at a given location
    then create one</p>
</li>
<li>
<p><code>Disk</code> a disk image must exist at a given location</p>
</li>
</ul>
<p>Note: you need to enable the HostDisk feature gate.</p>
<p>Example: Create a 1Gi disk image located at /data/disk.img and attach it
to a VM.</p>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-host-disk
  name: vmi-host-disk
spec:
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: host-disk
    machine:
      type: &quot;&quot;
    resources:
      requests:
        memory: 64M
  terminationGracePeriodSeconds: 0
  volumes:
  - hostDisk:
      capacity: 1Gi
      path: /data/disk.img
      type: DiskOrCreate
    name: host-disk
status: {}
</code></pre></div>
<h3 id="configmap">configMap<a class="headerlink" href="#configmap" title="Permanent link">&para;</a></h3>
<p>A <code>configMap</code> is a reference to a
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">ConfigMap</a>
in Kubernetes. An extra <code>iso</code> disk will be allocated which has to be
mounted on a VM. To mount the <code>configMap</code> users can use <code>cloudInit</code> and
the disks serial number. The <code>name</code> needs to be set for a reference to
the created kubernetes <code>ConfigMap</code>.</p>
<blockquote>
<p><strong>Note:</strong> Currently, ConfigMap update is not propagate into the VMI. If
a ConfigMap is updated, only a pod will be aware of changes, not
running VMIs.</p>
<p><strong>Note:</strong> Due to a Kubernetes CRD
<a href="https://github.com/kubernetes/kubernetes/issues/68466">issue</a>, you
cannot control the paths within the volume where ConfigMap keys are
projected.</p>
</blockquote>
<p>Example: Attach the <code>configMap</code> to a VM and use <code>cloudInit</code> to mount the
<code>iso</code> disk:</p>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-fedora
  name: vmi-fedora
spec:
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: containerdisk
      - disk:
          bus: virtio
        name: cloudinitdisk
      - disk: {}
        name: app-config-disk
        # set serial
        serial: CVLY623300HK240D
    machine:
      type: &quot;&quot;
    resources:
      requests:
        memory: 1024M
  terminationGracePeriodSeconds: 0
  volumes:
  - name: containerdisk
    containerDisk:
      image: kubevirt/fedora-cloud-container-disk-demo:latest
  - cloudInitNoCloud:
      userData: |-
        #cloud-config
        password: fedora
        chpasswd: { expire: False }
        bootcmd:
          # mount the ConfigMap
          - &quot;mkdir /mnt/app-config&quot;
          - &quot;mount /dev/$(lsblk --nodeps -no name,serial | grep CVLY623300HK240D | cut -f1 -d&#39; &#39;) /mnt/app-config&quot;
    name: cloudinitdisk
  - configMap:
      name: app-config
    name: app-config-disk
status: {}
</code></pre></div>
<h3 id="secret">secret<a class="headerlink" href="#secret" title="Permanent link">&para;</a></h3>
<p>A <code>secret</code> is a reference to a
<a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> in
Kubernetes. An extra <code>iso</code> disk will be allocated which has to be
mounted on a VM. To mount the <code>secret</code> users can use <code>cloudInit</code> and the
disks serial number. The <code>secretName</code> needs to be set for a reference to
the created kubernetes <code>Secret</code>.</p>
<blockquote>
<p><strong>Note:</strong> Currently, Secret update propagation is not supported. If a
Secret is updated, only a pod will be aware of changes, not running
VMIs.</p>
<p><strong>Note:</strong> Due to a Kubernetes CRD
<a href="https://github.com/kubernetes/kubernetes/issues/68466">issue</a>, you
cannot control the paths within the volume where Secret keys are
projected.</p>
</blockquote>
<p>Example: Attach the <code>secret</code> to a VM and use <code>cloudInit</code> to mount the
<code>iso</code> disk:</p>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-fedora
  name: vmi-fedora
spec:
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: containerdisk
      - disk:
          bus: virtio
        name: cloudinitdisk
      - disk: {}
        name: app-secret-disk
        # set serial
        serial: D23YZ9W6WA5DJ487
    machine:
      type: &quot;&quot;
    resources:
      requests:
        memory: 1024M
  terminationGracePeriodSeconds: 0
  volumes:
  - name: containerdisk
    containerDisk:
      image: kubevirt/fedora-cloud-container-disk-demo:latest
  - cloudInitNoCloud:
      userData: |-
        #cloud-config
        password: fedora
        chpasswd: { expire: False }
        bootcmd:
          # mount the Secret
          - &quot;mkdir /mnt/app-secret&quot;
          - &quot;mount /dev/$(lsblk --nodeps -no name,serial | grep D23YZ9W6WA5DJ487 | cut -f1 -d&#39; &#39;) /mnt/app-secret&quot;
    name: cloudinitdisk
  - secret:
      secretName: app-secret
    name: app-secret-disk
status: {}
</code></pre></div>
<h3 id="serviceaccount">serviceAccount<a class="headerlink" href="#serviceaccount" title="Permanent link">&para;</a></h3>
<p>A <code>serviceAccount</code> volume references a Kubernetes
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/"><code>ServiceAccount</code></a>.
A new <code>iso</code> disk will be allocated with the content of the service
account (<code>namespace</code>, <code>token</code> and <code>ca.crt</code>), which needs to be mounted
in the VM. For automatic mounting, see the <code>configMap</code> and <code>secret</code>
examples above.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-fedora
  name: vmi-fedora
spec:
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: containerdisk
      - disk:
          bus: virtio
        name: serviceaccountdisk
    machine:
      type: &quot;&quot;
    resources:
      requests:
        memory: 1024M
  terminationGracePeriodSeconds: 0
  volumes:
  - name: containerdisk
    containerDisk:
      image: kubevirt/fedora-cloud-container-disk-demo:latest
  - name: serviceaccountdisk
    serviceAccount:
      serviceAccountName: default
</code></pre></div>
<h3 id="downwardmetrics">downwardMetrics<a class="headerlink" href="#downwardmetrics" title="Permanent link">&para;</a></h3>
<p>A <code>downwardMetrics</code> volume exposes a limited set of VM and host metrics to the
guest as a raw block volume. The format of the block volume is compatible with
<a href="https://github.com/vhostmd/vhostmd">vhostmd</a>.</p>
<p>Getting a limited set of host and VM metrics is in some cases required to allow
third-parties diagnosing performance issues on their appliances. One prominent
example is SAP HANA.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-fedora
  name: vmi-fedora
spec:
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: containerdisk
      - disk:
          bus: virtio
        name: metrics
    machine:
      type: &quot;&quot;
    resources:
      requests:
        memory: 1024M
  terminationGracePeriodSeconds: 0
  volumes:
  - name: containerdisk
    containerDisk:
      image: kubevirt/fedora-cloud-container-disk-demo:latest
  - name: metrics
    downwardMetrics: {}
</code></pre></div>
<p>The <code>vm-dump-metrics</code> tool can be used to read the metrics:</p>
<div class="highlight"><pre><span></span><code>$ dnf install -y vm-dump-metrics
$ vm-dump-metrics
&lt;metrics&gt;
  &lt;metric type=&quot;string&quot; context=&quot;host&quot;&gt;
    &lt;name&gt;HostName&lt;/name&gt;
    &lt;value&gt;node01&lt;/value&gt;
[...]
  &lt;metric type=&quot;int64&quot; context=&quot;host&quot; unit=&quot;s&quot;&gt;
    &lt;name&gt;Time&lt;/name&gt;
    &lt;value&gt;1619008605&lt;/value&gt;
  &lt;/metric&gt;
  &lt;metric type=&quot;string&quot; context=&quot;host&quot;&gt;
    &lt;name&gt;VirtualizationVendor&lt;/name&gt;
    &lt;value&gt;kubevirt.io&lt;/value&gt;
  &lt;/metric&gt;
&lt;/metrics&gt;
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> The <strong>DownwardMetrics</strong> feature gate
<a href="../../operations/activating_feature_gates/#how-to-activate-a-feature-gate">must be enabled</a>
to use this volume. Available starting with KubeVirt v0.42.0.</p>
</blockquote>
<h2 id="high-performance-features">High Performance Features<a class="headerlink" href="#high-performance-features" title="Permanent link">&para;</a></h2>
<h3 id="iothreads">IOThreads<a class="headerlink" href="#iothreads" title="Permanent link">&para;</a></h3>
<p>Libvirt has the ability to use IOThreads for dedicated disk access (for
supported devices). These are dedicated event loop threads that perform
block I/O requests and improve scalability on SMP systems. KubeVirt
exposes this libvirt feature through the <code>ioThreadsPolicy</code> setting.
Additionally, each <code>Disk</code> device exposes a <code>dedicatedIOThread</code> setting.
This is a boolean that indicates the specified disk should be allocated
an exclusive IOThread that will never be shared with other disks.</p>
<p>Currently valid policies are <code>shared</code> and <code>auto</code>. If <code>ioThreadsPolicy</code>
is omitted entirely, use of IOThreads will be disabled. However, if any
disk requests a dedicated IOThread, <code>ioThreadsPolicy</code> will be enabled
and default to <code>shared</code>.</p>
<h4 id="shared">Shared<a class="headerlink" href="#shared" title="Permanent link">&para;</a></h4>
<p>An <code>ioThreadsPolicy</code> of <code>shared</code> indicates that KubeVirt should use one
thread that will be shared by all disk devices. This policy stems from
the fact that large numbers of IOThreads is generally not useful as
additional context switching is incurred for each thread.</p>
<p>Disks with <code>dedicatedIOThread</code> set to <code>true</code> will not use the shared
thread, but will instead be allocated an exclusive thread. This is
generally useful if a specific Disk is expected to have heavy I/O
traffic, e.g. a database spindle.</p>
<h4 id="auto">Auto<a class="headerlink" href="#auto" title="Permanent link">&para;</a></h4>
<p><code>auto</code> IOThreads indicates that KubeVirt should use a pool of IOThreads
and allocate disks to IOThreads in a round-robin fashion. The pool size
is generally limited to twice the number of VCPU's allocated to the VM.
This essentially attempts to dedicate disks to separate IOThreads, but
only up to a reasonable limit. This would come in to play for systems
with a large number of disks and a smaller number of CPU's for instance.</p>
<p>As a caveat to the size of the IOThread pool, disks with
<code>dedicatedIOThread</code> will always be guaranteed their own thread. This
effectively diminishes the upper limit of the number of threads
allocated to the rest of the disks. For example, a VM with 2 CPUs would
normally use 4 IOThreads for all disks. However if one disk had
<code>dedicatedIOThread</code> set to true, then KubeVirt would only use 3
IOThreads for the shared pool.</p>
<p>There is always guaranteed to be at least one thread for disks that will
use the shared IOThreads pool. Thus if a sufficiently large number of
disks have dedicated IOThreads assigned, <code>auto</code> and <code>shared</code> policies
would essentially result in the same layout.</p>
<h4 id="iothreads-with-dedicated-pinned-cpus">IOThreads with Dedicated (pinned) CPUs<a class="headerlink" href="#iothreads-with-dedicated-pinned-cpus" title="Permanent link">&para;</a></h4>
<p>When guest's vCPUs are pinned to a host's physical CPUs, it is also best
to pin the IOThreads to specific CPUs to prevent these from floating
between the CPUs. KubeVirt will automatically calculate and pin each
IOThread to a CPU or a set of CPUs, depending on the ration between
them. In case there are more IOThreads than CPUs, each IOThread will be
pinned to a CPU, in a round-robin fashion. Otherwise, when there are
fewer IOThreads than CPU, each IOThread will be pinned to a set of CPUs.</p>
<h4 id="iothreads-with-qemu-emulator-thread-and-dedicated-pinned-cpus">IOThreads with QEMU Emulator thread and Dedicated (pinned) CPUs<a class="headerlink" href="#iothreads-with-qemu-emulator-thread-and-dedicated-pinned-cpus" title="Permanent link">&para;</a></h4>
<p>To further improve the vCPUs latency, KubeVirt can allocate an
additional dedicated physical CPU<sup><a href="../virtual_hardware/#cpu">1</a></sup>, exclusively for the emulator thread, to which it will
be pinned. This will effectively "isolate" the emulator thread from the vCPUs
of the VMI. When <code>ioThreadsPolicy</code> is set to <code>auto</code> IOThreads will also be
"isolated" from the vCPUs and placed on the same physical CPU as the QEMU
emulator thread.</p>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<h4 id="shared-iothreads">Shared IOThreads<a class="headerlink" href="#shared-iothreads" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-shared
  name: vmi-shared
spec:
  domain:
    ioThreadsPolicy: shared
    cpu:
      cores: 2
    devices:
      disks:
      - disk:
          bus: virtio
        name: vmi-shared_disk
      - disk:
          bus: virtio
        name: emptydisk
        dedicatedIOThread: true
      - disk:
          bus: virtio
        name: emptydisk2
        dedicatedIOThread: true
      - disk:
          bus: virtio
        name: emptydisk3
      - disk:
          bus: virtio
        name: emptydisk4
      - disk:
          bus: virtio
        name: emptydisk5
      - disk:
          bus: virtio
        name: emptydisk6
    machine:
      type: &quot;&quot;
    resources:
      requests:
        memory: 64M
  volumes:
  - name: vmi-shared_disk
    persistentVolumeClaim:
      claimName: vmi-shared_pvc
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk2
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk3
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk4
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk5
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk6
</code></pre></div>
<p>In this example, emptydisk and emptydisk2 both request a dedicated IOThread. vmi-shared_disk, and emptydisk 3 through 6 will all shared one IOThread.</p>
<div class="highlight"><pre><span></span><code>mypvc:        1
emptydisk:    2
emptydisk2:   3
emptydisk3:   1
emptydisk4:   1
emptydisk5:   1
emptydisk6:   1
</code></pre></div>
<h4 id="auto-iothreads">Auto IOThreads<a class="headerlink" href="#auto-iothreads" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-shared
  name: vmi-shared
spec:
  domain:
    ioThreadsPolicy: auto
    cpu:
      cores: 2
    devices:
      disks:
      - disk:
          bus: virtio
        name: mydisk
      - disk:
          bus: virtio
        name: emptydisk
        dedicatedIOThread: true
      - disk:
          bus: virtio
        name: emptydisk2
        dedicatedIOThread: true
      - disk:
          bus: virtio
        name: emptydisk3
      - disk:
          bus: virtio
        name: emptydisk4
      - disk:
          bus: virtio
        name: emptydisk5
      - disk:
          bus: virtio
        name: emptydisk6
    machine:
      type: &quot;&quot;
    resources:
      requests:
        memory: 64M
  volumes:
  - name: mydisk
    persistentVolumeClaim:
      claimName: mypvc
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk2
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk3
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk4
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk5
  - emptyDisk:
      capacity: 1Gi
    name: emptydisk6
</code></pre></div>
<p>This VM is identical to the first, except it requests auto IOThreads.
<code>emptydisk</code> and <code>emptydisk2</code> will still be allocated individual
IOThreads, but the rest of the disks will be split across 2 separate
iothreads (twice the number of CPU cores is 4).</p>
<p>Disks will be assigned to IOThreads like this:</p>
<div class="highlight"><pre><span></span><code>mypvc:        1
emptydisk:    3
emptydisk2:   4
emptydisk3:   2
emptydisk4:   1
emptydisk5:   2
emptydisk6:   1
</code></pre></div>
<h3 id="virtio-block-multi-queue">Virtio Block Multi-Queue<a class="headerlink" href="#virtio-block-multi-queue" title="Permanent link">&para;</a></h3>
<p>Block Multi-Queue is a framework for the Linux block layer that maps
Device I/O queries to multiple queues. This splits I/O processing up
across multiple threads, and therefor multiple CPUs. libvirt recommends
that the number of queues used should match the number of CPUs allocated
for optimal performance.</p>
<p>This feature is enabled by the <code>BlockMultiQueue</code> setting under
<code>Devices</code>:</p>
<div class="highlight"><pre><span></span><code>spec:
  domain:
    devices:
      blockMultiQueue: true
      disks:
      - disk:
          bus: virtio
        name: mydisk
</code></pre></div>
<p><strong>Note:</strong> Due to the way KubeVirt implements CPU allocation,
blockMultiQueue can only be used if a specific CPU allocation is
requested. If a specific number of CPUs hasn't been allocated to a
VirtualMachine, KubeVirt will use all CPU's on the node on a best effort
basis. In that case the amount of CPU allocation to a VM at the host
level could change over time. If blockMultiQueue were to request a
number of queues to match all the CPUs on a node, that could lead to
over-allocation scenarios. To avoid this, KubeVirt enforces that a
specific slice of CPU resources is requested in order to take advantage
of this feature.</p>
<h4 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>metadata:
  name: testvmi-disk
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
spec:
  domain:
    resources:
      requests:
        memory: 64M
        cpu: 4
    devices:
      blockMultiQueue: true
      disks:
      - name: mypvcdisk
        disk:
          bus: virtio
  volumes:
    - name: mypvcdisk
      persistentVolumeClaim:
        claimName: mypvc
</code></pre></div>
<p>This example will enable Block Multi-Queue for the disk <code>mypvcdisk</code> and
allocate 4 queues (to match the number of CPUs requested).</p>
<h3 id="disk-device-cache">Disk device cache<a class="headerlink" href="#disk-device-cache" title="Permanent link">&para;</a></h3>
<p>KubeVirt supports <code>none</code> and <code>writethrough</code> KVM/QEMU cache modes.</p>
<ul>
<li>
<p><code>none</code> I/O from the guest is not cached on the host. Use this option
    for guests with large I/O requirements. This option is generally the
    best choice.</p>
</li>
<li>
<p><code>writethrough</code> I/O from the guest is cached on the host but written
    through to the physical medium.</p>
</li>
</ul>
<blockquote>
<p><strong>Important:</strong> <code>none</code> cache mode is set as default if the file system
supports direct I/O, otherwise, <code>writethrough</code> is used.</p>
<p><strong>Note:</strong> It is possible to force a specific cache mode, although if
<code>none</code> mode has been chosen and the file system does not support
direct I/O then started VMI will return an error.</p>
</blockquote>
<p>Example: force <code>writethrough</code> cache mode</p>
<div class="highlight"><pre><span></span><code>apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-pvc
  name: vmi-pvc
spec:
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: pvcdisk
        cache: writethrough
    machine:
      type: &quot;&quot;
    resources:
      requests:
        memory: 64M
  terminationGracePeriodSeconds: 0
  volumes:
  - name: pvcdisk
    persistentVolumeClaim:
      claimName: disk-alpine
status: {}
</code></pre></div>
<h3 id="disk-sharing">Disk sharing<a class="headerlink" href="#disk-sharing" title="Permanent link">&para;</a></h3>
<p>Shareable disks allow multiple VMs to share the same underlying storage. In order to use this feature, special care is required because this could lead to data corruption and the loss of important data. Shareable disks demand either data synchronization at the application level or the use of clustered filesystems. These advanced configurations are not within the scope of this documentation and are use-case specific.</p>
<p>If the <code>shareable</code> option is set, it indicates to libvirt/QEMU that the disk is going to be accessed by multiple VMs and not to create a lock for the writes.</p>
<p>In this example, we use Rook Ceph in order to dynamically provisioning the PVC.
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block-pvc</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Block</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph-block</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pvc
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>NAME<span class="w">        </span>STATUS<span class="w">   </span>VOLUME<span class="w">                                     </span>CAPACITY<span class="w">   </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>STORAGECLASS<span class="w">      </span>AGE
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>block-pvc<span class="w">   </span>Bound<span class="w">    </span>pvc-0a161bb2-57c7-4d97-be96-0a20ff0222e2<span class="w">   </span>1Gi<span class="w">        </span>RWO<span class="w">            </span>rook-ceph-block<span class="w">   </span>51s
</code></pre></div>
Then, we can declare 2 VMs and set the <code>shareable</code> option to true for the shared disk.
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.io/v1</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachine</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="nt">kubevirt.io/vm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-block-1</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-block-1</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="nt">running</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">        </span><span class="nt">kubevirt.io/vm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-block-1</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">      </span><span class="nt">domain</span><span class="p">:</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">        </span><span class="nt">devices</span><span class="p">:</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">          </span><span class="nt">disks</span><span class="p">:</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">              </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">containerdisk</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">              </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudinitdisk</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">              </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="w">            </span><span class="nt">shareable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block-disk</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">        </span><span class="nt">machine</span><span class="p">:</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2G</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerDisk</span><span class="p">:</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry:5000/kubevirt/fedora-with-test-tooling-container-disk:devel</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">containerdisk</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cloudInitNoCloud</span><span class="p">:</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="w">          </span><span class="nt">userData</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="w">            </span><span class="no">#cloud-config</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="w">            </span><span class="no">password: fedora</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="w">            </span><span class="no">chpasswd: { expire: False }</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudinitdisk</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block-disk</span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block-pvc</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a><span class="nn">---</span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.io/v1</span>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachine</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a><span class="w">    </span><span class="nt">kubevirt.io/vm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-block-2</span>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-block-2</span>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a><span class="w">  </span><span class="nt">running</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a><span class="w">        </span><span class="nt">kubevirt.io/vm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-block-2</span>
<a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a><span class="w">      </span><span class="nt">affinity</span><span class="p">:</span>
<a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a><span class="w">        </span><span class="nt">podAffinity</span><span class="p">:</span>
<a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a><span class="w">          </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
<a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">labelSelector</span><span class="p">:</span>
<a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a><span class="w">              </span><span class="nt">matchExpressions</span><span class="p">:</span>
<a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.io/vm</span>
<a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a><span class="w">                </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a><span class="w">                </span><span class="nt">values</span><span class="p">:</span>
<a id="__codelineno-2-68" name="__codelineno-2-68" href="#__codelineno-2-68"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-block-1</span>
<a id="__codelineno-2-69" name="__codelineno-2-69" href="#__codelineno-2-69"></a><span class="w">            </span><span class="nt">topologyKey</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kubernetes.io/hostname&quot;</span>
<a id="__codelineno-2-70" name="__codelineno-2-70" href="#__codelineno-2-70"></a><span class="w">      </span><span class="nt">domain</span><span class="p">:</span>
<a id="__codelineno-2-71" name="__codelineno-2-71" href="#__codelineno-2-71"></a><span class="w">        </span><span class="nt">devices</span><span class="p">:</span>
<a id="__codelineno-2-72" name="__codelineno-2-72" href="#__codelineno-2-72"></a><span class="w">          </span><span class="nt">disks</span><span class="p">:</span>
<a id="__codelineno-2-73" name="__codelineno-2-73" href="#__codelineno-2-73"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-2-74" name="__codelineno-2-74" href="#__codelineno-2-74"></a><span class="w">              </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-2-75" name="__codelineno-2-75" href="#__codelineno-2-75"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">containerdisk</span>
<a id="__codelineno-2-76" name="__codelineno-2-76" href="#__codelineno-2-76"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-2-77" name="__codelineno-2-77" href="#__codelineno-2-77"></a><span class="w">              </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-2-78" name="__codelineno-2-78" href="#__codelineno-2-78"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudinitdisk</span>
<a id="__codelineno-2-79" name="__codelineno-2-79" href="#__codelineno-2-79"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-2-80" name="__codelineno-2-80" href="#__codelineno-2-80"></a><span class="w">              </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-2-81" name="__codelineno-2-81" href="#__codelineno-2-81"></a><span class="w">            </span><span class="nt">shareable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-2-82" name="__codelineno-2-82" href="#__codelineno-2-82"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block-disk</span>
<a id="__codelineno-2-83" name="__codelineno-2-83" href="#__codelineno-2-83"></a><span class="w">        </span><span class="nt">machine</span><span class="p">:</span>
<a id="__codelineno-2-84" name="__codelineno-2-84" href="#__codelineno-2-84"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<a id="__codelineno-2-85" name="__codelineno-2-85" href="#__codelineno-2-85"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-2-86" name="__codelineno-2-86" href="#__codelineno-2-86"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-2-87" name="__codelineno-2-87" href="#__codelineno-2-87"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2G</span>
<a id="__codelineno-2-88" name="__codelineno-2-88" href="#__codelineno-2-88"></a><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-2-89" name="__codelineno-2-89" href="#__codelineno-2-89"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-2-90" name="__codelineno-2-90" href="#__codelineno-2-90"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerDisk</span><span class="p">:</span>
<a id="__codelineno-2-91" name="__codelineno-2-91" href="#__codelineno-2-91"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry:5000/kubevirt/fedora-with-test-tooling-container-disk:devel</span>
<a id="__codelineno-2-92" name="__codelineno-2-92" href="#__codelineno-2-92"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">containerdisk</span>
<a id="__codelineno-2-93" name="__codelineno-2-93" href="#__codelineno-2-93"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cloudInitNoCloud</span><span class="p">:</span>
<a id="__codelineno-2-94" name="__codelineno-2-94" href="#__codelineno-2-94"></a><span class="w">          </span><span class="nt">userData</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-2-95" name="__codelineno-2-95" href="#__codelineno-2-95"></a><span class="w">            </span><span class="no">#cloud-config</span>
<a id="__codelineno-2-96" name="__codelineno-2-96" href="#__codelineno-2-96"></a><span class="w">            </span><span class="no">password: fedora</span>
<a id="__codelineno-2-97" name="__codelineno-2-97" href="#__codelineno-2-97"></a><span class="w">            </span><span class="no">chpasswd: { expire: False }</span>
<a id="__codelineno-2-98" name="__codelineno-2-98" href="#__codelineno-2-98"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudinitdisk</span>
<a id="__codelineno-2-99" name="__codelineno-2-99" href="#__codelineno-2-99"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block-disk</span>
<a id="__codelineno-2-100" name="__codelineno-2-100" href="#__codelineno-2-100"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<a id="__codelineno-2-101" name="__codelineno-2-101" href="#__codelineno-2-101"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block-pvc</span><span class="w">                                        </span>
</code></pre></div>
We can now attempt to write a string from the first guest and then read the string from the second guest to test that the sharing is working.
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$<span class="w"> </span>virtctl<span class="w"> </span>console<span class="w"> </span>vm-block-1
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>$<span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;Test awesome shareable disks&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>dd<span class="w">  </span><span class="nv">of</span><span class="o">=</span>/dev/vdc<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">150</span><span class="w"> </span><span class="nv">conv</span><span class="o">=</span>notrunc
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="m">28</span>+0<span class="w"> </span>records<span class="w"> </span><span class="k">in</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="m">28</span>+0<span class="w"> </span>records<span class="w"> </span>out
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="m">28</span><span class="w"> </span>bytes<span class="w"> </span>copied,<span class="w"> </span><span class="m">0</span>.0264182<span class="w"> </span>s,<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>kB/s
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="c1"># Log into the second guest</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>$<span class="w"> </span>virtctl<span class="w"> </span>console<span class="w"> </span>vm-block-2
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>$<span class="w"> </span>sudo<span class="w"> </span>dd<span class="w">  </span><span class="k">if</span><span class="o">=</span>/dev/vdc<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">150</span><span class="w"> </span><span class="nv">conv</span><span class="o">=</span>notrunc
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>Test<span class="w"> </span>awesome<span class="w"> </span>shareable<span class="w"> </span>disks150+0<span class="w"> </span>records<span class="w"> </span><span class="k">in</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="m">150</span>+0<span class="w"> </span>records<span class="w"> </span>out
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="m">150</span><span class="w"> </span>bytes<span class="w"> </span>copied,<span class="w"> </span><span class="m">0</span>.136753<span class="w"> </span>s,<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>kB/s
</code></pre></div></p>
<p>If you are using local devices or RWO PVCs, setting the affinity on the VMs that share the storage guarantees they will be scheduled on the same node. In the example, we set the affinity on the second VM using the label used on the first VM. If you are using shared storage with RWX PVCs, then the affinity rule is not necessary as the storage can be attached simultaneously on multiple nodes.</p>
<h2 id="sharing-directories-with-vms">Sharing Directories with VMs<a class="headerlink" href="#sharing-directories-with-vms" title="Permanent link">&para;</a></h2>
<p><code>Virtiofs</code> allows to make visible external filesystems to <code>KubeVirt</code> VMs.
<code>Virtiofs</code> is a shared file system that lets VMs access a directory tree on the host.
Further details can be found at <a href="https://virtio-fs.gitlab.io/">Official Virtiofs Site</a>.</p>
<blockquote>
<p><strong>Note:</strong> The <strong>ExperimentalVirtiofsSupport</strong> feature gate
<a href="../../operations/activating_feature_gates/#how-to-activate-a-feature-gate">must be enabled</a>
to share directories with VMs. This feature is available starting with KubeVirt v0.36.0.</p>
</blockquote>
<h3 id="sharing-persistent-volume-claims">Sharing Persistent Volume Claims<a class="headerlink" href="#sharing-persistent-volume-claims" title="Permanent link">&para;</a></h3>
<h4 id="cluster-configuration">Cluster Configuration<a class="headerlink" href="#cluster-configuration" title="Permanent link">&para;</a></h4>
<p>We need to create a new VM definition including the <code>spec.devices.disk.filesystems.virtiofs</code> and a PVC.
Example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.io/v1</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachineInstance</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testvmi-fs</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="nt">domain</span><span class="p">:</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="nt">devices</span><span class="p">:</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">      </span><span class="nt">disks</span><span class="p">:</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">            </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">containerdisk</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">            </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudinitdisk</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">      </span><span class="nt">filesystems</span><span class="p">:</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtiofs-disk</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">          </span><span class="nt">virtiofs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">      </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024Mi</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">containerdisk</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">      </span><span class="nt">containerDisk</span><span class="p">:</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/containerdisks/fedora:latest</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cloudInitNoCloud</span><span class="p">:</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">        </span><span class="nt">userData</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">          </span><span class="no">#cloud-config</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">          </span><span class="no">password: fedora</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">          </span><span class="no">chpasswd: { expire: False }</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudinitdisk</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtiofs-disk</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">      </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">        </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypvc</span>
</code></pre></div>
<h4 id="configuration-inside-the-vm">Configuration Inside the VM<a class="headerlink" href="#configuration-inside-the-vm" title="Permanent link">&para;</a></h4>
<p>The following configuration can be done in using startup script. See <a href="#cloudinitnocloud">cloudInitNoCloud</a> section for 
more details. 
However, we can do it manually by logging in to the VM and mounting it. 
Here are examples of how to mount it in a linux and windows VMs:</p>
<ul>
<li>Linux Example</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/disks/virtio
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>$<span class="w"> </span>sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>virtiofs<span class="w"> </span>virtiofs-disk<span class="w"> </span>/mnt/disks/virtio
</code></pre></div>
<ul>
<li>Windows Example</li>
</ul>
<p>See <a href="https://virtio-fs.gitlab.io/howto-windows.html">this</a> guide for details on startup steps needed for Windows VMs.</p>
<h3 id="sharing-node-directories">Sharing Node Directories<a class="headerlink" href="#sharing-node-directories" title="Permanent link">&para;</a></h3>
<p>It is allowed using <a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath">hostpaths</a>.
The following configuration example is shown for illustrative purposes.
However, the <a href="#sharing-persistent-volume-claims">PVCs</a> method is preferred since using hostpath is generally discouraged for
security reasons.</p>
<h4 id="configuration-inside-the-node">Configuration Inside the Node<a class="headerlink" href="#configuration-inside-the-node" title="Permanent link">&para;</a></h4>
<p>To share the directory with the VMs, we need to log in to the node, create the shared directory (if it does not already
exist), and set the proper SELinux context label <code>container_file_t</code> to the shared directory.
In this example we are going to share a new directory <code>/mnt/data</code> (if the desired directory is an existing one, you can
skip the <code>mkdir</code> command):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>$<span class="w"> </span>mkdir<span class="w"> </span>/tmp/data
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>$<span class="w"> </span>sudo<span class="w"> </span>chcon<span class="w"> </span>-t<span class="w"> </span>container_file_t<span class="w"> </span>/tmp/data
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> If you are attempting to share an existing directory, you must first check the SELinux context label with the
command <code>ls -Z &lt;directory&gt;</code>. In the case that the label is not present or is not <code>container_file_t</code> you need to label 
it with the <code>chcon</code>  command.</p>
</blockquote>
<h4 id="cluster-configuration_1">Cluster Configuration<a class="headerlink" href="#cluster-configuration_1" title="Permanent link">&para;</a></h4>
<p>We need a <code>StorageClass</code> which uses the provider <code>no-provisioner</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">   </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no-provisioner-storage-class</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="nt">provisioner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/no-provisioner</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="nt">reclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Delete</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="nt">volumeBindingMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WaitForFirstConsumer</span>
</code></pre></div>
<p>To make the shared directory available for VMs, we need to create a PV and a PVC that could be consumed by the VMs:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostpath</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/tmp/data&quot;</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no-provisioner-storage-class&quot;</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">  </span><span class="nt">nodeAffinity</span><span class="p">:</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="nt">required</span><span class="p">:</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">      </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchExpressions</span><span class="p">:</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/hostname</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">          </span><span class="nt">values</span><span class="p">:</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node01</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="nn">---</span><span class="w">  </span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostpath-claim</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no-provisioner-storage-class&quot;</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> Change the <code>node01</code> value for the node name where you want the shared directory will be located.</p>
</blockquote>
<p>The VM definitions have to request the PVC <code>hostpath-claim</code> and attach it as a virtiofs filesystem:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.io/v1</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachine</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="nt">kubevirt.io/vm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostpath-vm</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostpath</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">  </span><span class="nt">running</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">        </span><span class="nt">kubevirt.io/domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostpath</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">        </span><span class="nt">kubevirt.io/vm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostpath</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">      </span><span class="nt">domain</span><span class="p">:</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">          </span><span class="nt">cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">          </span><span class="nt">sockets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">          </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">        </span><span class="nt">devices</span><span class="p">:</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">          </span><span class="nt">filesystems</span><span class="p">:</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-hostpath</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">              </span><span class="nt">virtiofs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">          </span><span class="nt">disks</span><span class="p">:</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">containerdisk</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">              </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">                </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudinitdisk</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">              </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">                </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">          </span><span class="nt">interfaces</span><span class="p">:</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="w">              </span><span class="nt">masquerade</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="w">          </span><span class="nt">rng</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="w">          </span><span class="nt">pod</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">180</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerDisk</span><span class="p">:</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="w">            </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/containerdisks/fedora:latest</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">containerdisk</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cloudInitNoCloud</span><span class="p">:</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="w">            </span><span class="nt">userData</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="w">              </span><span class="no">#cloud-config</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="w">              </span><span class="no">chpasswd:</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="w">                </span><span class="no">expire: false</span>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a><span class="w">              </span><span class="no">password: password</span>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="w">              </span><span class="no">user: fedora</span>
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudinitdisk</span>
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-hostpath</span>
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostpath-claim</span>
</code></pre></div>
<h4 id="configuration-inside-the-vm_1">Configuration Inside the VM<a class="headerlink" href="#configuration-inside-the-vm_1" title="Permanent link">&para;</a></h4>
<p>We need to log in to the VM and mount the shared directory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>virtiofs<span class="w"> </span>vm-hostpath<span class="w"> </span>/mnt
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../numa/" class="md-footer__link md-footer__link--prev" aria-label="Previous: NUMA" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                NUMA
              </div>
            </div>
          </a>
        
        
          
          <a href="../interfaces_and_networks/" class="md-footer__link md-footer__link--next" aria-label="Next: Interfaces and Networks" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Interfaces and Networks
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.footer", "navigation.tabs", "navigation.tabs.sticky", "content.action.view", "content.action.edit"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51198bba.min.js"></script>
      
    
  </body>
</html>