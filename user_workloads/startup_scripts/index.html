
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for KubeVirt">
      
      
      
        <link rel="canonical" href="https://kubevirt.io/user-guide/user_workloads/startup_scripts/">
      
      
        <link rel="prev" href="../boot_from_external_source/">
      
      
        <link rel="next" href="../windows_virtio_drivers/">
      
      
      <link rel="icon" href="../../assets/favicon32x32.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Startup Scripts - KubeVirt user guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#startup-scripts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KubeVirt user guide" class="md-header__button md-logo" aria-label="KubeVirt user guide" data-md-component="logo">
      
  <img src="../../assets/KubeVirt_icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KubeVirt user guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Startup Scripts
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../architecture/" class="md-tabs__link">
        
  
  
    
  
  Architecture

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../quickstarts/" class="md-tabs__link">
        
  
  
    
  
  Quickstarts

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../cluster_admin/installation/" class="md-tabs__link">
          
  
  
  Cluster Administration

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../lifecycle/" class="md-tabs__link">
          
  
  
  User Workloads

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../compute/client_passthrough/" class="md-tabs__link">
          
  
  
  Compute

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../network/dns/" class="md-tabs__link">
          
  
  
  Network

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../storage/clone_api/" class="md-tabs__link">
          
  
  
  Storage

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../release_notes/" class="md-tabs__link">
        
  
  
    
  
  Release Notes

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../debug_virt_stack/debug/" class="md-tabs__link">
          
  
  
  Virtualization Debugging

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KubeVirt user guide" class="md-nav__button md-logo" aria-label="KubeVirt user guide" data-md-component="logo">
      
  <img src="../../assets/KubeVirt_icon.png" alt="logo">

    </a>
    KubeVirt user guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstarts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstarts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cluster Administration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cluster Administration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/updating_and_deletion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Updating and deletion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/activating_feature_gates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Activating feature gates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/annotations_and_labels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Annotations and labels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/api_validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/authorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/confidential_computing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Confidential computing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/customize_components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Customize components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/gitops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Managing KubeVirt with GitOps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/ksm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KSM Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/migration_policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migration Policies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/node_maintenance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node maintenance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/scheduler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KubeVirt Scheduler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/tekton_tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KubeVirt Tekton
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/unresponsive_nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unresponsive nodes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_16" >
        
          
          <label class="md-nav__link" for="__nav_4_16" id="__nav_4_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ARM cluster
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_16">
            <span class="md-nav__icon md-icon"></span>
            ARM cluster
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/device_status_on_Arm64/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Device Status on Arm64
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/feature_gate_status_on_Arm64/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Gate Status on Arm64
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/operations_on_Arm64/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arm64 Operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_admin/virtual_machines_on_Arm64/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Virtual Machines on Arm64
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    User Workloads
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            User Workloads
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lifecycle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic_use/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic use
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../creating_vms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating VirtualMachines by using virtctl
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../creating_it_pref/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating Instance Types and Preferences by using virtctl
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../virtctl_client_tool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download and Install the virtctl Command Line Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../accessing_virtual_machines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Accessing Virtual Machines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../boot_from_external_source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Booting From External Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Startup Scripts
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Startup Scripts
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cloud-init" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ignition" class="md-nav__link">
    <span class="md-ellipsis">
      Ignition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sysprep" class="md-nav__link">
    <span class="md-ellipsis">
      Sysprep
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-init-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cloud-init Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-data" class="md-nav__link">
    <span class="md-ellipsis">
      User Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-sources" class="md-nav__link">
    <span class="md-ellipsis">
      Data Sources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-user-data-as-clear-text" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init user-data as clear text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-user-data-as-base64-string" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init user-data as base64 string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-userdata-as-k8s-secret" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init UserData as k8s Secret
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#injecting-ssh-keys-with-cloud-inits-cloud-config" class="md-nav__link">
    <span class="md-ellipsis">
      Injecting SSH keys with Cloud-init's Cloud-config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-ssh-key-using-a-custom-shell-script" class="md-nav__link">
    <span class="md-ellipsis">
      Inject SSH key using a Custom Shell Script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-config" class="md-nav__link">
    <span class="md-ellipsis">
      Network Config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloud-init-network-config-as-clear-text" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init network-config as clear text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-network-config-as-base64-string" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init network-config as base64 string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-network-config-as-k8s-secret" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init network-config as k8s Secret
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-role-tagging" class="md-nav__link">
    <span class="md-ellipsis">
      Device Role Tagging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ignition-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Ignition Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ignition Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ignition-as-clear-text" class="md-nav__link">
    <span class="md-ellipsis">
      Ignition as clear text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ignition-as-base64" class="md-nav__link">
    <span class="md-ellipsis">
      Ignition as base64
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ignition-as-k8s-secret" class="md-nav__link">
    <span class="md-ellipsis">
      Ignition as k8s Secret
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sysprep-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Sysprep Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sysprep Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sysprep-in-a-configmap" class="md-nav__link">
    <span class="md-ellipsis">
      Sysprep in a ConfigMap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sysprep-in-a-secret" class="md-nav__link">
    <span class="md-ellipsis">
      Sysprep in a Secret
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#base-sysprep-vm" class="md-nav__link">
    <span class="md-ellipsis">
      Base Sysprep VM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launching-a-vm-from-template" class="md-nav__link">
    <span class="md-ellipsis">
      Launching a VM from template
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../windows_virtio_drivers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows virtio drivers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legacy_windows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running legacy Windows versions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_11" >
        
          
          <label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_11">
            <span class="md-nav__icon md-icon"></span>
            Monitoring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../component_monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Component monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guest_agent_information/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guest Agent information
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guest_operating_system_information/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guest Operating System Information
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../liveness_and_readiness_probes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Liveness and Readiness Probes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_12" >
        
          
          <label class="md-nav__link" for="__nav_5_12" id="__nav_5_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Workloads
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_12">
            <span class="md-nav__icon md-icon"></span>
            Workloads
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../instancetypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Instance types and preferences
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deploy_common_instancetypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploy common-instancetypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hook-sidecar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hook Sidecar Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../presets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Presets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VirtualMachinePool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../replicaset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VirtualMachineInstanceReplicaSet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../virtual_machine_instances/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Virtual Machines Instances
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vm_rollout_strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VM Rollout Strategies
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Compute
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Compute
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/client_passthrough/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Client Passthrough
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/cpu_hotplug/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CPU Hotplug
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/dedicated_cpu_resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dedicated CPU resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/host-devices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Host Devices Assignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/hugepages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hugepages support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/live_migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Live Migration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/mediated_devices_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mediated devices and virtual GPUs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/memory_hotplug/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memory Hotplug
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/node_assignment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node assignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/node_overcommit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node overcommit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/numa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NUMA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/persistent_tpm_and_uefi_state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Persistent TPM and UEFI state
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/resources_requests_and_limits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Resources requests and limits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/run_strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Run Strategies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/virtual_hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Virtual hardware
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/memory_dump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Virtual machine memory dump
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/vsock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VSOCK
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Network
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Network
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/dns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DNS records
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/hotplug_interfaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hotplug Network Interfaces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/interfaces_and_networks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interfaces and Networks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/istio_service_mesh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Istio service mesh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/network_binding_plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Binding Plugins
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/networkpolicy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NetworkPolicy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/service_objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service objects
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/clone_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clone API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/containerized_data_importer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Containerized Data Importer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/disks_and_volumes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Filesystems, Disks and Volumes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/export_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Export API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/guestfs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage of libguestfs-tools and virtctl guestfs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/hotplug_volumes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hotplug Volumes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/snapshot_restore_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Snapshot Restore API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/volume_migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Update volume strategy and volume migration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release_notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Virtualization Debugging
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Virtualization Debugging
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/debug/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debug
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control libvirt logging for each component
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/privileged-node-debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Privileged debugging on the node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/virsh-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Execute virsh commands in virt-launcher pod
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/launch-qemu-strace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Launch QEMU with strace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/launch-qemu-gdb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Launch QEMU with gdb and connect locally with gdb client
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cloud-init" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ignition" class="md-nav__link">
    <span class="md-ellipsis">
      Ignition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sysprep" class="md-nav__link">
    <span class="md-ellipsis">
      Sysprep
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-init-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cloud-init Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-data" class="md-nav__link">
    <span class="md-ellipsis">
      User Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-sources" class="md-nav__link">
    <span class="md-ellipsis">
      Data Sources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-user-data-as-clear-text" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init user-data as clear text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-user-data-as-base64-string" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init user-data as base64 string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-userdata-as-k8s-secret" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init UserData as k8s Secret
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#injecting-ssh-keys-with-cloud-inits-cloud-config" class="md-nav__link">
    <span class="md-ellipsis">
      Injecting SSH keys with Cloud-init's Cloud-config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-ssh-key-using-a-custom-shell-script" class="md-nav__link">
    <span class="md-ellipsis">
      Inject SSH key using a Custom Shell Script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-config" class="md-nav__link">
    <span class="md-ellipsis">
      Network Config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloud-init-network-config-as-clear-text" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init network-config as clear text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-network-config-as-base64-string" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init network-config as base64 string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-network-config-as-k8s-secret" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud-init network-config as k8s Secret
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-role-tagging" class="md-nav__link">
    <span class="md-ellipsis">
      Device Role Tagging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ignition-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Ignition Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ignition Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ignition-as-clear-text" class="md-nav__link">
    <span class="md-ellipsis">
      Ignition as clear text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ignition-as-base64" class="md-nav__link">
    <span class="md-ellipsis">
      Ignition as base64
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ignition-as-k8s-secret" class="md-nav__link">
    <span class="md-ellipsis">
      Ignition as k8s Secret
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sysprep-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Sysprep Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sysprep Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sysprep-in-a-configmap" class="md-nav__link">
    <span class="md-ellipsis">
      Sysprep in a ConfigMap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sysprep-in-a-secret" class="md-nav__link">
    <span class="md-ellipsis">
      Sysprep in a Secret
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#base-sysprep-vm" class="md-nav__link">
    <span class="md-ellipsis">
      Base Sysprep VM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launching-a-vm-from-template" class="md-nav__link">
    <span class="md-ellipsis">
      Launching a VM from template
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/kubevirt/user-guide/edit/main/docs/user_workloads/startup_scripts.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/kubevirt/user-guide/raw/main/docs/user_workloads/startup_scripts.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="startup-scripts">Startup Scripts<a class="headerlink" href="#startup-scripts" title="Permanent link">&para;</a></h1>
<p>KubeVirt supports the ability to assign a startup script to a
VirtualMachineInstance instance which is executed automatically when the
VM initializes.</p>
<p>These scripts are commonly used to automate injection of users and SSH
keys into VMs in order to provide remote access to the machine. For
example, a startup script can be used to inject credentials into a VM
that allows an Ansible job running on a remote host to access and
provision the VM.</p>
<p>Startup scripts are not limited to any specific use case though. They
can be used to run any arbitrary script in a VM on boot.</p>
<h2 id="cloud-init">Cloud-init<a class="headerlink" href="#cloud-init" title="Permanent link">&para;</a></h2>
<p>cloud-init is a widely adopted project used for early initialization of
a VM. Used by cloud providers such as AWS and GCP, cloud-init has
established itself as the defacto method of providing startup scripts to
VMs.</p>
<p>Cloud-init documentation can be found here: <a href="https://cloudinit.readthedocs.io/en/latest/">Cloud-init
Documentation</a>.</p>
<p>KubeVirt supports cloud-init's <a href="https://cloudinit.readthedocs.io/en/latest/reference/datasources/nocloud.html">NoCloud</a> 
and <a href="https://cloudinit.readthedocs.io/en/latest/reference/datasources/configdrive.html">ConfigDrive</a> datasources
which involve injecting startup scripts into a VM instance through the
use of an ephemeral disk. VMs with the cloud-init package installed will
detect the ephemeral disk and execute custom userdata scripts at boot.</p>
<h2 id="ignition">Ignition<a class="headerlink" href="#ignition" title="Permanent link">&para;</a></h2>
<p>Ignition is an alternative to cloud-init which allows for configuring the
VM disk on first boot. You can find the Ignition documentation <a href="https://coreos.github.io/ignition/">here</a>. 
You can also find a comparison between cloud-init and Ignition <a href="https://www.flatcar.org/docs/latest/provisioning/ignition/#ignition-vs-coreos-cloudinit">here</a>.</p>
<p>Ignition can be used with Kubevirt by using the <code>cloudInitConfigDrive</code> volume.</p>
<h2 id="sysprep">Sysprep<a class="headerlink" href="#sysprep" title="Permanent link">&para;</a></h2>
<p>Sysprep is an automation tool for Windows that automates Windows
installation, setup, and custom software provisioning.</p>
<p>The general flow is:</p>
<ol>
<li>
<p>Seal the vm image with the Sysprep tool, for example by running:</p>
<div class="highlight"><pre><span></span><code>%WINDIR%\system32\sysprep\sysprep.exe /generalize /shutdown /oobe /mode:vm
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We need to make sure the base vm does not restart, which can be done by setting the vm run strategy as <code>RerunOnFailure</code>.</p>
<p>VM runStrategy:</p>
<div class="highlight"><pre><span></span><code>spec:
  runStrategy: RerunOnFailure
</code></pre></div>
</div>
<p>More information can be found here:</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/sysprep-process-overview">Sysprep Process Overview</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/sysprep--generalize--a-windows-installation">Sysprep (Generalize) a Windows installation</a></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is important that there is no answer file detected when the Sysprep Tool is triggered, because Windows Setup searches for answer files at the beginning of each configuration pass and caches it. If that happens, when the OS will start - it will just use the cached answer file, ignoring the one we provide through the Sysprep API. More information can be found <a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/windows-setup-automation-overview#implicit-answer-file-search-order">here</a>.</p>
</div>
</li>
<li>
<p>Providing an Answer file named <code>autounattend.xml</code> in an attached media. The answer file can be provided in a ConfigMap or a Secret with the key <code>autounattend.xml</code></p>
<p>The configuration file can be generated with <a href="https://docs.microsoft.com/en-us/windows-hardware/customize/desktop/wsim/windows-system-image-manager-overview-topics">Windows SIM</a> or it can be specified manually according to the information found here:</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/update-windows-settings-and-scripts-create-your-own-answer-file-sxs">Answer files (unattend.xml)</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows-hardware/customize/desktop/wsim/answer-files-overview">Answer File Reference</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows-hardware/customize/desktop/unattend/components-b-unattend">Answer File Components Reference</a></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are also many easy to find online tools available for creating an answer file.</p>
</div>
</li>
</ol>
<h2 id="cloud-init-examples">Cloud-init Examples<a class="headerlink" href="#cloud-init-examples" title="Permanent link">&para;</a></h2>
<h3 id="user-data">User Data<a class="headerlink" href="#user-data" title="Permanent link">&para;</a></h3>
<p>KubeVirt supports the cloud-init NoCloud and ConfigDrive data sources
which involve injecting startup scripts through the use of a disk
attached to the VM.</p>
<p>In order to assign a custom userdata script to a VirtualMachineInstance
using this method, users must define a disk and a volume for the NoCloud
or ConfigDrive datasource in the VirtualMachineInstance's spec.</p>
<h4 id="data-sources">Data Sources<a class="headerlink" href="#data-sources" title="Permanent link">&para;</a></h4>
<p>Under most circumstances users should stick to the NoCloud data source
as it is the simplest cloud-init data source. Only if NoCloud is not
supported by the cloud-init implementation (e.g.
<a href="https://github.com/coreos/coreos-cloudinit">coreos-cloudinit</a>) users
should switch the data source to ConfigDrive.</p>
<p>Switching the cloud-init data source to ConfigDrive is as easy as
changing the volume type in the VirtualMachineInstance's spec from
<code>cloudInitNoCloud</code> to <code>cloudInitConfigDrive</code>.</p>
<p>NoCloud data source:</p>
<div class="highlight"><pre><span></span><code>volumes:
  - name: cloudinitvolume
    cloudInitNoCloud:
      userData: &quot;#cloud-config&quot;
</code></pre></div>
<p>ConfigDrive data source:</p>
<div class="highlight"><pre><span></span><code>volumes:
  - name: cloudinitvolume
    cloudInitConfigDrive:
      userData: &quot;#cloud-config&quot;
</code></pre></div>
<p>When using the ConfigDrive datasource, the <code>networkData</code> part has to be in the
<a href="https://specs.openstack.org/openstack/nova-specs/specs/liberty/implemented/metadata-service-network-info.html">OpenStack Metadata Service Network</a> format:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>  spec:
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    domain:
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>      interfaces: 
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        - name: secondary-net
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>          bridge: {}
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>          macAddress: &#39;02:26:19:00:00:30&#39;
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>          model: virtio
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    networks: 
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        - multus:
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>            networkName: my-ns/my-net
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>          name: secondary-net
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    volumes:
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>      - name: cloudinitvolume
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        cloudInitConfigDrive:
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>          networkData: |
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>            {&quot;links&quot;:[{&quot;id&quot;:&quot;enp2s0&quot;,&quot;type&quot;:&quot;phy&quot;,&quot;ethernet_mac_address&quot;:&quot;02:26:19:00:00:30&quot;}],&quot;networks&quot;:[{&quot;id&quot;:&quot;NAD1&quot;,&quot;type&quot;:&quot;ipv4&quot;,&quot;link&quot;:&quot;enp2s0&quot;,&quot;ip_address&quot;:&quot;10.184.0.244&quot;,&quot;netmask&quot;:&quot;255.255.240.0&quot;,&quot;routes&quot;:[{&quot;network&quot;:&quot;0.0.0.0&quot;,&quot;netmask&quot;:&quot;0.0.0.0&quot;,&quot;gateway&quot;:&quot;23.253.157.1&quot;}],&quot;network_id&quot;:&quot;&quot;}],&quot;services&quot;:[]}
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>          userData: &quot;#cloud-config&quot;
</code></pre></div></p>
<blockquote>
<p><strong>Note</strong>
The MAC address of the secondary interface should be predefined and identical in 
the network interface and the cloud-init networkData. </p>
</blockquote>
<p>See the examples below for more complete cloud-init examples.</p>
<h4 id="cloud-init-user-data-as-clear-text">Cloud-init user-data as clear text<a class="headerlink" href="#cloud-init-user-data-as-clear-text" title="Permanent link">&para;</a></h4>
<p>In the example below, a SSH key is stored in the cloudInitNoCloud
Volume's userData field as clean text. There is a corresponding disks
entry that references the cloud-init volume and assigns it to the VM's
device.</p>
<div class="highlight"><pre><span></span><code># Create a VM manifest with the startup script
# a cloudInitNoCloud volume&#39;s userData field.

cat &lt;&lt; END &gt; my-vmi.yaml
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  name: myvmi
spec:
  terminationGracePeriodSeconds: 5
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: containerdisk
        disk:
          bus: virtio
      - name: cloudinitdisk
        disk:
          bus: virtio
  volumes:
    - name: containerdisk
      containerDisk:
        image: kubevirt/cirros-container-disk-demo:latest
    - name: cloudinitdisk
      cloudInitNoCloud:
        userData: |
          #cloud-config
          ssh_authorized_keys:
            - ssh-rsa AAAAB3NzaK8L93bWxnyp test@test.com

END

# Post the Virtual Machine spec to KubeVirt.

kubectl create -f my-vmi.yaml
</code></pre></div>
<h4 id="cloud-init-user-data-as-base64-string">Cloud-init user-data as base64 string<a class="headerlink" href="#cloud-init-user-data-as-base64-string" title="Permanent link">&para;</a></h4>
<p>In the example below, a simple bash script is base64 encoded and stored
in the cloudInitNoCloud Volume's userDataBase64 field. There is a
corresponding disks entry that references the cloud-init volume and
assigns it to the VM's device.</p>
<p><em>Users also have the option of storing the startup script in a
Kubernetes Secret and referencing the Secret in the VM's spec. Examples
further down in the document illustrate how that is done.</em></p>
<div class="highlight"><pre><span></span><code># Create a simple startup script

cat &lt;&lt; END &gt; startup-script.sh
#!/bin/bash
echo &quot;Hi from startup script!&quot;
END

# Create a VM manifest with the startup script base64 encoded into
# a cloudInitNoCloud volume&#39;s userDataBase64 field.

cat &lt;&lt; END &gt; my-vmi.yaml
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  name: myvmi
spec:
  terminationGracePeriodSeconds: 5
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: containerdisk
        disk:
          bus: virtio
      - name: cloudinitdisk
        disk:
          bus: virtio
  volumes:
    - name: containerdisk
      containerDisk:
        image: kubevirt/cirros-container-disk-demo:latest
    - name: cloudinitdisk
      cloudInitNoCloud:
        userDataBase64: $(cat startup-script.sh | base64 -w0)
END

# Post the Virtual Machine spec to KubeVirt.

kubectl create -f my-vmi.yaml
</code></pre></div>
<h4 id="cloud-init-userdata-as-k8s-secret">Cloud-init UserData as k8s Secret<a class="headerlink" href="#cloud-init-userdata-as-k8s-secret" title="Permanent link">&para;</a></h4>
<p>Users who wish to not store the cloud-init userdata directly in the
VirtualMachineInstance spec have the option to store the userdata into a
Kubernetes Secret and reference that Secret in the spec.</p>
<p>Multiple VirtualMachineInstance specs can reference the same Kubernetes
Secret containing cloud-init userdata.</p>
<p>Below is an example of how to create a Kubernetes Secret containing a
startup script and reference that Secret in the VM's spec.</p>
<div class="highlight"><pre><span></span><code># Create a simple startup script

cat &lt;&lt; END &gt; startup-script.sh
#!/bin/bash
echo &quot;Hi from startup script!&quot;
END

# Store the startup script in a Kubernetes Secret
kubectl create secret generic my-vmi-secret --from-file=userdata=startup-script.sh

# Create a VM manifest and reference the Secret&#39;s name in the cloudInitNoCloud
# Volume&#39;s secretRef field

cat &lt;&lt; END &gt; my-vmi.yaml
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  name: myvmi
spec:
  terminationGracePeriodSeconds: 5
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: containerdisk
        disk:
          bus: virtio
      - name: cloudinitdisk
        disk:
          bus: virtio
  volumes:
    - name: containerdisk
      containerDisk:
        image: kubevirt/cirros-registry-disk-demo:latest
    - name: cloudinitdisk
      cloudInitNoCloud:
        secretRef:
          name: my-vmi-secret
END

# Post the VM
kubectl create -f my-vmi.yaml
</code></pre></div>
<h4 id="injecting-ssh-keys-with-cloud-inits-cloud-config">Injecting SSH keys with Cloud-init's Cloud-config<a class="headerlink" href="#injecting-ssh-keys-with-cloud-inits-cloud-config" title="Permanent link">&para;</a></h4>
<p>In the examples so far, the cloud-init userdata script has been a bash
script. Cloud-init has it's own configuration that can handle some
common tasks such as user creation and SSH key injection.</p>
<p>More cloud-config examples can be found here: <a href="https://cloudinit.readthedocs.io/en/latest/topics/examples.html">Cloud-init
Examples</a></p>
<!-- markdown-link-check-disable -->
<p>Below is an example of using cloud-config to inject an SSH key for the
default user (fedora in this case) of a <a href="https://www.projectatomic.io/">Fedora Atomic</a> disk image.</p>
<!-- markdown-link-check-enable -->

<div class="highlight"><pre><span></span><code># Create the cloud-init cloud-config userdata.
cat &lt;&lt; END &gt; startup-script
#cloud-config
password: atomic
chpasswd: { expire: False }
ssh_pwauth: False
ssh_authorized_keys:
    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6zdgFiLr1uAK7PdcchDd+LseA5fEOcxCCt7TLlr7Mx6h8jUg+G+8L9JBNZuDzTZSF0dR7qwzdBBQjorAnZTmY3BhsKcFr8Gt4KMGrS6r3DNmGruP8GORvegdWZuXgASKVpXeI7nCIjRJwAaK1x+eGHwAWO9Z8ohcboHbLyffOoSZDSIuk2kRIc47+ENRjg0T6x2VRsqX27g6j4DfPKQZGk0zvXkZaYtr1e2tZgqTBWqZUloMJK8miQq6MktCKAS4VtPk0k7teQX57OGwD6D7uo4b+Cl8aYAAwhn0hc0C2USfbuVHgq88ESo2/+NwV4SQcl3sxCW21yGIjAGt4Hy7J fedora@localhost.localdomain
END

# Create the VM spec
cat &lt;&lt; END &gt; my-vmi.yaml
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  name: sshvmi
spec:
  terminationGracePeriodSeconds: 0
  domain:
    resources:
      requests:
        memory: 1024M
    devices:
      disks:
      - name: containerdisk
        disk:
          bus: virtio
      - name: cloudinitdisk
        disk:
          bus: virtio
  volumes:
    - name: containerdisk
      containerDisk:
        image: kubevirt/fedora-atomic-registry-disk-demo:latest
    - name: cloudinitdisk
      cloudInitNoCloud:
        userDataBase64: $(cat startup-script | base64 -w0)
END

# Post the VirtualMachineInstance spec to KubeVirt.
kubectl create -f my-vmi.yaml

# Connect to VM with passwordless SSH key
ssh -i &lt;insert private key here&gt; fedora@&lt;insert ip here&gt;
</code></pre></div>
<h4 id="inject-ssh-key-using-a-custom-shell-script">Inject SSH key using a Custom Shell Script<a class="headerlink" href="#inject-ssh-key-using-a-custom-shell-script" title="Permanent link">&para;</a></h4>
<p>Depending on the boot image in use, users may have a mixed experience
using cloud-init's cloud-config to create users and inject SSH keys.</p>
<p>Below is an example of creating a user and injecting SSH keys for that
user using a script instead of cloud-config.</p>
<div class="highlight"><pre><span></span><code>cat &lt;&lt; END &gt; startup-script.sh
#!/bin/bash
export NEW_USER=&quot;foo&quot;
export SSH_PUB_KEY=&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6zdgFiLr1uAK7PdcchDd+LseA5fEOcxCCt7TLlr7Mx6h8jUg+G+8L9JBNZuDzTZSF0dR7qwzdBBQjorAnZTmY3BhsKcFr8Gt4KMGrS6r3DNmGruP8GORvegdWZuXgASKVpXeI7nCIjRJwAaK1x+eGHwAWO9Z8ohcboHbLyffOoSZDSIuk2kRIc47+ENRjg0T6x2VRsqX27g6j4DfPKQZGk0zvXkZaYtr1e2tZgqTBWqZUloMJK8miQq6MktCKAS4VtPk0k7teQX57OGwD6D7uo4b+Cl8aYAAwhn0hc0C2USfbuVHgq88ESo2/+NwV4SQcl3sxCW21yGIjAGt4Hy7J $NEW_USER@localhost.localdomain&quot;

sudo adduser -U -m $NEW_USER
echo &quot;$NEW_USER:atomic&quot; | chpasswd
sudo mkdir /home/$NEW_USER/.ssh
sudo echo &quot;$SSH_PUB_KEY&quot; &gt; /home/$NEW_USER/.ssh/authorized_keys
sudo chown -R ${NEW_USER}: /home/$NEW_USER/.ssh
END

# Create the VM spec
cat &lt;&lt; END &gt; my-vmi.yaml
apiVersion: kubevirt.io/v1
kind: VirtualMachineInstance
metadata:
  name: sshvmi
spec:
  terminationGracePeriodSeconds: 0
  domain:
    resources:
      requests:
        memory: 1024M
    devices:
      disks:
      - name: containerdisk
        disk:
          bus: virtio
      - name: cloudinitdisk
        disk:
          bus: virtio
  volumes:
    - name: containerdisk
      containerDisk:
        image: kubevirt/fedora-atomic-registry-disk-demo:latest
    - name: cloudinitdisk
      cloudInitNoCloud:
        userDataBase64: $(cat startup-script.sh | base64 -w0)
END

# Post the VirtualMachineInstance spec to KubeVirt.
kubectl create -f my-vmi.yaml

# Connect to VM with passwordless SSH key
ssh -i &lt;insert private key here&gt; foo@&lt;insert ip here&gt;
</code></pre></div>
<h3 id="network-config">Network Config<a class="headerlink" href="#network-config" title="Permanent link">&para;</a></h3>
<p>A cloud-init <a href="https://cloudinit.readthedocs.io/en/latest/reference/network-config-format-v1.html">network version
1</a>
configuration can be set to configure the network at boot.</p>
<p>Cloud-init <a href="#user-data">user-data</a> <strong>must</strong> be set for cloud-init to
parse <em>network-config</em> even if it is just the user-data config header:</p>
<div class="highlight"><pre><span></span><code>#cloud-config
</code></pre></div>
<h4 id="cloud-init-network-config-as-clear-text">Cloud-init network-config as clear text<a class="headerlink" href="#cloud-init-network-config-as-clear-text" title="Permanent link">&para;</a></h4>
<p>In the example below, a simple cloud-init network-config is stored in
the cloudInitNoCloud Volume's networkData field as clean text. There is
a corresponding disks entry that references the cloud-init volume and
assigns it to the VM's device.</p>
<div class="highlight"><pre><span></span><code># Create a VM manifest with the network-config in
# a cloudInitNoCloud volume&#39;s networkData field.

cat &lt;&lt; END &gt; my-vmi.yaml
apiVersion: kubevirt.io/v1alpha2
kind: VirtualMachineInstance
metadata:
  name: myvmi
spec:
  terminationGracePeriodSeconds: 5
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: containerdisk
        volumeName: registryvolume
        disk:
          bus: virtio
      - name: cloudinitdisk
        volumeName: cloudinitvolume
        disk:
          bus: virtio
  volumes:
    - name: registryvolume
      containerDisk:
        image: kubevirt/cirros-container-disk-demo:latest
    - name: cloudinitvolume
      cloudInitNoCloud:
        userData: &quot;#cloud-config&quot;
        networkData: |
          network:
            version: 1
            config:
            - type: physical
            name: eth0
            subnets:
              - type: dhcp

END

# Post the Virtual Machine spec to KubeVirt.

kubectl create -f my-vmi.yaml
</code></pre></div>
<h4 id="cloud-init-network-config-as-base64-string">Cloud-init network-config as base64 string<a class="headerlink" href="#cloud-init-network-config-as-base64-string" title="Permanent link">&para;</a></h4>
<p>In the example below, a simple network-config is base64 encoded and
stored in the cloudInitNoCloud Volume's networkDataBase64 field. There
is a corresponding disks entry that references the cloud-init volume and
assigns it to the VM's device.</p>
<p><em>Users also have the option of storing the network-config in a
Kubernetes Secret and referencing the Secret in the VM's spec. Examples
further down in the document illustrate how that is done.</em></p>
<div class="highlight"><pre><span></span><code># Create a simple network-config

cat &lt;&lt; END &gt; network-config
network:
  version: 1
  config:
  - type: physical
  name: eth0
  subnets:
    - type: dhcp
END

# Create a VM manifest with the networkData base64 encoded into
# a cloudInitNoCloud volume&#39;s networkDataBase64 field.

cat &lt;&lt; END &gt; my-vmi.yaml
apiVersion: kubevirt.io/v1alpha2
kind: VirtualMachineInstance
metadata:
  name: myvmi
spec:
  terminationGracePeriodSeconds: 5
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: containerdisk
        volumeName: registryvolume
        disk:
          bus: virtio
      - name: cloudinitdisk
        volumeName: cloudinitvolume
        disk:
          bus: virtio
  volumes:
    - name: registryvolume
      containerDisk:
        image: kubevirt/cirros-container-disk-demo:latest
    - name: cloudinitvolume
      cloudInitNoCloud:
        userData: &quot;#cloud-config&quot;
        networkDataBase64: $(cat network-config | base64 -w0)
END

# Post the Virtual Machine spec to KubeVirt.

kubectl create -f my-vmi.yaml
</code></pre></div>
<h4 id="cloud-init-network-config-as-k8s-secret">Cloud-init network-config as k8s Secret<a class="headerlink" href="#cloud-init-network-config-as-k8s-secret" title="Permanent link">&para;</a></h4>
<p>Users who wish to not store the cloud-init network-config directly in
the VirtualMachineInstance spec have the option to store the
network-config into a Kubernetes Secret and reference that Secret in the
spec.</p>
<p>Multiple VirtualMachineInstance specs can reference the same Kubernetes
Secret containing cloud-init network-config.</p>
<p>Below is an example of how to create a Kubernetes Secret containing a
network-config and reference that Secret in the VM's spec.</p>
<div class="highlight"><pre><span></span><code># Create a simple network-config

cat &lt;&lt; END &gt; network-config
network:
  version: 1
  config:
  - type: physical
  name: eth0
  subnets:
    - type: dhcp
END

# Store the network-config in a Kubernetes Secret
kubectl create secret generic my-vmi-secret --from-file=networkdata=network-config

# Create a VM manifest and reference the Secret&#39;s name in the cloudInitNoCloud
# Volume&#39;s secretRef field

cat &lt;&lt; END &gt; my-vmi.yaml
apiVersion: kubevirt.io/v1alpha2
kind: VirtualMachineInstance
metadata:
  name: myvmi
spec:
  terminationGracePeriodSeconds: 5
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: containerdisk
        volumeName: registryvolume
        disk:
          bus: virtio
      - name: cloudinitdisk
        volumeName: cloudinitvolume
        disk:
          bus: virtio
  volumes:
    - name: registryvolume
      containerDisk:
        image: kubevirt/cirros-registry-disk-demo:latest
    - name: cloudinitvolume
      cloudInitNoCloud:
        userData: &quot;#cloud-config&quot;
        networkDataSecretRef:
          name: my-vmi-secret
END

# Post the VM
kubectl create -f my-vmi.yaml
</code></pre></div>
<h3 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h3>
<p>Depending on the operating system distribution in use, cloud-init output
is often printed to the console output on boot up. When developing
userdata scripts, users can connect to the VM's console during boot up
to debug.</p>
<p>Example of connecting to console using virtctl:</p>
<div class="highlight"><pre><span></span><code>virtctl console &lt;name of vmi&gt;
</code></pre></div>
<h3 id="device-role-tagging">Device Role Tagging<a class="headerlink" href="#device-role-tagging" title="Permanent link">&para;</a></h3>
<p>KubeVirt provides a mechanism for users to tag devices such as Network
Interfaces with a specific role. The tag will be matched to the hardware
address of the device and this mapping exposed to the guest OS via
cloud-init.</p>
<p>This additional metadata will help the guest OS users with multiple networks
interfaces to identify the devices that may have a specific role, such as a
network device dedicated to a specific service or a disk intended to be used by
a specific application (database, webcache, etc.)</p>
<p>This functionality already exists in platforms such as OpenStack. KubeVirt will
provide the data in a similar format, known to users and services like cloud-init.</p>
<p>For example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachineInstance</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="nt">domain</span><span class="p">:</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">devices</span><span class="p">:</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">      </span><span class="nt">interfaces</span><span class="p">:</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">masquerade</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bridge</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ptp</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ptp</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sriov-net</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">        </span><span class="nt">sriov</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfvfunc</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">    </span><span class="nt">pod</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multus</span><span class="p">:</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">      </span><span class="nt">networkName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ptp-conf</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ptp</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multus</span><span class="p">:</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">      </span><span class="nt">networkName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sriov/sriov-network</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sriov-net</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="l l-Scalar l-Scalar-Plain">The metadata will be available in the guests config drive `openstack/latest/meta_data.json`</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="p p-Indicator">{</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">  </span><span class="s">&quot;devices&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">    </span><span class="p p-Indicator">{</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">        </span><span class="s">&quot;type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;nic&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">        </span><span class="s">&quot;bus&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;pci&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">        </span><span class="s">&quot;address&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;0000:00:02.0&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">        </span><span class="s">&quot;mac&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;01:22:22:42:22:21&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">        </span><span class="s">&quot;tags&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ptp&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">    </span><span class="p p-Indicator">},</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">    </span><span class="p p-Indicator">{</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">        </span><span class="s">&quot;type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;nic&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="w">        </span><span class="s">&quot;bus&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;pci&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">        </span><span class="s">&quot;address&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;0000:81:10.1&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">        </span><span class="s">&quot;mac&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;01:22:22:42:22:22&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">        </span><span class="s">&quot;tags&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;nfvfunc&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">    </span><span class="p p-Indicator">},</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="w">  </span><span class="p p-Indicator">]</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="p p-Indicator">}</span>
</code></pre></div></p>
<h2 id="ignition-examples">Ignition Examples<a class="headerlink" href="#ignition-examples" title="Permanent link">&para;</a></h2>
<p>Ignition data can be passed into a <code>cloudInitConfigDrive</code> source using 
either clear text, a base64 string or a k8s Secret.</p>
<p>Some examples of Ignition configurations can be found 
<a href="https://coreos.github.io/ignition/examples/">in the examples</a> 
given by the Ignition documentation.</p>
<h3 id="ignition-as-clear-text">Ignition as clear text<a class="headerlink" href="#ignition-as-clear-text" title="Permanent link">&para;</a></h3>
<p>Here is a complete example of a Kubevirt VM using Ignition to add an ssh key to the 
<code>coreos</code> user at first boot : </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.io/v1alpha3</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachine</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ign-demo</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="nt">runStrategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Halted</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="nt">kubevirt.io/size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">small</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">        </span><span class="nt">kubevirt.io/domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ign-demo</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">      </span><span class="nt">domain</span><span class="p">:</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">        </span><span class="nt">devices</span><span class="p">:</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">          </span><span class="nt">disks</span><span class="p">:</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">containerdisk</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">              </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">                </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudinitdisk</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">              </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">                </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">          </span><span class="nt">interfaces</span><span class="p">:</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">              </span><span class="nt">masquerade</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2G</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="w">          </span><span class="nt">pod</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">containerdisk</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="w">          </span><span class="nt">containerDisk</span><span class="p">:</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="w">            </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/containerdisks/rhcos:4.9</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloudinitdisk</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">          </span><span class="nt">cloudInitConfigDrive</span><span class="p">:</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="w">            </span><span class="nt">userData</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="w">              </span><span class="no">{</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="w">                </span><span class="no">&quot;ignition&quot;: {</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="w">                  </span><span class="no">&quot;config&quot;: {},</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="w">                  </span><span class="no">&quot;proxy&quot;: {},</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="w">                  </span><span class="no">&quot;security&quot;: {},</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="w">                  </span><span class="no">&quot;timeouts&quot;: {},</span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="w">                  </span><span class="no">&quot;version&quot;: &quot;3.2.0&quot;</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a><span class="w">                </span><span class="no">},</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a><span class="w">                </span><span class="no">&quot;passwd&quot;: {</span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a><span class="w">                  </span><span class="no">&quot;users&quot;: [</span>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a><span class="w">                    </span><span class="no">{</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a><span class="w">                      </span><span class="no">&quot;name&quot;: &quot;coreos&quot;,</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a><span class="w">                      </span><span class="no">&quot;sshAuthorizedKeys&quot;: [</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a><span class="w">                        </span><span class="no">&quot;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPL3axFGHI3db9iJWkPXVbYzD7OaWTtHuqmxLvj+DztB user@example&quot;</span>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a><span class="w">                      </span><span class="no">]</span>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="w">                    </span><span class="no">}</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a><span class="w">                  </span><span class="no">]</span>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a><span class="w">                </span><span class="no">},</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a><span class="w">                </span><span class="no">&quot;storage&quot;: {},</span>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a><span class="w">                </span><span class="no">&quot;systemd&quot;: {}</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a><span class="w">              </span><span class="no">}</span>
</code></pre></div>
<p>See that the Ignition config is simply passed to the <code>userData</code> annotation of the 
<code>cloudInitConfigDrive</code> volume.</p>
<h3 id="ignition-as-base64">Ignition as base64<a class="headerlink" href="#ignition-as-base64" title="Permanent link">&para;</a></h3>
<p>You can also pass the Ignition config as a base64 string by using the <code>userDatabase64</code>
annotation : </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nn">...</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nt">cloudInitConfigDrive</span><span class="p">:</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nt">userDataBase64</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eyJpZ25pdGlvbiI6eyJjb25maWciOnt9LCJwcm94eSI6e30sInNlY3VyaXR5Ijp7fSwidGltZW91dHMiOnt9LCJ2ZXJzaW9uIjoiMy4yLjAifSwicGFzc3dkIjp7InVzZXJzIjpbeyJuYW1lIjoiY29yZW9zIiwic3NoQXV0aG9yaXplZEtleXMiOlsic3NoLWVkMjU1MTlBQUFBQzNOemFDMWxaREkxTlRFNUFBQUFJUEwzYXhGR0hJM2RiOWlKV2tQWFZiWXpEN09hV1R0SHVxbXhMdmorRHp0QiB1c2VyQGV4YW1wbGUiXX1dfSwic3RvcmFnZSI6e30sInN5c3RlbWQiOnt9fQ==</span>
</code></pre></div>
<p>You can obtain the base64 string by doing <code>cat ignition.json | base64 -w0</code> in your terminal.</p>
<h3 id="ignition-as-k8s-secret">Ignition as k8s Secret<a class="headerlink" href="#ignition-as-k8s-secret" title="Permanent link">&para;</a></h3>
<p>If you do not want to store the Ignition config into the VM configuration, you can use a k8s Secret.</p>
<p>First, create the secret with the ignition data in it :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>my-ign-secret<span class="w"> </span>--from-file<span class="o">=</span><span class="nv">ignition</span><span class="o">=</span>ignition.json
</code></pre></div>
<p>Then specify this secret into your VM configuration :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nn">...</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nt">cloudInitConfigDrive</span><span class="p">:</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="nt">secretRef</span><span class="p">:</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-ign-secret</span>
</code></pre></div>
<h2 id="sysprep-examples">Sysprep Examples<a class="headerlink" href="#sysprep-examples" title="Permanent link">&para;</a></h2>
<h3 id="sysprep-in-a-configmap">Sysprep in a ConfigMap<a class="headerlink" href="#sysprep-in-a-configmap" title="Permanent link">&para;</a></h3>
<p>The answer file can be provided in a ConfigMap:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep-config</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="nt">autounattend.xml</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="no">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="no">&lt;unattend xmlns=&quot;urn:schemas-microsoft-com:unattend&quot;&gt;</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="no">...</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="no">&lt;/unattend&gt;</span>
</code></pre></div>
<p>And attached to the VM like so:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachine</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows-with-sysprep</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">  </span><span class="nt">runStrategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Halted</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">        </span><span class="nt">kubevirt.io/domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows-with-sysprep</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">      </span><span class="nt">domain</span><span class="p">:</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">          </span><span class="nt">cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">        </span><span class="nt">devices</span><span class="p">:</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">          </span><span class="nt">disks</span><span class="p">:</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bootOrder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">            </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">              </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">harddrive</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="w">            </span><span class="nt">cdrom</span><span class="p">:</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="w">              </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sata</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="w">        </span><span class="nt">machine</span><span class="p">:</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">q35</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6G</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">harddrive</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows_pvc</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="w">        </span><span class="nt">sysprep</span><span class="p">:</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep-config</span>
</code></pre></div>
<h3 id="sysprep-in-a-secret">Sysprep in a Secret<a class="headerlink" href="#sysprep-in-a-secret" title="Permanent link">&para;</a></h3>
<p>The answer file can be provided in a Secret:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep-config</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="nt">stringData</span><span class="p">:</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">  </span><span class="nt">autounattend.xml</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="no">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="no">&lt;unattend xmlns=&quot;urn:schemas-microsoft-com:unattend&quot;&gt;</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="no">...</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="no">&lt;/unattend&gt;</span>
</code></pre></div>
<p>And attached to the VM like so:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachine</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows-with-sysprep</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="nt">runStrategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Halted</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">        </span><span class="nt">kubevirt.io/domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows-with-sysprep</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">      </span><span class="nt">domain</span><span class="p">:</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">          </span><span class="nt">cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">        </span><span class="nt">devices</span><span class="p">:</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">          </span><span class="nt">disks</span><span class="p">:</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bootOrder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">            </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">              </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">harddrive</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">            </span><span class="nt">cdrom</span><span class="p">:</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">              </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sata</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">        </span><span class="nt">machine</span><span class="p">:</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">q35</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6G</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">harddrive</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows_pvc</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="w">        </span><span class="nt">sysprep</span><span class="p">:</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="w">          </span><span class="nt">secret</span><span class="p">:</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep-secret</span>
</code></pre></div>
<h3 id="base-sysprep-vm">Base Sysprep VM<a class="headerlink" href="#base-sysprep-vm" title="Permanent link">&para;</a></h3>
<p>In the example below, a configMap with <code>autounattend.xml</code> file is used to modify the Windows iso image which is downloaded from Microsoft
and creates a base installed Windows machine with virtio drivers installed and all the commands executed in <code>post-install.ps1</code>
For the below manifests to work it needs to have <code>win10-iso</code> DataVolume.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template-configmap</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="nt">autounattend.xml</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="no">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="no">&lt;unattend xmlns=&quot;urn:schemas-microsoft-com:unattend&quot;&gt;</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">      </span><span class="no">&lt;settings pass=&quot;windowsPE&quot;&gt;</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">        </span><span class="no">&lt;component xmlns:wcm=&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; name=&quot;Microsoft-Windows-International-Core-WinPE&quot; processorArchitecture=&quot;amd64&quot; publicKeyToken=&quot;31bf3856ad364e35&quot; language=&quot;neutral&quot; versionScope=&quot;nonSxS&quot;&gt;</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">          </span><span class="no">&lt;SetupUILanguage&gt;</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">            </span><span class="no">&lt;UILanguage&gt;en-US&lt;/UILanguage&gt;</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">          </span><span class="no">&lt;/SetupUILanguage&gt;</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">          </span><span class="no">&lt;InputLocale&gt;0409:00000409&lt;/InputLocale&gt;</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">          </span><span class="no">&lt;SystemLocale&gt;en-US&lt;/SystemLocale&gt;</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">          </span><span class="no">&lt;UILanguage&gt;en-US&lt;/UILanguage&gt;</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">          </span><span class="no">&lt;UILanguageFallback&gt;en-US&lt;/UILanguageFallback&gt;</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">          </span><span class="no">&lt;UserLocale&gt;en-US&lt;/UserLocale&gt;</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">        </span><span class="no">&lt;/component&gt;</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">        </span><span class="no">&lt;component xmlns:wcm=&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; name=&quot;Microsoft-Windows-PnpCustomizationsWinPE&quot; processorArchitecture=&quot;amd64&quot; publicKeyToken=&quot;31bf3856ad364e35&quot; language=&quot;neutral&quot; versionScope=&quot;nonSxS&quot;&gt;</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">          </span><span class="no">&lt;DriverPaths&gt;</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="w">            </span><span class="no">&lt;PathAndCredentials wcm:keyValue=&quot;4b29ba63&quot; wcm:action=&quot;add&quot;&gt;</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">              </span><span class="no">&lt;Path&gt;E:\amd64\2k19&lt;/Path&gt;</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="w">            </span><span class="no">&lt;/PathAndCredentials&gt;</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="w">            </span><span class="no">&lt;PathAndCredentials wcm:keyValue=&quot;25fe51ea&quot; wcm:action=&quot;add&quot;&gt;</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="w">              </span><span class="no">&lt;Path&gt;E:\NetKVM\2k19\amd64&lt;/Path&gt;</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="w">            </span><span class="no">&lt;/PathAndCredentials&gt;</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="w">          </span><span class="no">&lt;/DriverPaths&gt;</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="w">        </span><span class="no">&lt;/component&gt;</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="w">        </span><span class="no">&lt;component xmlns:wcm=&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; name=&quot;Microsoft-Windows-Setup&quot; processorArchitecture=&quot;amd64&quot; publicKeyToken=&quot;31bf3856ad364e35&quot; language=&quot;neutral&quot; versionScope=&quot;nonSxS&quot;&gt;</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">          </span><span class="no">&lt;DiskConfiguration&gt;</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="w">            </span><span class="no">&lt;Disk wcm:action=&quot;add&quot;&gt;</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="w">              </span><span class="no">&lt;CreatePartitions&gt;</span>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="w">                </span><span class="no">&lt;CreatePartition wcm:action=&quot;add&quot;&gt;</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="w">                  </span><span class="no">&lt;Order&gt;1&lt;/Order&gt;</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="w">                  </span><span class="no">&lt;Type&gt;Primary&lt;/Type&gt;</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="w">                  </span><span class="no">&lt;Size&gt;100&lt;/Size&gt;</span>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a><span class="w">                </span><span class="no">&lt;/CreatePartition&gt;</span>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="w">                </span><span class="no">&lt;CreatePartition wcm:action=&quot;add&quot;&gt;</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a><span class="w">                  </span><span class="no">&lt;Extend&gt;true&lt;/Extend&gt;</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="w">                  </span><span class="no">&lt;Order&gt;2&lt;/Order&gt;</span>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a><span class="w">                  </span><span class="no">&lt;Type&gt;Primary&lt;/Type&gt;</span>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a><span class="w">                </span><span class="no">&lt;/CreatePartition&gt;</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a><span class="w">              </span><span class="no">&lt;/CreatePartitions&gt;</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a><span class="w">              </span><span class="no">&lt;ModifyPartitions&gt;</span>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a><span class="w">                </span><span class="no">&lt;ModifyPartition wcm:action=&quot;add&quot;&gt;</span>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a><span class="w">                  </span><span class="no">&lt;Format&gt;NTFS&lt;/Format&gt;</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a><span class="w">                  </span><span class="no">&lt;Label&gt;System Reserved&lt;/Label&gt;</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a><span class="w">                  </span><span class="no">&lt;Order&gt;1&lt;/Order&gt;</span>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a><span class="w">                  </span><span class="no">&lt;PartitionID&gt;1&lt;/PartitionID&gt;</span>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a><span class="w">                  </span><span class="no">&lt;TypeID&gt;0x27&lt;/TypeID&gt;</span>
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a><span class="w">                </span><span class="no">&lt;/ModifyPartition&gt;</span>
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a><span class="w">                </span><span class="no">&lt;ModifyPartition wcm:action=&quot;add&quot;&gt;</span>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a><span class="w">                  </span><span class="no">&lt;Format&gt;NTFS&lt;/Format&gt;</span>
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a><span class="w">                  </span><span class="no">&lt;Label&gt;OS&lt;/Label&gt;</span>
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a><span class="w">                  </span><span class="no">&lt;Letter&gt;C&lt;/Letter&gt;</span>
<a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a><span class="w">                  </span><span class="no">&lt;Order&gt;2&lt;/Order&gt;</span>
<a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a><span class="w">                  </span><span class="no">&lt;PartitionID&gt;2&lt;/PartitionID&gt;</span>
<a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a><span class="w">                </span><span class="no">&lt;/ModifyPartition&gt;</span>
<a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a><span class="w">              </span><span class="no">&lt;/ModifyPartitions&gt;</span>
<a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a><span class="w">              </span><span class="no">&lt;DiskID&gt;0&lt;/DiskID&gt;</span>
<a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a><span class="w">              </span><span class="no">&lt;WillWipeDisk&gt;true&lt;/WillWipeDisk&gt;</span>
<a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a><span class="w">            </span><span class="no">&lt;/Disk&gt;</span>
<a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a><span class="w">          </span><span class="no">&lt;/DiskConfiguration&gt;</span>
<a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a><span class="w">          </span><span class="no">&lt;ImageInstall&gt;</span>
<a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a><span class="w">            </span><span class="no">&lt;OSImage&gt;</span>
<a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a><span class="w">              </span><span class="no">&lt;InstallFrom&gt;</span>
<a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a><span class="w">                </span><span class="no">&lt;MetaData wcm:action=&quot;add&quot;&gt;</span>
<a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a><span class="w">                  </span><span class="no">&lt;Key&gt;/Image/Description&lt;/Key&gt;</span>
<a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a><span class="w">                  </span><span class="no">&lt;Value&gt;Windows 10 Pro&lt;/Value&gt;</span>
<a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a><span class="w">                </span><span class="no">&lt;/MetaData&gt;</span>
<a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a><span class="w">              </span><span class="no">&lt;/InstallFrom&gt;</span>
<a id="__codelineno-10-73" name="__codelineno-10-73" href="#__codelineno-10-73"></a><span class="w">              </span><span class="no">&lt;InstallTo&gt;</span>
<a id="__codelineno-10-74" name="__codelineno-10-74" href="#__codelineno-10-74"></a><span class="w">                </span><span class="no">&lt;DiskID&gt;0&lt;/DiskID&gt;</span>
<a id="__codelineno-10-75" name="__codelineno-10-75" href="#__codelineno-10-75"></a><span class="w">                </span><span class="no">&lt;PartitionID&gt;2&lt;/PartitionID&gt;</span>
<a id="__codelineno-10-76" name="__codelineno-10-76" href="#__codelineno-10-76"></a><span class="w">              </span><span class="no">&lt;/InstallTo&gt;</span>
<a id="__codelineno-10-77" name="__codelineno-10-77" href="#__codelineno-10-77"></a><span class="w">            </span><span class="no">&lt;/OSImage&gt;</span>
<a id="__codelineno-10-78" name="__codelineno-10-78" href="#__codelineno-10-78"></a><span class="w">          </span><span class="no">&lt;/ImageInstall&gt;</span>
<a id="__codelineno-10-79" name="__codelineno-10-79" href="#__codelineno-10-79"></a><span class="w">          </span><span class="no">&lt;UserData&gt;</span>
<a id="__codelineno-10-80" name="__codelineno-10-80" href="#__codelineno-10-80"></a><span class="w">            </span><span class="no">&lt;AcceptEula&gt;true&lt;/AcceptEula&gt;</span>
<a id="__codelineno-10-81" name="__codelineno-10-81" href="#__codelineno-10-81"></a><span class="w">            </span><span class="no">&lt;FullName/&gt;</span>
<a id="__codelineno-10-82" name="__codelineno-10-82" href="#__codelineno-10-82"></a><span class="w">            </span><span class="no">&lt;Organization/&gt;</span>
<a id="__codelineno-10-83" name="__codelineno-10-83" href="#__codelineno-10-83"></a><span class="w">            </span><span class="no">&lt;ProductKey&gt;</span>
<a id="__codelineno-10-84" name="__codelineno-10-84" href="#__codelineno-10-84"></a><span class="w">              </span><span class="no">&lt;Key/&gt;</span>
<a id="__codelineno-10-85" name="__codelineno-10-85" href="#__codelineno-10-85"></a><span class="w">            </span><span class="no">&lt;/ProductKey&gt;</span>
<a id="__codelineno-10-86" name="__codelineno-10-86" href="#__codelineno-10-86"></a><span class="w">          </span><span class="no">&lt;/UserData&gt;</span>
<a id="__codelineno-10-87" name="__codelineno-10-87" href="#__codelineno-10-87"></a><span class="w">        </span><span class="no">&lt;/component&gt;</span>
<a id="__codelineno-10-88" name="__codelineno-10-88" href="#__codelineno-10-88"></a><span class="w">      </span><span class="no">&lt;/settings&gt;</span>
<a id="__codelineno-10-89" name="__codelineno-10-89" href="#__codelineno-10-89"></a><span class="w">      </span><span class="no">&lt;settings pass=&quot;offlineServicing&quot;&gt;</span>
<a id="__codelineno-10-90" name="__codelineno-10-90" href="#__codelineno-10-90"></a><span class="w">        </span><span class="no">&lt;component xmlns:wcm=&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; name=&quot;Microsoft-Windows-LUA-Settings&quot; processorArchitecture=&quot;amd64&quot; publicKeyToken=&quot;31bf3856ad364e35&quot; language=&quot;neutral&quot; versionScope=&quot;nonSxS&quot;&gt;</span>
<a id="__codelineno-10-91" name="__codelineno-10-91" href="#__codelineno-10-91"></a><span class="w">          </span><span class="no">&lt;EnableLUA&gt;false&lt;/EnableLUA&gt;</span>
<a id="__codelineno-10-92" name="__codelineno-10-92" href="#__codelineno-10-92"></a><span class="w">        </span><span class="no">&lt;/component&gt;</span>
<a id="__codelineno-10-93" name="__codelineno-10-93" href="#__codelineno-10-93"></a><span class="w">      </span><span class="no">&lt;/settings&gt;</span>
<a id="__codelineno-10-94" name="__codelineno-10-94" href="#__codelineno-10-94"></a><span class="w">      </span><span class="no">&lt;settings pass=&quot;specialize&quot;&gt;</span>
<a id="__codelineno-10-95" name="__codelineno-10-95" href="#__codelineno-10-95"></a><span class="w">        </span><span class="no">&lt;component xmlns:wcm=&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; name=&quot;Microsoft-Windows-International-Core&quot; processorArchitecture=&quot;amd64&quot; publicKeyToken=&quot;31bf3856ad364e35&quot; language=&quot;neutral&quot; versionScope=&quot;nonSxS&quot;&gt;</span>
<a id="__codelineno-10-96" name="__codelineno-10-96" href="#__codelineno-10-96"></a><span class="w">          </span><span class="no">&lt;InputLocale&gt;0409:00000409&lt;/InputLocale&gt;</span>
<a id="__codelineno-10-97" name="__codelineno-10-97" href="#__codelineno-10-97"></a><span class="w">          </span><span class="no">&lt;SystemLocale&gt;en-US&lt;/SystemLocale&gt;</span>
<a id="__codelineno-10-98" name="__codelineno-10-98" href="#__codelineno-10-98"></a><span class="w">          </span><span class="no">&lt;UILanguage&gt;en-US&lt;/UILanguage&gt;</span>
<a id="__codelineno-10-99" name="__codelineno-10-99" href="#__codelineno-10-99"></a><span class="w">          </span><span class="no">&lt;UILanguageFallback&gt;en-US&lt;/UILanguageFallback&gt;</span>
<a id="__codelineno-10-100" name="__codelineno-10-100" href="#__codelineno-10-100"></a><span class="w">          </span><span class="no">&lt;UserLocale&gt;en-US&lt;/UserLocale&gt;</span>
<a id="__codelineno-10-101" name="__codelineno-10-101" href="#__codelineno-10-101"></a><span class="w">        </span><span class="no">&lt;/component&gt;</span>
<a id="__codelineno-10-102" name="__codelineno-10-102" href="#__codelineno-10-102"></a><span class="w">        </span><span class="no">&lt;component xmlns:wcm=&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; name=&quot;Microsoft-Windows-Security-SPP-UX&quot; processorArchitecture=&quot;amd64&quot; publicKeyToken=&quot;31bf3856ad364e35&quot; language=&quot;neutral&quot; versionScope=&quot;nonSxS&quot;&gt;</span>
<a id="__codelineno-10-103" name="__codelineno-10-103" href="#__codelineno-10-103"></a><span class="w">          </span><span class="no">&lt;SkipAutoActivation&gt;true&lt;/SkipAutoActivation&gt;</span>
<a id="__codelineno-10-104" name="__codelineno-10-104" href="#__codelineno-10-104"></a><span class="w">        </span><span class="no">&lt;/component&gt;</span>
<a id="__codelineno-10-105" name="__codelineno-10-105" href="#__codelineno-10-105"></a><span class="w">        </span><span class="no">&lt;component xmlns:wcm=&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; name=&quot;Microsoft-Windows-SQMApi&quot; processorArchitecture=&quot;amd64&quot; publicKeyToken=&quot;31bf3856ad364e35&quot; language=&quot;neutral&quot; versionScope=&quot;nonSxS&quot;&gt;</span>
<a id="__codelineno-10-106" name="__codelineno-10-106" href="#__codelineno-10-106"></a><span class="w">          </span><span class="no">&lt;CEIPEnabled&gt;0&lt;/CEIPEnabled&gt;</span>
<a id="__codelineno-10-107" name="__codelineno-10-107" href="#__codelineno-10-107"></a><span class="w">        </span><span class="no">&lt;/component&gt;</span>
<a id="__codelineno-10-108" name="__codelineno-10-108" href="#__codelineno-10-108"></a><span class="w">      </span><span class="no">&lt;/settings&gt;</span>
<a id="__codelineno-10-109" name="__codelineno-10-109" href="#__codelineno-10-109"></a><span class="w">      </span><span class="no">&lt;settings pass=&quot;oobeSystem&quot;&gt;</span>
<a id="__codelineno-10-110" name="__codelineno-10-110" href="#__codelineno-10-110"></a><span class="w">        </span><span class="no">&lt;component xmlns:wcm=&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; name=&quot;Microsoft-Windows-Shell-Setup&quot; processorArchitecture=&quot;amd64&quot; publicKeyToken=&quot;31bf3856ad364e35&quot; language=&quot;neutral&quot; versionScope=&quot;nonSxS&quot;&gt;</span>
<a id="__codelineno-10-111" name="__codelineno-10-111" href="#__codelineno-10-111"></a><span class="w">          </span><span class="no">&lt;OOBE&gt;</span>
<a id="__codelineno-10-112" name="__codelineno-10-112" href="#__codelineno-10-112"></a><span class="w">            </span><span class="no">&lt;HideEULAPage&gt;true&lt;/HideEULAPage&gt;</span>
<a id="__codelineno-10-113" name="__codelineno-10-113" href="#__codelineno-10-113"></a><span class="w">            </span><span class="no">&lt;HideOEMRegistrationScreen&gt;true&lt;/HideOEMRegistrationScreen&gt;</span>
<a id="__codelineno-10-114" name="__codelineno-10-114" href="#__codelineno-10-114"></a><span class="w">            </span><span class="no">&lt;HideOnlineAccountScreens&gt;true&lt;/HideOnlineAccountScreens&gt;</span>
<a id="__codelineno-10-115" name="__codelineno-10-115" href="#__codelineno-10-115"></a><span class="w">            </span><span class="no">&lt;HideWirelessSetupInOOBE&gt;true&lt;/HideWirelessSetupInOOBE&gt;</span>
<a id="__codelineno-10-116" name="__codelineno-10-116" href="#__codelineno-10-116"></a><span class="w">            </span><span class="no">&lt;NetworkLocation&gt;Work&lt;/NetworkLocation&gt;</span>
<a id="__codelineno-10-117" name="__codelineno-10-117" href="#__codelineno-10-117"></a><span class="w">            </span><span class="no">&lt;SkipUserOOBE&gt;true&lt;/SkipUserOOBE&gt;</span>
<a id="__codelineno-10-118" name="__codelineno-10-118" href="#__codelineno-10-118"></a><span class="w">            </span><span class="no">&lt;SkipMachineOOBE&gt;true&lt;/SkipMachineOOBE&gt;</span>
<a id="__codelineno-10-119" name="__codelineno-10-119" href="#__codelineno-10-119"></a><span class="w">            </span><span class="no">&lt;ProtectYourPC&gt;3&lt;/ProtectYourPC&gt;</span>
<a id="__codelineno-10-120" name="__codelineno-10-120" href="#__codelineno-10-120"></a><span class="w">          </span><span class="no">&lt;/OOBE&gt;</span>
<a id="__codelineno-10-121" name="__codelineno-10-121" href="#__codelineno-10-121"></a><span class="w">          </span><span class="no">&lt;AutoLogon&gt;</span>
<a id="__codelineno-10-122" name="__codelineno-10-122" href="#__codelineno-10-122"></a><span class="w">            </span><span class="no">&lt;Password&gt;</span>
<a id="__codelineno-10-123" name="__codelineno-10-123" href="#__codelineno-10-123"></a><span class="w">              </span><span class="no">&lt;Value&gt;123456&lt;/Value&gt;</span>
<a id="__codelineno-10-124" name="__codelineno-10-124" href="#__codelineno-10-124"></a><span class="w">              </span><span class="no">&lt;PlainText&gt;true&lt;/PlainText&gt;</span>
<a id="__codelineno-10-125" name="__codelineno-10-125" href="#__codelineno-10-125"></a><span class="w">            </span><span class="no">&lt;/Password&gt;</span>
<a id="__codelineno-10-126" name="__codelineno-10-126" href="#__codelineno-10-126"></a><span class="w">            </span><span class="no">&lt;Enabled&gt;true&lt;/Enabled&gt;</span>
<a id="__codelineno-10-127" name="__codelineno-10-127" href="#__codelineno-10-127"></a><span class="w">            </span><span class="no">&lt;Username&gt;Administrator&lt;/Username&gt;</span>
<a id="__codelineno-10-128" name="__codelineno-10-128" href="#__codelineno-10-128"></a><span class="w">          </span><span class="no">&lt;/AutoLogon&gt;</span>
<a id="__codelineno-10-129" name="__codelineno-10-129" href="#__codelineno-10-129"></a><span class="w">          </span><span class="no">&lt;UserAccounts&gt;</span>
<a id="__codelineno-10-130" name="__codelineno-10-130" href="#__codelineno-10-130"></a><span class="w">            </span><span class="no">&lt;AdministratorPassword&gt;</span>
<a id="__codelineno-10-131" name="__codelineno-10-131" href="#__codelineno-10-131"></a><span class="w">              </span><span class="no">&lt;Value&gt;123456&lt;/Value&gt;</span>
<a id="__codelineno-10-132" name="__codelineno-10-132" href="#__codelineno-10-132"></a><span class="w">              </span><span class="no">&lt;PlainText&gt;true&lt;/PlainText&gt;</span>
<a id="__codelineno-10-133" name="__codelineno-10-133" href="#__codelineno-10-133"></a><span class="w">            </span><span class="no">&lt;/AdministratorPassword&gt;</span>
<a id="__codelineno-10-134" name="__codelineno-10-134" href="#__codelineno-10-134"></a><span class="w">          </span><span class="no">&lt;/UserAccounts&gt;</span>
<a id="__codelineno-10-135" name="__codelineno-10-135" href="#__codelineno-10-135"></a><span class="w">          </span><span class="no">&lt;RegisteredOrganization/&gt;</span>
<a id="__codelineno-10-136" name="__codelineno-10-136" href="#__codelineno-10-136"></a><span class="w">          </span><span class="no">&lt;RegisteredOwner/&gt;</span>
<a id="__codelineno-10-137" name="__codelineno-10-137" href="#__codelineno-10-137"></a><span class="w">          </span><span class="no">&lt;TimeZone&gt;Eastern Standard Time&lt;/TimeZone&gt;</span>
<a id="__codelineno-10-138" name="__codelineno-10-138" href="#__codelineno-10-138"></a><span class="w">          </span><span class="no">&lt;FirstLogonCommands&gt;</span>
<a id="__codelineno-10-139" name="__codelineno-10-139" href="#__codelineno-10-139"></a><span class="w">            </span><span class="no">&lt;SynchronousCommand wcm:action=&quot;add&quot;&gt;</span>
<a id="__codelineno-10-140" name="__codelineno-10-140" href="#__codelineno-10-140"></a><span class="w">              </span><span class="no">&lt;CommandLine&gt;powershell -ExecutionPolicy Bypass -NoExit -NoProfile f:\post-install.ps1&lt;/CommandLine&gt;</span>
<a id="__codelineno-10-141" name="__codelineno-10-141" href="#__codelineno-10-141"></a><span class="w">              </span><span class="no">&lt;RequiresUserInput&gt;false&lt;/RequiresUserInput&gt;</span>
<a id="__codelineno-10-142" name="__codelineno-10-142" href="#__codelineno-10-142"></a><span class="w">              </span><span class="no">&lt;Order&gt;1&lt;/Order&gt;</span>
<a id="__codelineno-10-143" name="__codelineno-10-143" href="#__codelineno-10-143"></a><span class="w">              </span><span class="no">&lt;Description&gt;Post Installation Script&lt;/Description&gt;</span>
<a id="__codelineno-10-144" name="__codelineno-10-144" href="#__codelineno-10-144"></a><span class="w">            </span><span class="no">&lt;/SynchronousCommand&gt;</span>
<a id="__codelineno-10-145" name="__codelineno-10-145" href="#__codelineno-10-145"></a><span class="w">          </span><span class="no">&lt;/FirstLogonCommands&gt;</span>
<a id="__codelineno-10-146" name="__codelineno-10-146" href="#__codelineno-10-146"></a><span class="w">        </span><span class="no">&lt;/component&gt;</span>
<a id="__codelineno-10-147" name="__codelineno-10-147" href="#__codelineno-10-147"></a><span class="w">      </span><span class="no">&lt;/settings&gt;</span>
<a id="__codelineno-10-148" name="__codelineno-10-148" href="#__codelineno-10-148"></a><span class="w">    </span><span class="no">&lt;/unattend&gt;</span>
<a id="__codelineno-10-149" name="__codelineno-10-149" href="#__codelineno-10-149"></a>
<a id="__codelineno-10-150" name="__codelineno-10-150" href="#__codelineno-10-150"></a>
<a id="__codelineno-10-151" name="__codelineno-10-151" href="#__codelineno-10-151"></a><span class="w">  </span><span class="nt">post-install.ps1</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-10-152" name="__codelineno-10-152" href="#__codelineno-10-152"></a><span class="w">    </span><span class="no"># Remove AutoLogin</span>
<a id="__codelineno-10-153" name="__codelineno-10-153" href="#__codelineno-10-153"></a><span class="w">    </span><span class="no"># https://docs.microsoft.com/en-us/windows-hardware/customize/desktop/unattend/microsoft-windows-shell-setup-autologon-logoncount#logoncount-known-issue</span>
<a id="__codelineno-10-154" name="__codelineno-10-154" href="#__codelineno-10-154"></a><span class="w">    </span><span class="no">reg add &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot; /v AutoAdminLogon /t REG_SZ /d 0 /f</span>
<a id="__codelineno-10-155" name="__codelineno-10-155" href="#__codelineno-10-155"></a>
<a id="__codelineno-10-156" name="__codelineno-10-156" href="#__codelineno-10-156"></a><span class="w">    </span><span class="no"># install Qemu Tools (Drivers)</span>
<a id="__codelineno-10-157" name="__codelineno-10-157" href="#__codelineno-10-157"></a><span class="w">    </span><span class="no">Start-Process msiexec -Wait -ArgumentList &#39;/i e:\virtio-win-gt-x64.msi /qn /passive /norestart&#39;</span>
<a id="__codelineno-10-158" name="__codelineno-10-158" href="#__codelineno-10-158"></a>
<a id="__codelineno-10-159" name="__codelineno-10-159" href="#__codelineno-10-159"></a><span class="w">    </span><span class="no"># install Guest Agent</span>
<a id="__codelineno-10-160" name="__codelineno-10-160" href="#__codelineno-10-160"></a><span class="w">    </span><span class="no">Start-Process msiexec -Wait -ArgumentList &#39;/i e:\guest-agent\qemu-ga-x86_64.msi /qn /passive /norestart&#39;</span>
<a id="__codelineno-10-161" name="__codelineno-10-161" href="#__codelineno-10-161"></a>
<a id="__codelineno-10-162" name="__codelineno-10-162" href="#__codelineno-10-162"></a><span class="w">    </span><span class="no"># Rename cached unattend.xml to avoid it is picked up by sysprep</span>
<a id="__codelineno-10-163" name="__codelineno-10-163" href="#__codelineno-10-163"></a><span class="w">    </span><span class="no">mv C:\Windows\Panther\unattend.xml C:\Windows\Panther\unattend.install.xml</span>
<a id="__codelineno-10-164" name="__codelineno-10-164" href="#__codelineno-10-164"></a>
<a id="__codelineno-10-165" name="__codelineno-10-165" href="#__codelineno-10-165"></a><span class="w">    </span><span class="no"># Eject CD, to avoid that the autounattend.xml on the CD is picked up by sysprep</span>
<a id="__codelineno-10-166" name="__codelineno-10-166" href="#__codelineno-10-166"></a><span class="w">    </span><span class="no">(new-object -COM Shell.Application).NameSpace(17).ParseName(&#39;F:&#39;).InvokeVerb(&#39;Eject&#39;)</span>
<a id="__codelineno-10-167" name="__codelineno-10-167" href="#__codelineno-10-167"></a>
<a id="__codelineno-10-168" name="__codelineno-10-168" href="#__codelineno-10-168"></a><span class="w">    </span><span class="no"># Run Sysprep and Shutdown</span>
<a id="__codelineno-10-169" name="__codelineno-10-169" href="#__codelineno-10-169"></a><span class="w">    </span><span class="no">C:\Windows\System32\Sysprep\sysprep.exe /generalize /oobe /shutdown /mode:vm</span>
<a id="__codelineno-10-170" name="__codelineno-10-170" href="#__codelineno-10-170"></a>
<a id="__codelineno-10-171" name="__codelineno-10-171" href="#__codelineno-10-171"></a><span class="nn">---</span>
<a id="__codelineno-10-172" name="__codelineno-10-172" href="#__codelineno-10-172"></a>
<a id="__codelineno-10-173" name="__codelineno-10-173" href="#__codelineno-10-173"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.io/v1</span>
<a id="__codelineno-10-174" name="__codelineno-10-174" href="#__codelineno-10-174"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachine</span>
<a id="__codelineno-10-175" name="__codelineno-10-175" href="#__codelineno-10-175"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-10-176" name="__codelineno-10-176" href="#__codelineno-10-176"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-10-177" name="__codelineno-10-177" href="#__codelineno-10-177"></a><span class="w">    </span><span class="nt">name.os.template.kubevirt.io/win10</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Microsoft Windows 10</span>
<a id="__codelineno-10-178" name="__codelineno-10-178" href="#__codelineno-10-178"></a><span class="w">    </span><span class="nt">vm.kubevirt.io/validations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-10-179" name="__codelineno-10-179" href="#__codelineno-10-179"></a><span class="w">      </span><span class="no">[</span>
<a id="__codelineno-10-180" name="__codelineno-10-180" href="#__codelineno-10-180"></a><span class="w">        </span><span class="no">{</span>
<a id="__codelineno-10-181" name="__codelineno-10-181" href="#__codelineno-10-181"></a><span class="w">          </span><span class="no">&quot;name&quot;: &quot;minimal-required-memory&quot;,</span>
<a id="__codelineno-10-182" name="__codelineno-10-182" href="#__codelineno-10-182"></a><span class="w">          </span><span class="no">&quot;path&quot;: &quot;jsonpath::.spec.domain.resources.requests.memory&quot;,</span>
<a id="__codelineno-10-183" name="__codelineno-10-183" href="#__codelineno-10-183"></a><span class="w">          </span><span class="no">&quot;rule&quot;: &quot;integer&quot;,</span>
<a id="__codelineno-10-184" name="__codelineno-10-184" href="#__codelineno-10-184"></a><span class="w">          </span><span class="no">&quot;message&quot;: &quot;This VM requires more memory.&quot;,</span>
<a id="__codelineno-10-185" name="__codelineno-10-185" href="#__codelineno-10-185"></a><span class="w">          </span><span class="no">&quot;min&quot;: 2147483648</span>
<a id="__codelineno-10-186" name="__codelineno-10-186" href="#__codelineno-10-186"></a><span class="w">        </span><span class="no">}, {</span>
<a id="__codelineno-10-187" name="__codelineno-10-187" href="#__codelineno-10-187"></a><span class="w">          </span><span class="no">&quot;name&quot;: &quot;windows-virtio-bus&quot;,</span>
<a id="__codelineno-10-188" name="__codelineno-10-188" href="#__codelineno-10-188"></a><span class="w">          </span><span class="no">&quot;path&quot;: &quot;jsonpath::.spec.domain.devices.disks[*].disk.bus&quot;,</span>
<a id="__codelineno-10-189" name="__codelineno-10-189" href="#__codelineno-10-189"></a><span class="w">          </span><span class="no">&quot;valid&quot;: &quot;jsonpath::.spec.domain.devices.disks[*].disk.bus&quot;,</span>
<a id="__codelineno-10-190" name="__codelineno-10-190" href="#__codelineno-10-190"></a><span class="w">          </span><span class="no">&quot;rule&quot;: &quot;enum&quot;,</span>
<a id="__codelineno-10-191" name="__codelineno-10-191" href="#__codelineno-10-191"></a><span class="w">          </span><span class="no">&quot;message&quot;: &quot;virto disk bus type has better performance, install virtio drivers in VM and change bus type&quot;,</span>
<a id="__codelineno-10-192" name="__codelineno-10-192" href="#__codelineno-10-192"></a><span class="w">          </span><span class="no">&quot;values&quot;: [&quot;virtio&quot;],</span>
<a id="__codelineno-10-193" name="__codelineno-10-193" href="#__codelineno-10-193"></a><span class="w">          </span><span class="no">&quot;justWarning&quot;: true</span>
<a id="__codelineno-10-194" name="__codelineno-10-194" href="#__codelineno-10-194"></a><span class="w">        </span><span class="no">}, {</span>
<a id="__codelineno-10-195" name="__codelineno-10-195" href="#__codelineno-10-195"></a><span class="w">          </span><span class="no">&quot;name&quot;: &quot;windows-disk-bus&quot;,</span>
<a id="__codelineno-10-196" name="__codelineno-10-196" href="#__codelineno-10-196"></a><span class="w">          </span><span class="no">&quot;path&quot;: &quot;jsonpath::.spec.domain.devices.disks[*].disk.bus&quot;,</span>
<a id="__codelineno-10-197" name="__codelineno-10-197" href="#__codelineno-10-197"></a><span class="w">          </span><span class="no">&quot;valid&quot;: &quot;jsonpath::.spec.domain.devices.disks[*].disk.bus&quot;,</span>
<a id="__codelineno-10-198" name="__codelineno-10-198" href="#__codelineno-10-198"></a><span class="w">          </span><span class="no">&quot;rule&quot;: &quot;enum&quot;,</span>
<a id="__codelineno-10-199" name="__codelineno-10-199" href="#__codelineno-10-199"></a><span class="w">          </span><span class="no">&quot;message&quot;: &quot;disk bus has to be either virtio or sata or scsi&quot;,</span>
<a id="__codelineno-10-200" name="__codelineno-10-200" href="#__codelineno-10-200"></a><span class="w">          </span><span class="no">&quot;values&quot;: [&quot;virtio&quot;, &quot;sata&quot;, &quot;scsi&quot;]</span>
<a id="__codelineno-10-201" name="__codelineno-10-201" href="#__codelineno-10-201"></a><span class="w">        </span><span class="no">}, {</span>
<a id="__codelineno-10-202" name="__codelineno-10-202" href="#__codelineno-10-202"></a><span class="w">          </span><span class="no">&quot;name&quot;: &quot;windows-cd-bus&quot;,</span>
<a id="__codelineno-10-203" name="__codelineno-10-203" href="#__codelineno-10-203"></a><span class="w">          </span><span class="no">&quot;path&quot;: &quot;jsonpath::.spec.domain.devices.disks[*].cdrom.bus&quot;,</span>
<a id="__codelineno-10-204" name="__codelineno-10-204" href="#__codelineno-10-204"></a><span class="w">          </span><span class="no">&quot;valid&quot;: &quot;jsonpath::.spec.domain.devices.disks[*].cdrom.bus&quot;,</span>
<a id="__codelineno-10-205" name="__codelineno-10-205" href="#__codelineno-10-205"></a><span class="w">          </span><span class="no">&quot;rule&quot;: &quot;enum&quot;,</span>
<a id="__codelineno-10-206" name="__codelineno-10-206" href="#__codelineno-10-206"></a><span class="w">          </span><span class="no">&quot;message&quot;: &quot;cd bus has to be sata&quot;,</span>
<a id="__codelineno-10-207" name="__codelineno-10-207" href="#__codelineno-10-207"></a><span class="w">          </span><span class="no">&quot;values&quot;: [&quot;sata&quot;]</span>
<a id="__codelineno-10-208" name="__codelineno-10-208" href="#__codelineno-10-208"></a><span class="w">        </span><span class="no">}</span>
<a id="__codelineno-10-209" name="__codelineno-10-209" href="#__codelineno-10-209"></a><span class="w">      </span><span class="no">]</span>
<a id="__codelineno-10-210" name="__codelineno-10-210" href="#__codelineno-10-210"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template</span>
<a id="__codelineno-10-211" name="__codelineno-10-211" href="#__codelineno-10-211"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-10-212" name="__codelineno-10-212" href="#__codelineno-10-212"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-10-213" name="__codelineno-10-213" href="#__codelineno-10-213"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template</span>
<a id="__codelineno-10-214" name="__codelineno-10-214" href="#__codelineno-10-214"></a><span class="w">    </span><span class="nt">flavor.template.kubevirt.io/medium</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span>
<a id="__codelineno-10-215" name="__codelineno-10-215" href="#__codelineno-10-215"></a><span class="w">    </span><span class="nt">os.template.kubevirt.io/win10</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span>
<a id="__codelineno-10-216" name="__codelineno-10-216" href="#__codelineno-10-216"></a><span class="w">    </span><span class="nt">vm.kubevirt.io/template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows10-desktop-medium</span>
<a id="__codelineno-10-217" name="__codelineno-10-217" href="#__codelineno-10-217"></a><span class="w">    </span><span class="nt">vm.kubevirt.io/template.namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openshift</span>
<a id="__codelineno-10-218" name="__codelineno-10-218" href="#__codelineno-10-218"></a><span class="w">    </span><span class="nt">vm.kubevirt.io/template.revision</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1&#39;</span>
<a id="__codelineno-10-219" name="__codelineno-10-219" href="#__codelineno-10-219"></a><span class="w">    </span><span class="nt">vm.kubevirt.io/template.version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v0.14.0</span>
<a id="__codelineno-10-220" name="__codelineno-10-220" href="#__codelineno-10-220"></a><span class="w">    </span><span class="nt">workload.template.kubevirt.io/desktop</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span>
<a id="__codelineno-10-221" name="__codelineno-10-221" href="#__codelineno-10-221"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-10-222" name="__codelineno-10-222" href="#__codelineno-10-222"></a><span class="w">  </span><span class="nt">runStrategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RerunOnFailure</span>
<a id="__codelineno-10-223" name="__codelineno-10-223" href="#__codelineno-10-223"></a><span class="w">  </span><span class="nt">dataVolumeTemplates</span><span class="p">:</span>
<a id="__codelineno-10-224" name="__codelineno-10-224" href="#__codelineno-10-224"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-10-225" name="__codelineno-10-225" href="#__codelineno-10-225"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template-windows-iso</span>
<a id="__codelineno-10-226" name="__codelineno-10-226" href="#__codelineno-10-226"></a><span class="w">      </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-10-227" name="__codelineno-10-227" href="#__codelineno-10-227"></a><span class="w">        </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-228" name="__codelineno-10-228" href="#__codelineno-10-228"></a><span class="w">        </span><span class="nt">source</span><span class="p">:</span>
<a id="__codelineno-10-229" name="__codelineno-10-229" href="#__codelineno-10-229"></a><span class="w">          </span><span class="nt">pvc</span><span class="p">:</span>
<a id="__codelineno-10-230" name="__codelineno-10-230" href="#__codelineno-10-230"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows10-iso</span>
<a id="__codelineno-10-231" name="__codelineno-10-231" href="#__codelineno-10-231"></a><span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-10-232" name="__codelineno-10-232" href="#__codelineno-10-232"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-10-233" name="__codelineno-10-233" href="#__codelineno-10-233"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template</span>
<a id="__codelineno-10-234" name="__codelineno-10-234" href="#__codelineno-10-234"></a><span class="w">      </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-10-235" name="__codelineno-10-235" href="#__codelineno-10-235"></a><span class="w">        </span><span class="nt">storage</span><span class="p">:</span>
<a id="__codelineno-10-236" name="__codelineno-10-236" href="#__codelineno-10-236"></a><span class="w">          </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-10-237" name="__codelineno-10-237" href="#__codelineno-10-237"></a><span class="w">            </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-10-238" name="__codelineno-10-238" href="#__codelineno-10-238"></a><span class="w">              </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25Gi</span>
<a id="__codelineno-10-239" name="__codelineno-10-239" href="#__codelineno-10-239"></a><span class="w">          </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
<a id="__codelineno-10-240" name="__codelineno-10-240" href="#__codelineno-10-240"></a><span class="w">        </span><span class="nt">source</span><span class="p">:</span>
<a id="__codelineno-10-241" name="__codelineno-10-241" href="#__codelineno-10-241"></a><span class="w">          </span><span class="nt">blank</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-242" name="__codelineno-10-242" href="#__codelineno-10-242"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-10-243" name="__codelineno-10-243" href="#__codelineno-10-243"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-10-244" name="__codelineno-10-244" href="#__codelineno-10-244"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-10-245" name="__codelineno-10-245" href="#__codelineno-10-245"></a><span class="w">        </span><span class="nt">vm.kubevirt.io/flavor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">medium</span>
<a id="__codelineno-10-246" name="__codelineno-10-246" href="#__codelineno-10-246"></a><span class="w">        </span><span class="nt">vm.kubevirt.io/os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows10</span>
<a id="__codelineno-10-247" name="__codelineno-10-247" href="#__codelineno-10-247"></a><span class="w">        </span><span class="nt">vm.kubevirt.io/workload</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">desktop</span>
<a id="__codelineno-10-248" name="__codelineno-10-248" href="#__codelineno-10-248"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-10-249" name="__codelineno-10-249" href="#__codelineno-10-249"></a><span class="w">        </span><span class="nt">flavor.template.kubevirt.io/medium</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span>
<a id="__codelineno-10-250" name="__codelineno-10-250" href="#__codelineno-10-250"></a><span class="w">        </span><span class="nt">kubevirt.io/domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template</span>
<a id="__codelineno-10-251" name="__codelineno-10-251" href="#__codelineno-10-251"></a><span class="w">        </span><span class="nt">kubevirt.io/size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">medium</span>
<a id="__codelineno-10-252" name="__codelineno-10-252" href="#__codelineno-10-252"></a><span class="w">        </span><span class="nt">os.template.kubevirt.io/win10</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span>
<a id="__codelineno-10-253" name="__codelineno-10-253" href="#__codelineno-10-253"></a><span class="w">        </span><span class="nt">vm.kubevirt.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template</span>
<a id="__codelineno-10-254" name="__codelineno-10-254" href="#__codelineno-10-254"></a><span class="w">        </span><span class="nt">workload.template.kubevirt.io/desktop</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;true&#39;</span>
<a id="__codelineno-10-255" name="__codelineno-10-255" href="#__codelineno-10-255"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-10-256" name="__codelineno-10-256" href="#__codelineno-10-256"></a><span class="w">      </span><span class="nt">domain</span><span class="p">:</span>
<a id="__codelineno-10-257" name="__codelineno-10-257" href="#__codelineno-10-257"></a><span class="w">        </span><span class="nt">clock</span><span class="p">:</span>
<a id="__codelineno-10-258" name="__codelineno-10-258" href="#__codelineno-10-258"></a><span class="w">          </span><span class="nt">timer</span><span class="p">:</span>
<a id="__codelineno-10-259" name="__codelineno-10-259" href="#__codelineno-10-259"></a><span class="w">            </span><span class="nt">hpet</span><span class="p">:</span>
<a id="__codelineno-10-260" name="__codelineno-10-260" href="#__codelineno-10-260"></a><span class="w">              </span><span class="nt">present</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-10-261" name="__codelineno-10-261" href="#__codelineno-10-261"></a><span class="w">            </span><span class="nt">hyperv</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-262" name="__codelineno-10-262" href="#__codelineno-10-262"></a><span class="w">            </span><span class="nt">pit</span><span class="p">:</span>
<a id="__codelineno-10-263" name="__codelineno-10-263" href="#__codelineno-10-263"></a><span class="w">              </span><span class="nt">tickPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delay</span>
<a id="__codelineno-10-264" name="__codelineno-10-264" href="#__codelineno-10-264"></a><span class="w">            </span><span class="nt">rtc</span><span class="p">:</span>
<a id="__codelineno-10-265" name="__codelineno-10-265" href="#__codelineno-10-265"></a><span class="w">              </span><span class="nt">tickPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">catchup</span>
<a id="__codelineno-10-266" name="__codelineno-10-266" href="#__codelineno-10-266"></a><span class="w">          </span><span class="nt">utc</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-267" name="__codelineno-10-267" href="#__codelineno-10-267"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span>
<a id="__codelineno-10-268" name="__codelineno-10-268" href="#__codelineno-10-268"></a><span class="w">          </span><span class="nt">cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-10-269" name="__codelineno-10-269" href="#__codelineno-10-269"></a><span class="w">          </span><span class="nt">sockets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-10-270" name="__codelineno-10-270" href="#__codelineno-10-270"></a><span class="w">          </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-10-271" name="__codelineno-10-271" href="#__codelineno-10-271"></a><span class="w">        </span><span class="nt">devices</span><span class="p">:</span>
<a id="__codelineno-10-272" name="__codelineno-10-272" href="#__codelineno-10-272"></a><span class="w">          </span><span class="nt">disks</span><span class="p">:</span>
<a id="__codelineno-10-273" name="__codelineno-10-273" href="#__codelineno-10-273"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bootOrder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-10-274" name="__codelineno-10-274" href="#__codelineno-10-274"></a><span class="w">              </span><span class="nt">disk</span><span class="p">:</span>
<a id="__codelineno-10-275" name="__codelineno-10-275" href="#__codelineno-10-275"></a><span class="w">                </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-10-276" name="__codelineno-10-276" href="#__codelineno-10-276"></a><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template</span>
<a id="__codelineno-10-277" name="__codelineno-10-277" href="#__codelineno-10-277"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bootOrder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id="__codelineno-10-278" name="__codelineno-10-278" href="#__codelineno-10-278"></a><span class="w">              </span><span class="nt">cdrom</span><span class="p">:</span>
<a id="__codelineno-10-279" name="__codelineno-10-279" href="#__codelineno-10-279"></a><span class="w">                </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sata</span>
<a id="__codelineno-10-280" name="__codelineno-10-280" href="#__codelineno-10-280"></a><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows-iso</span>
<a id="__codelineno-10-281" name="__codelineno-10-281" href="#__codelineno-10-281"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cdrom</span><span class="p">:</span>
<a id="__codelineno-10-282" name="__codelineno-10-282" href="#__codelineno-10-282"></a><span class="w">                </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sata</span>
<a id="__codelineno-10-283" name="__codelineno-10-283" href="#__codelineno-10-283"></a><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows-guest-tools</span>
<a id="__codelineno-10-284" name="__codelineno-10-284" href="#__codelineno-10-284"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep</span>
<a id="__codelineno-10-285" name="__codelineno-10-285" href="#__codelineno-10-285"></a><span class="w">              </span><span class="nt">cdrom</span><span class="p">:</span>
<a id="__codelineno-10-286" name="__codelineno-10-286" href="#__codelineno-10-286"></a><span class="w">                </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sata</span>
<a id="__codelineno-10-287" name="__codelineno-10-287" href="#__codelineno-10-287"></a><span class="w">          </span><span class="nt">inputs</span><span class="p">:</span>
<a id="__codelineno-10-288" name="__codelineno-10-288" href="#__codelineno-10-288"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">usb</span>
<a id="__codelineno-10-289" name="__codelineno-10-289" href="#__codelineno-10-289"></a><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tablet</span>
<a id="__codelineno-10-290" name="__codelineno-10-290" href="#__codelineno-10-290"></a><span class="w">              </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tablet</span>
<a id="__codelineno-10-291" name="__codelineno-10-291" href="#__codelineno-10-291"></a><span class="w">          </span><span class="nt">interfaces</span><span class="p">:</span>
<a id="__codelineno-10-292" name="__codelineno-10-292" href="#__codelineno-10-292"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">masquerade</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-293" name="__codelineno-10-293" href="#__codelineno-10-293"></a><span class="w">              </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtio</span>
<a id="__codelineno-10-294" name="__codelineno-10-294" href="#__codelineno-10-294"></a><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-10-295" name="__codelineno-10-295" href="#__codelineno-10-295"></a><span class="w">        </span><span class="nt">features</span><span class="p">:</span>
<a id="__codelineno-10-296" name="__codelineno-10-296" href="#__codelineno-10-296"></a><span class="w">          </span><span class="nt">acpi</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-297" name="__codelineno-10-297" href="#__codelineno-10-297"></a><span class="w">          </span><span class="nt">apic</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-298" name="__codelineno-10-298" href="#__codelineno-10-298"></a><span class="w">          </span><span class="nt">hyperv</span><span class="p">:</span>
<a id="__codelineno-10-299" name="__codelineno-10-299" href="#__codelineno-10-299"></a><span class="w">            </span><span class="nt">reenlightenment</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-300" name="__codelineno-10-300" href="#__codelineno-10-300"></a><span class="w">            </span><span class="nt">ipi</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-301" name="__codelineno-10-301" href="#__codelineno-10-301"></a><span class="w">            </span><span class="nt">synic</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-302" name="__codelineno-10-302" href="#__codelineno-10-302"></a><span class="w">            </span><span class="nt">synictimer</span><span class="p">:</span>
<a id="__codelineno-10-303" name="__codelineno-10-303" href="#__codelineno-10-303"></a><span class="w">              </span><span class="nt">direct</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-304" name="__codelineno-10-304" href="#__codelineno-10-304"></a><span class="w">            </span><span class="nt">spinlocks</span><span class="p">:</span>
<a id="__codelineno-10-305" name="__codelineno-10-305" href="#__codelineno-10-305"></a><span class="w">              </span><span class="nt">spinlocks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8191</span>
<a id="__codelineno-10-306" name="__codelineno-10-306" href="#__codelineno-10-306"></a><span class="w">            </span><span class="nt">reset</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-307" name="__codelineno-10-307" href="#__codelineno-10-307"></a><span class="w">            </span><span class="nt">relaxed</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-308" name="__codelineno-10-308" href="#__codelineno-10-308"></a><span class="w">            </span><span class="nt">vpindex</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-309" name="__codelineno-10-309" href="#__codelineno-10-309"></a><span class="w">            </span><span class="nt">runtime</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-310" name="__codelineno-10-310" href="#__codelineno-10-310"></a><span class="w">            </span><span class="nt">tlbflush</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-311" name="__codelineno-10-311" href="#__codelineno-10-311"></a><span class="w">            </span><span class="nt">frequencies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-312" name="__codelineno-10-312" href="#__codelineno-10-312"></a><span class="w">            </span><span class="nt">vapic</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-313" name="__codelineno-10-313" href="#__codelineno-10-313"></a><span class="w">        </span><span class="nt">machine</span><span class="p">:</span>
<a id="__codelineno-10-314" name="__codelineno-10-314" href="#__codelineno-10-314"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pc-q35-rhel8.4.0</span>
<a id="__codelineno-10-315" name="__codelineno-10-315" href="#__codelineno-10-315"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-10-316" name="__codelineno-10-316" href="#__codelineno-10-316"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-10-317" name="__codelineno-10-317" href="#__codelineno-10-317"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4Gi</span>
<a id="__codelineno-10-318" name="__codelineno-10-318" href="#__codelineno-10-318"></a><span class="w">      </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template</span>
<a id="__codelineno-10-319" name="__codelineno-10-319" href="#__codelineno-10-319"></a><span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-10-320" name="__codelineno-10-320" href="#__codelineno-10-320"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-10-321" name="__codelineno-10-321" href="#__codelineno-10-321"></a><span class="w">          </span><span class="nt">pod</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-10-322" name="__codelineno-10-322" href="#__codelineno-10-322"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-10-323" name="__codelineno-10-323" href="#__codelineno-10-323"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dataVolume</span><span class="p">:</span>
<a id="__codelineno-10-324" name="__codelineno-10-324" href="#__codelineno-10-324"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-iso</span>
<a id="__codelineno-10-325" name="__codelineno-10-325" href="#__codelineno-10-325"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows-iso</span>
<a id="__codelineno-10-326" name="__codelineno-10-326" href="#__codelineno-10-326"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dataVolume</span><span class="p">:</span>
<a id="__codelineno-10-327" name="__codelineno-10-327" href="#__codelineno-10-327"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template-windows-iso</span>
<a id="__codelineno-10-328" name="__codelineno-10-328" href="#__codelineno-10-328"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template</span>
<a id="__codelineno-10-329" name="__codelineno-10-329" href="#__codelineno-10-329"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerDisk</span><span class="p">:</span>
<a id="__codelineno-10-330" name="__codelineno-10-330" href="#__codelineno-10-330"></a><span class="w">            </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/kubevirt/virtio-container-disk</span>
<a id="__codelineno-10-331" name="__codelineno-10-331" href="#__codelineno-10-331"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">windows-guest-tools</span>
<a id="__codelineno-10-332" name="__codelineno-10-332" href="#__codelineno-10-332"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep</span>
<a id="__codelineno-10-333" name="__codelineno-10-333" href="#__codelineno-10-333"></a><span class="w">          </span><span class="nt">sysprep</span><span class="p">:</span>
<a id="__codelineno-10-334" name="__codelineno-10-334" href="#__codelineno-10-334"></a><span class="w">            </span><span class="nt">configMap</span><span class="p">:</span>
<a id="__codelineno-10-335" name="__codelineno-10-335" href="#__codelineno-10-335"></a><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">win10-template-configmap</span>
</code></pre></div>
<h3 id="launching-a-vm-from-template">Launching a VM from template<a class="headerlink" href="#launching-a-vm-from-template" title="Permanent link">&para;</a></h3>
<p>From the above example after the sysprep command is executed in the <code>post-install.ps1</code> and the vm is in shutdown state,
A new VM can be launched from the base <code>win10-template</code> with additional changes mentioned from the below <code>unattend.xml</code> in <code>sysprep-config</code>.
The new VM can take upto 5 minutes to be in running state since Windows goes through oobe setup in the background with the customizations specified in the below <code>unattend.xml</code> file.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sysprep-config</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">  </span><span class="nt">autounattend.xml</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="no">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="no">&lt;!-- responsible for installing windows, ignored on sysprepped images --&gt;</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">  </span><span class="nt">unattend.xml</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span><span class="no">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">    </span><span class="no">&lt;unattend xmlns=&quot;urn:schemas-microsoft-com:unattend&quot;&gt;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">      </span><span class="no">&lt;settings pass=&quot;oobeSystem&quot;&gt;</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">        </span><span class="no">&lt;component xmlns:wcm=&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; name=&quot;Microsoft-Windows-Shell-Setup&quot; processorArchitecture=&quot;amd64&quot; publicKeyToken=&quot;31bf3856ad364e35&quot; language=&quot;neutral&quot; versionScope=&quot;nonSxS&quot;&gt;</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">          </span><span class="no">&lt;OOBE&gt;</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">            </span><span class="no">&lt;HideEULAPage&gt;true&lt;/HideEULAPage&gt;</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">            </span><span class="no">&lt;HideOEMRegistrationScreen&gt;true&lt;/HideOEMRegistrationScreen&gt;</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">            </span><span class="no">&lt;HideOnlineAccountScreens&gt;true&lt;/HideOnlineAccountScreens&gt;</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">            </span><span class="no">&lt;HideWirelessSetupInOOBE&gt;true&lt;/HideWirelessSetupInOOBE&gt;</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">            </span><span class="no">&lt;NetworkLocation&gt;Work&lt;/NetworkLocation&gt;</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">            </span><span class="no">&lt;SkipUserOOBE&gt;true&lt;/SkipUserOOBE&gt;</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">            </span><span class="no">&lt;SkipMachineOOBE&gt;true&lt;/SkipMachineOOBE&gt;</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">            </span><span class="no">&lt;ProtectYourPC&gt;3&lt;/ProtectYourPC&gt;</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">          </span><span class="no">&lt;/OOBE&gt;</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">          </span><span class="no">&lt;AutoLogon&gt;</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">            </span><span class="no">&lt;Password&gt;</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">            </span><span class="no">&lt;Value&gt;123456&lt;/Value&gt;</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="w">              </span><span class="no">&lt;PlainText&gt;true&lt;/PlainText&gt;</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="w">            </span><span class="no">&lt;/Password&gt;</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="w">            </span><span class="no">&lt;Enabled&gt;true&lt;/Enabled&gt;</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="w">        </span><span class="no">&lt;Username&gt;Administrator&lt;/Username&gt;</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="w">    </span><span class="no">&lt;/AutoLogon&gt;</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="w">    </span><span class="no">&lt;UserAccounts&gt;</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="w">         </span><span class="no">&lt;AdministratorPassword&gt;</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">                </span><span class="no">&lt;Value&gt;123456&lt;/Value&gt;</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="w">                </span><span class="no">&lt;PlainText&gt;true&lt;/PlainText&gt;</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="w">        </span><span class="no">&lt;/AdministratorPassword&gt;</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="w">          </span><span class="no">&lt;/UserAccounts&gt;</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="w">          </span><span class="no">&lt;RegisteredOrganization&gt;Kuebvirt&lt;/RegisteredOrganization&gt;</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="w">          </span><span class="no">&lt;RegisteredOwner&gt;Kubevirt&lt;/RegisteredOwner&gt;</span>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="w">          </span><span class="no">&lt;TimeZone&gt;Eastern Standard Time&lt;/TimeZone&gt;</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="w">                </span><span class="no">&lt;FirstLogonCommands&gt;</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a><span class="w">                    </span><span class="no">&lt;SynchronousCommand wcm:action=&quot;add&quot;&gt;</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="w">                    </span><span class="no">&lt;CommandLine&gt;powershell -ExecutionPolicy Bypass -NoExit -WindowStyle Hidden -NoProfile d:\customize.ps1&lt;/CommandLine&gt;</span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="w">                        </span><span class="no">&lt;RequiresUserInput&gt;false&lt;/RequiresUserInput&gt;</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="w">                        </span><span class="no">&lt;Order&gt;1&lt;/Order&gt;</span>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="w">                </span><span class="no">&lt;Description&gt;Customize Script&lt;/Description&gt;</span>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a><span class="w">            </span><span class="no">&lt;/SynchronousCommand&gt;</span>
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a><span class="w">                </span><span class="no">&lt;/FirstLogonCommands&gt;</span>
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a><span class="w">        </span><span class="no">&lt;/component&gt;</span>
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a><span class="w">      </span><span class="no">&lt;/settings&gt;</span>
<a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a><span class="w">    </span><span class="no">&lt;/unattend&gt;</span>
<a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a><span class="w">  </span><span class="nt">customize.ps1</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a><span class="w">    </span><span class="no"># Enable RDP</span>
<a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a><span class="w">    </span><span class="no">Set-ItemProperty -Path &#39;HKLM:\System\CurrentControlSet\Control\Terminal Server&#39; -name &quot;fDenyTSConnections&quot; -value 0</span>
<a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a><span class="w">    </span><span class="no">Enable-NetFirewallRule -DisplayGroup &quot;Remote Desktop&quot;</span>
<a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a>
<a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a>
<a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a><span class="w">    </span><span class="no"># https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse</span>
<a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a><span class="w">    </span><span class="no"># Install the OpenSSH Server</span>
<a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a><span class="w">    </span><span class="no">Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0</span>
<a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a><span class="w">    </span><span class="no"># Start the sshd service</span>
<a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a><span class="w">    </span><span class="no">Start-Service sshd</span>
<a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a>
<a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a><span class="w">    </span><span class="no">Set-Service -Name sshd -StartupType &#39;Automatic&#39;</span>
<a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>
<a id="__codelineno-11-66" name="__codelineno-11-66" href="#__codelineno-11-66"></a><span class="w">    </span><span class="no"># https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_server_configuration</span>
<a id="__codelineno-11-67" name="__codelineno-11-67" href="#__codelineno-11-67"></a><span class="w">    </span><span class="no"># use powershell as default shell for ssh</span>
<a id="__codelineno-11-68" name="__codelineno-11-68" href="#__codelineno-11-68"></a><span class="w">    </span><span class="no">New-ItemProperty -Path &quot;HKLM:\SOFTWARE\OpenSSH&quot; -Name DefaultShell -Value &quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe&quot; -PropertyType String -Force</span>
<a id="__codelineno-11-69" name="__codelineno-11-69" href="#__codelineno-11-69"></a>
<a id="__codelineno-11-70" name="__codelineno-11-70" href="#__codelineno-11-70"></a>
<a id="__codelineno-11-71" name="__codelineno-11-71" href="#__codelineno-11-71"></a><span class="w">    </span><span class="no"># Add ssh authorized_key for administrator</span>
<a id="__codelineno-11-72" name="__codelineno-11-72" href="#__codelineno-11-72"></a><span class="w">    </span><span class="no"># https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_keymanagement</span>
<a id="__codelineno-11-73" name="__codelineno-11-73" href="#__codelineno-11-73"></a><span class="w">    </span><span class="no">$MyDir = $MyInvocation.MyCommand.Path | Split-Path -Parent</span>
<a id="__codelineno-11-74" name="__codelineno-11-74" href="#__codelineno-11-74"></a><span class="w">    </span><span class="no">$PublicKey = Get-Content -Path $MyDir\id_rsa.pub</span>
<a id="__codelineno-11-75" name="__codelineno-11-75" href="#__codelineno-11-75"></a><span class="w">    </span><span class="no">$authrized_keys_path = $env:ProgramData + &quot;\ssh\administrators_authorized_keys&quot; </span>
<a id="__codelineno-11-76" name="__codelineno-11-76" href="#__codelineno-11-76"></a><span class="w">    </span><span class="no">Add-Content -Path $authrized_keys_path -Value $PublicKey</span>
<a id="__codelineno-11-77" name="__codelineno-11-77" href="#__codelineno-11-77"></a><span class="w">    </span><span class="no">icacls.exe $authrized_keys_path /inheritance:r /grant &quot;Administrators:F&quot; /grant &quot;SYSTEM:F&quot;</span>
<a id="__codelineno-11-78" name="__codelineno-11-78" href="#__codelineno-11-78"></a>
<a id="__codelineno-11-79" name="__codelineno-11-79" href="#__codelineno-11-79"></a>
<a id="__codelineno-11-80" name="__codelineno-11-80" href="#__codelineno-11-80"></a><span class="w">    </span><span class="no"># install application via exe file installer from url</span>
<a id="__codelineno-11-81" name="__codelineno-11-81" href="#__codelineno-11-81"></a><span class="w">    </span><span class="no">function Install-Exe {</span>
<a id="__codelineno-11-82" name="__codelineno-11-82" href="#__codelineno-11-82"></a><span class="w">      </span><span class="no">$dlurl = $args[0]</span>
<a id="__codelineno-11-83" name="__codelineno-11-83" href="#__codelineno-11-83"></a><span class="w">      </span><span class="no">$installerPath = Join-Path $env:TEMP (Split-Path $dlurl -Leaf)</span>
<a id="__codelineno-11-84" name="__codelineno-11-84" href="#__codelineno-11-84"></a><span class="w">      </span><span class="no">Invoke-WebRequest -UseBasicParsing $dlurl -OutFile $installerPath</span>
<a id="__codelineno-11-85" name="__codelineno-11-85" href="#__codelineno-11-85"></a><span class="w">      </span><span class="no">Start-Process -FilePath $installerPath -Args &quot;/S&quot; -Verb RunAs -Wait</span>
<a id="__codelineno-11-86" name="__codelineno-11-86" href="#__codelineno-11-86"></a><span class="w">      </span><span class="no">Remove-Item $installerPath</span>
<a id="__codelineno-11-87" name="__codelineno-11-87" href="#__codelineno-11-87"></a>
<a id="__codelineno-11-88" name="__codelineno-11-88" href="#__codelineno-11-88"></a><span class="w">    </span><span class="no">}</span>
<a id="__codelineno-11-89" name="__codelineno-11-89" href="#__codelineno-11-89"></a>
<a id="__codelineno-11-90" name="__codelineno-11-90" href="#__codelineno-11-90"></a><span class="w">    </span><span class="no"># Wait for networking before running a task at startup</span>
<a id="__codelineno-11-91" name="__codelineno-11-91" href="#__codelineno-11-91"></a><span class="w">    </span><span class="no">do {</span>
<a id="__codelineno-11-92" name="__codelineno-11-92" href="#__codelineno-11-92"></a><span class="w">      </span><span class="no">$ping = test-connection -comp kubevirt.io -count 1 -Quiet</span>
<a id="__codelineno-11-93" name="__codelineno-11-93" href="#__codelineno-11-93"></a><span class="w">    </span><span class="no">} until ($ping)</span>
<a id="__codelineno-11-94" name="__codelineno-11-94" href="#__codelineno-11-94"></a>
<a id="__codelineno-11-95" name="__codelineno-11-95" href="#__codelineno-11-95"></a><span class="w">    </span><span class="no"># Installing the Latest Notepad++ with PowerShell</span>
<a id="__codelineno-11-96" name="__codelineno-11-96" href="#__codelineno-11-96"></a><span class="w">    </span><span class="no">$BaseUri = &quot;https://notepad-plus-plus.org&quot;</span>
<a id="__codelineno-11-97" name="__codelineno-11-97" href="#__codelineno-11-97"></a><span class="w">    </span><span class="no">$BasePage = Invoke-WebRequest -Uri $BaseUri -UseBasicParsing</span>
<a id="__codelineno-11-98" name="__codelineno-11-98" href="#__codelineno-11-98"></a><span class="w">    </span><span class="no">$ChildPath = $BasePage.Links | Where-Object { $_.outerHTML -like &#39;*Current Version*&#39; } | Select-Object -ExpandProperty href</span>
<a id="__codelineno-11-99" name="__codelineno-11-99" href="#__codelineno-11-99"></a><span class="w">    </span><span class="no">$DownloadPageUri = $BaseUri + $ChildPath</span>
<a id="__codelineno-11-100" name="__codelineno-11-100" href="#__codelineno-11-100"></a><span class="w">    </span><span class="no">$DownloadPage = Invoke-WebRequest -Uri $DownloadPageUri -UseBasicParsing</span>
<a id="__codelineno-11-101" name="__codelineno-11-101" href="#__codelineno-11-101"></a><span class="w">    </span><span class="no">$DownloadUrl = $DownloadPage.Links | Where-Object { $_.outerHTML -like &#39;*npp.*.Installer.x64.exe&quot;*&#39; } | Select-Object -ExpandProperty href</span>
<a id="__codelineno-11-102" name="__codelineno-11-102" href="#__codelineno-11-102"></a><span class="w">    </span><span class="no">Install-Exe $DownloadUrl</span>
<a id="__codelineno-11-103" name="__codelineno-11-103" href="#__codelineno-11-103"></a><span class="w">  </span><span class="nt">id_rsa.pub</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<a id="__codelineno-11-104" name="__codelineno-11-104" href="#__codelineno-11-104"></a><span class="w">    </span><span class="no">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6zdgFiLr1uAK7PdcchDd+LseA5fEOcxCCt7TLlr7Mx6h8jUg+G+8L9JBNZuDzTZSF0dR7qwzdBBQjorAnZTmY3BhsKcFr8Gt4KMGrS6r3DNmGruP8GORvegdWZuXgASKVpXeI7nCIjRJwAaK1x+eGHwAWO9Z8ohcboHbLyffOoSZDSIuk2kRIc47+ENRjg0T6x2VRsqX27g6j4DfPKQZGk0zvXkZaYtr1e2tZgqTBWqZUloMJK8miQq6MktCKAS4VtPk0k7teQX57OGwD6D7uo4b+Cl8aYAAwhn0hc0C2USfbuVHgq88ESo2/+NwV4SQcl3sxCW21yGIjAGt4Hy7J fedora@localhost.localdomain</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../boot_from_external_source/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Booting From External Source">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Booting From External Source
              </div>
            </div>
          </a>
        
        
          
          <a href="../windows_virtio_drivers/" class="md-footer__link md-footer__link--next" aria-label="Next: Windows virtio drivers">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Windows virtio drivers
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.footer", "navigation.tabs", "navigation.tabs.sticky", "content.action.view", "content.action.edit"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>