<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>KubeVirt Latest | Creating Virtual Machines | Disks and Volumes</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="https://kubevirt.io/"><img alt="Kubevirt" height="64px" src="../../latest/_images/KubeVirt_icon.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Documentation</a>
      </li>
      <li class="hidden-xs active">
        <a href="../welcome/index.html">KubeVirt Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../creating-virtual-machines/intro.html">Creating Virtual Machines</a>
      </li>
      
      <li class="hidden-xs active">
        Disks and Volumes
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Welcome
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Release Notes
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../release-notes/changelog.html">Changelog</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../architecture/virtual-machine.html">Virtual Machines</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Installation & Administration
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../administration/intro.html">Installation</a></li>
            <li><a class="" href="../administration/api-validation.html">Webhooks</a></li>
            <li><a class="" href="../administration/authorization.html">Authorization</a></li>
            <li><a class="" href="../administration/monitoring.html">Monitoring</a></li>
            <li><a class="" href="../administration/annotations_and_labels.html">Annotations and Labels</a></li>
            <li><a class="" href="../administration/unresponsive-nodes.html">Unresponsive node handling</a></li>
            <li><a class="" href="../administration/node-eviction.html">Node eviciton</a></li>
            <li><a class="" href="../administration/image-upload.html">Image upload</a></li>
            <li><a class="" href="../administration/live-migration.html">Live Migration</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-down"></span>Creating Virtual Machines
      </a>
      <ul id="topicGroup4" class="collapse in list-unstyled">
            <li><a class="" href="../creating-virtual-machines/intro.html">Introduction</a></li>
            <li><a class="" href="../creating-virtual-machines/virtualized-hardware-configuration.html">Devices</a></li>
            <li><a class=" active" href="../creating-virtual-machines/disks-and-volumes.html">Disks and Volumes</a></li>
            <li><a class="" href="../creating-virtual-machines/interfaces-and-networks.html">Interfaces and Networks</a></li>
            <li><a class="" href="../creating-virtual-machines/dedicated-cpu.html">Guaranteed CPU usage</a></li>
            <li><a class="" href="../creating-virtual-machines/startup-scripts.html">cloud-init</a></li>
            <li><a class="" href="../creating-virtual-machines/guest-operating-system-information.html">Associating Guest Informations</a></li>
            <li><a class="" href="../creating-virtual-machines/virtio-win.html">virtio drivers for Microsoft Windows</a></li>
            <li><a class="" href="../creating-virtual-machines/presets.html">Presets</a></li>
            <li><a class="" href="../creating-virtual-machines/probes.html">Probes</a></li>
            <li><a class="" href="../creating-virtual-machines/run-strategies.html">Run Strategies</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>Using Virtual Machines
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../using-virtual-machines/usage.html">Usage</a></li>
            <li><a class="" href="../using-virtual-machines/life-cycle.html">Starting and Stopping</a></li>
            <li><a class="" href="../using-virtual-machines/graphical-and-console-access.html">Console Access (Serial and Graphical)</a></li>
            <li><a class="" href="../using-virtual-machines/assigning-vms-to-nodes.html">Node placement</a></li>
            <li><a class="" href="../using-virtual-machines/dns.html">DNS Integration</a></li>
            <li><a class="" href="../using-virtual-machines/expose-service.html">Service Integration</a></li>
            <li><a class="" href="../using-virtual-machines/create-networkpolicy.html">Assigning Network Policies</a></li>
            <li><a class="" href="../using-virtual-machines/overcommit.html">Memory over-commit</a></li>
            <li><a class="" href="../using-virtual-machines/virtual-machine-replica-set.html">Virtual Machine Replica Set</a></li>
            <li><a class="" href="../using-virtual-machines/vmctl.html">vmctl</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup6">
        <span id="tgSpan6" class="fa fa-angle-right"></span>Working with Templates
      </a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li><a class="" href="../templates/common-templates.html">Introduction</a></li>
            <li><a class="" href="../templates/using-templates.html">Using templates</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup7">
        <span id="tgSpan7" class="fa fa-angle-right"></span>Web Interface
      </a>
      <ul id="topicGroup7" class="collapse  list-unstyled">
            <li><a class="" href="../web-interface/web-interface.html">Web Interface</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Disks and Volumes</h2>
        </div>
        <div class="sect1">
<h2 id="disks-and-volumes"><a class="anchor" href="#disks-and-volumes"></a>Disks and Volumes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Making persistent storage in the cluster (<strong>volumes</strong>) accessible to VMs
consists of three parts. First, volumes are specified in <code>spec.volumes</code>.
Second, disks are added to the VM by specifying them in
<code>spec.domain.devices.disks</code>. Finally, a refererence to the specified
volume is added to the disk specification by name.</p>
</div>
<div class="sect2">
<h3 id="disks"><a class="anchor" href="#disks"></a>Disks</h3>
<div class="paragraph">
<p>Like all other vmi devices a <code>spec.domain.devices.disks</code> element has a
mandatory <code>name</code>, and furthermore, the disk&#8217;s <code>name</code> must reference the <code>name</code>
of a volume inside <code>spec.volumes</code>.</p>
</div>
<div class="paragraph">
<p>A disk can be made accessible via four different types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#lun"><strong>lun</strong></a></p>
</li>
<li>
<p><a href="#disk"><strong>disk</strong></a></p>
</li>
<li>
<p><a href="#cdrom"><strong>cdrom</strong></a></p>
</li>
<li>
<p><a href="#floppy"><strong>floppy</strong></a> <em>DEPRECATED</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All possible configuration options are available in the
<a href="https://kubevirt.github.io/api-reference/master/definitions.html#_v1_disk">Disk
API Reference</a>.</p>
</div>
<div class="paragraph">
<p>All types, with the exception of <strong>floppy</strong>, allow you to specify the
<code>bus</code> attribute. The <code>bus</code> attribute determines how the disk will be
presented to the guest operating system. <strong>floppy</strong> disks don’t support
the <code>bus</code> attribute: they are always attached to the <code>fdc</code> bus.</p>
</div>
<div class="sect3">
<h4 id="lun"><a class="anchor" href="#lun"></a>lun</h4>
<div class="paragraph">
<p>A <code>lun</code> disk will expose the volume as a LUN device to the VM. This
allows the VM to execute arbitrary iSCSI command passthrough.</p>
</div>
<div class="paragraph">
<p>A minimal example which attaches a <code>PersistentVolumeClaim</code> named <code>mypvc</code>
as a <code>lun</code> device to the VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-lun</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#777"># This makes it a lun device</span>
        <span style="color:#606">lun</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="disk"><a class="anchor" href="#disk"></a>disk</h4>
<div class="paragraph">
<p>A <code>disk</code> disk will expose the volume as an ordinary disk to the VM.</p>
</div>
<div class="paragraph">
<p>A minimal example which attaches a <code>PersistentVolumeClaim</code> named <code>mypvc</code>
as a <code>disk</code> device to the VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-disk</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#777"># This makes it a disk</span>
        <span style="color:#606">disk</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can set the disk <code>bus</code> type, overriding the defaults, which in turn
depends on the chipset the VM is configured to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-disk</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#777"># This makes it a disk</span>
        <span style="color:#606">disk</span>:
          <span style="color:#777"># This makes it exposed as /dev/vda, being the only and thus first</span>
          <span style="color:#777"># disk attached to the VM</span>
          <span style="color:#606">bus</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">virtio</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="floppy"><a class="anchor" href="#floppy"></a>floppy</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note</strong>: Starting with version 0.16.0, floppy disks are deprecated and will be <strong>rejected</strong>. They will be removed from
the API in a future version.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>A <code>floppy</code> disk will expose the volume as a floppy drive to the VM.</p>
</div>
<div class="paragraph">
<p>A minimal example which attaches a <code>PersistentVolumeClaim</code> named <code>mypvc</code>
as a <code>floppy</code> device to the VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-floppy</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#777"># This makes it a floppy</span>
        <span style="color:#606">floppy</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cdrom"><a class="anchor" href="#cdrom"></a>cdrom</h4>
<div class="paragraph">
<p>A <code>cdrom</code> disk will expose the volume as a cdrom drive to the VM. It is
read-only by default.</p>
</div>
<div class="paragraph">
<p>A minimal example which attaches a <code>PersistentVolumeClaim</code> named <code>mypvc</code>
as a <code>floppy</code> device to the VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-cdrom</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#777"># This makes it a cdrom</span>
        <span style="color:#606">cdrom</span>:
          <span style="color:#777"># This makes the cdrom writeable</span>
          <span style="color:#606">readOnly</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
          <span style="color:#777"># This makes the cdrom be exposed as SATA device</span>
          <span style="color:#606">bus</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">sata</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="volumes"><a class="anchor" href="#volumes"></a>Volumes</h3>
<div class="paragraph">
<p>Supported volume sources are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#cloudinitnocloud"><strong>cloudInitNoCloud</strong></a></p>
</li>
<li>
<p><a href="#cloudinitconfigdrive"><strong>cloudInitConfigDrive</strong></a></p>
</li>
<li>
<p><a href="#persistentvolumeclaim"><strong>persistentVolumeClaim</strong></a></p>
</li>
<li>
<p><a href="#ephemeral"><strong>ephemeral</strong></a></p>
</li>
<li>
<p><a href="#containerdisk"><strong>containerDisk</strong></a></p>
</li>
<li>
<p><a href="#emptydisk"><strong>emptyDisk</strong></a></p>
</li>
<li>
<p><a href="#hostdisk"><strong>hostDisk</strong></a></p>
</li>
<li>
<p><a href="#datavolume"><strong>dataVolume</strong></a></p>
</li>
<li>
<p><a href="#configmap"><strong>configMap</strong></a></p>
</li>
<li>
<p><a href="#secret"><strong>secret</strong></a></p>
</li>
<li>
<p><a href="#serviceaccount"><strong>serviceAccount</strong></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All possible configuration options are available in the
<a href="https://kubevirt.github.io/api-reference/master/definitions.html#_v1_volume">Volume
API Reference</a>.</p>
</div>
<div class="sect3">
<h4 id="cloudinitnocloud"><a class="anchor" href="#cloudinitnocloud"></a>cloudInitNoCloud</h4>
<div class="paragraph">
<p>Allows attaching <code>cloudInitNoCloud</code> data-sources to the VM. If the VM
contains a proper cloud-init setup, it will pick up the disk as a
user-data source.</p>
</div>
<div class="paragraph">
<p>A simple example which attaches a <code>Secret</code> as a cloud-init <code>disk</code>
datasource may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-cloudinitnocloud</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mybootdisk</span></span>
        <span style="color:#606">lun</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mynoclouddisk</span></span>
        <span style="color:#606">disk</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mybootdisk</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span>
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mynoclouddisk</span></span>
      <span style="color:#606">cloudInitNoCloud</span>:
        <span style="color:#606">secretRef</span>:
          <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testsecret</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloudinitconfigdrive"><a class="anchor" href="#cloudinitconfigdrive"></a>cloudInitConfigDrive</h4>
<div class="paragraph">
<p>Allows attaching <code>cloudInitConfigDrive</code> data-sources to the VM. If the VM
contains a proper cloud-init setup, it will pick up the disk as a
user-data source.</p>
</div>
<div class="paragraph">
<p>A simple example which attaches a <code>Secret</code> as a cloud-init <code>disk</code>
datasource may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-cloudinitconfigdrive</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mybootdisk</span></span>
        <span style="color:#606">lun</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: myconfigdrivedisk</span></span>
        <span style="color:#606">disk</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mybootdisk</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span>
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: myconfigdrivedisk</span></span>
      <span style="color:#606">cloudInitConfigDrive</span>:
        <span style="color:#606">secretRef</span>:
          <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testsecret</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="persistentvolumeclaim"><a class="anchor" href="#persistentvolumeclaim"></a>persistentVolumeClaim</h4>
<div class="paragraph">
<p>Allows connecting a <code>PersistentVolumeClaim</code> to a VM disk.</p>
</div>
<div class="paragraph">
<p>Use a PersistentVolumeClaim when the VirtualMachineInstance’s disk needs
to persist after the VM terminates. This allows for the VM’s data to
remain persistent between restarts.</p>
</div>
<div class="paragraph">
<p>A <code>PersistentVolume</code> can be in <code>filesystem'' or </code>block'' mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Filesystem: For KubeVirt to be able to consume the disk present on a
PersistentVolume’s filesystem, the disk must be named <code>disk.img</code> and be
placed in the root path of the filesystem. Currently the disk is also
required to be in raw format. &gt; <strong>Important:</strong> The <code>disk.img</code> image file
needs to be owned by the user-id <code>107</code> in order to avoid permission
issues.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note:</strong> If the <code>disk.img</code> image file has not been created manually
before starting a VM then it will be created automatically with the
<code>PersistentVolumeClaim</code> size. Since not every storage provisioner
provides volumes with the exact usable amount of space as requested
(e.g. due to filesystem overhead), KubeVirt tolerates up to 10% less
available space. This can be configured with the
<code>pvc-tolerate-less-space-up-to-percent</code> value in the <code>kubevirt-config</code>
ConfigMap.</p>
</div>
</blockquote>
</div>
</li>
<li>
<p>Block: Use a block volume for consuming raw block devices. Note: you
need to enable the BlockVolume feature gate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A simple example which attaches a <code>PersistentVolumeClaim</code> as a <code>disk</code>
may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-pvc</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#606">lun</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ephemeral"><a class="anchor" href="#ephemeral"></a>ephemeral</h4>
<div class="paragraph">
<p>An ephemeral volume is a local COW (copy on write) image that uses a
network volume as a read-only backing store. With an ephemeral volume,
the network backing store is never mutated. Instead all writes are
stored on the ephemeral image which exists on local storage. KubeVirt
dynamically generates the ephemeral images associated with a VM when the
VM starts, and discards the ephemeral images when the VM stops.</p>
</div>
<div class="paragraph">
<p>Ephemeral volumes are useful in any scenario where disk persistence is
not desired. The COW image is discarded when VM reaches a final state
(e.g., succeeded, failed).</p>
</div>
<div class="paragraph">
<p>Currently, only <code>PersistentVolumeClaim</code> may be used as a backing store
of the ephemeral volume.</p>
</div>
<div class="paragraph">
<p>Up-to-date information on supported backing stores can be found in the
<a href="http://kubevirt.io/api-reference/master/definitions.html#_v1_ephemeralvolumesource">KubeVirt
API</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-ephemeral-pvc</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#606">lun</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
      <span style="color:#606">ephemeral</span>:
        <span style="color:#606">persistentVolumeClaim</span>:
          <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="containerdisk"><a class="anchor" href="#containerdisk"></a>containerDisk</h4>
<div class="paragraph">
<p><strong>containerDisk was originally registryDisk, please update your code when
needed.</strong></p>
</div>
<div class="paragraph">
<p>The <code>containerDisk</code> feature provides the ability to store and distribute
VM disks in the container image registry. <code>containerDisks</code> can be assigned
to VMs in the disks section of the VirtualMachineInstance spec.</p>
</div>
<div class="paragraph">
<p>No network shared storage devices are utilized by <code>containerDisks</code>. The
disks are pulled from the container registry and reside on the local
node hosting the VMs that consume the disks.</p>
</div>
<div class="sect4">
<h5 id="when-to-use-a-containerdisk"><a class="anchor" href="#when-to-use-a-containerdisk"></a>When to use a containerDisk</h5>
<div class="paragraph">
<p><code>containerDisks</code> are ephemeral storage devices that can be assigned to any
number of active VirtualMachineInstances. This makes them an ideal tool
for users who want to replicate a large number of VM workloads that do
not require persistent data. <code>containerDisks</code> are commonly used in
conjunction with VirtualMachineInstanceReplicaSets.</p>
</div>
</div>
<div class="sect4">
<h5 id="when-not-to-use-a-containerdisk"><a class="anchor" href="#when-not-to-use-a-containerdisk"></a>When Not to use a containerDisk</h5>
<div class="paragraph">
<p><code>containerDisks</code> are not a good solution for any workload that requires
persistent root disks across VM restarts.</p>
</div>
</div>
<div class="sect4">
<h5 id="containerdisk-workflow-example"><a class="anchor" href="#containerdisk-workflow-example"></a>containerDisk Workflow Example</h5>
<div class="paragraph">
<p>Users can inject a VirtualMachineInstance disk into a container image in a way
that is consumable by the KubeVirt runtime. Disks must be placed into the
<code>/disk</code> directory inside the container. Raw and qcow2 formats are supported.
Qcow2 is recommended in order to reduce the container image’s size.
Containerdisks can and should be based on <code>scratch</code>. No content except the
image is required.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note:</strong> Prior to kubevirt 0.20, the containerDisk image needed to have
<strong>kubevirt/container-disk-v1alpha</strong> as base image.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Example: Inject a VirtualMachineInstance disk into a container image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#F00;background-color:#FAA">cat &lt;&lt; END &gt; Dockerfile</span>
<span style="color:#F00;background-color:#FAA">FROM scratch</span>
<span style="color:#F00;background-color:#FAA">ADD fedora25.qcow2 /disk/</span>
<span style="color:#F00;background-color:#FAA">END</span>

<span style="color:#F00;background-color:#FAA">docker build -t vmidisks/fedora25:latest .</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example: Upload the ContainerDisk container image to a registry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#F00;background-color:#FAA">docker push vmidisks/fedora25:latest</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example: Attach the ContainerDisk as an ephemeral disk to a VM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-containerdisk</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: containerdisk</span></span>
        <span style="color:#606">disk</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: containerdisk</span></span>
      <span style="color:#606">containerDisk</span>:
        <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmidisks/fedora25:latest</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that a <code>containerDisk</code> is file-based and therefore cannot be
attached as a <code>lun</code> device to the VM.</p>
</div>
</div>
<div class="sect4">
<h5 id="custom-disk-image-path"><a class="anchor" href="#custom-disk-image-path"></a>Custom disk image path</h5>
<div class="paragraph">
<p>ContainerDisk also allows to store disk images in any folder, when
required. The process is the same as previous. The main difference is,
that in custom location, kubevirt does not scan for any image. It is
your responsibility to provide full path for the disk image. Providing
image <code>path</code> is optional. When no <code>path</code> is provided, kubevirt searches
for disk images in default location: <code>/disk</code>.</p>
</div>
<div class="paragraph">
<p>Example: Build container disk image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#F00;background-color:#FAA">cat &lt;&lt; END &gt; Dockerfile</span>
<span style="color:#F00;background-color:#FAA">FROM kubevirt/container-disk-v1alpha</span>
<span style="color:#F00;background-color:#FAA">RUN mkdir /custom-disk-path</span>
<span style="color:#F00;background-color:#FAA">ADD fedora25.qcow2 /custom-disk-path/fedora25.qcow2</span>
<span style="color:#F00;background-color:#FAA">END</span>

<span style="color:#F00;background-color:#FAA">docker build -t vmidisks/fedora25:latest .</span>
<span style="color:#F00;background-color:#FAA">docker push vmidisks/fedora25:latest</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Create VMI with container disk pointing to the custom location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-containerdisk</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: containerdisk</span></span>
        <span style="color:#606">disk</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: containerdisk</span></span>
      <span style="color:#606">containerDisk</span>:
        <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmidisks/fedora25:latest</span></span>
        <span style="color:#606">path</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/custom-disk-path/fedora25.qcow2</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="emptydisk"><a class="anchor" href="#emptydisk"></a>emptyDisk</h4>
<div class="paragraph">
<p>An <code>emptyDisk</code> works similar to an <code>emptyDir</code> in Kubernetes. An extra
sparse <code>qcow2</code> disk will be allocated and it will live as long as the
VM. Thus it will survive guest side VM reboots, but not a VM
re-creation. The disk <code>capacity</code> needs to be specified.</p>
</div>
<div class="paragraph">
<p>Example: Boot cirros with an extra <code>emptyDisk</code> with a size of <code>2GiB</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-nocloud</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">terminationGracePeriodSeconds</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5</span></span>
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: containerdisk</span></span>
        <span style="color:#606">disk</span>:
          <span style="color:#606">bus</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">virtio</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: emptydisk</span></span>
        <span style="color:#606">disk</span>:
          <span style="color:#606">bus</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">virtio</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: containerdisk</span></span>
      <span style="color:#606">containerDisk</span>:
        <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt/cirros-registry-disk-demo:latest</span></span>
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: emptydisk</span></span>
      <span style="color:#606">emptyDisk</span>:
        <span style="color:#606">capacity</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">2Gi</span></span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="when-to-use-an-emptydisk"><a class="anchor" href="#when-to-use-an-emptydisk"></a>When to use an emptyDisk</h5>
<div class="paragraph">
<p>Ephemeral VMs very often come with read-only root images and limited
tmpfs space. In many cases this is not enough to install application
dependencies and provide enough disk space for the application data.
While this data is not critical and thus can be lost, it is still needed
for the application to function properly during its lifetime. This is
where an <code>emptyDisk</code> can be useful. An emptyDisk is often used and
mounted somewhere in <code>/var/lib</code> or <code>/var/run</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hostdisk"><a class="anchor" href="#hostdisk"></a>hostDisk</h4>
<div class="paragraph">
<p>A <code>hostDisk</code> volume type provides the ability to create or use a disk
image located somewhere on a node. It works similar to a <code>hostPath</code> in
Kubernetes and provides two usage types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DiskOrCreate</code> if a disk image does not exist at a given location then
create one</p>
</li>
<li>
<p><code>Disk</code> a disk image must exist at a given location</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example: Create a 1Gi disk image located at /data/disk.img and attach it
to a VM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">metadata</span>:
  <span style="color:#606">labels</span>:
    <span style="color:#606">special</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-host-disk</span></span>
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-host-disk</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">host-disk</span></span>
    <span style="color:#606">machine</span>:
      <span style="color:#606">type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
  <span style="color:#606">terminationGracePeriodSeconds</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">0</span></span>
  <span style="color:#606">volumes</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">hostDisk:</span><span style="color:#D20">
      capacity: 1Gi
      path: /data/disk.img
      type: DiskOrCreate</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">host-disk</span></span>
<span style="color:#606">status</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="datavolume"><a class="anchor" href="#datavolume"></a>dataVolume</h4>
<div class="paragraph">
<p>DataVolumes are a way to automate importing virtual machine disks onto
pvcs during the virtual machine’s launch flow. Without using a
DataVolume, users have to prepare a pvc with a disk image before
assigning it to a VM or VMI manifest. With a DataVolume, both the pvc
creation and import is automated on behalf of the user.</p>
</div>
<div class="sect4">
<h5 id="datavolume-vm-behavior"><a class="anchor" href="#datavolume-vm-behavior"></a>DataVolume VM Behavior</h5>
<div class="paragraph">
<p>DataVolumes can be defined in the VM spec directly by adding the
DataVolumes to the dataVolumeTemplates list. Below is an example.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachine
metadata:
  labels:
    kubevirt.io/vm: vm-alpine-datavolume
  name: vm-alpine-datavolume
spec:
  running: false
  template:
    metadata:
      labels:
        kubevirt.io/vm: vm-alpine-datavolume
    spec:
      domain:
        devices:
          disks:
          - disk:
              bus: virtio
            name: datavolumedisk1
        resources:
          requests:
            memory: 64M
      volumes:
      - dataVolume:
          name: alpine-dv
        name: datavolumedisk1
  dataVolumeTemplates:
  - metadata:
      name: alpine-dv
    spec:
      pvc:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 2Gi
      source:
        http:
          url: http://cdi-http-import-server.kubevirt/images/alpine.iso</pre>
</div>
</div>
<div class="paragraph">
<p>You can see the DataVolume defined in the dataVolumeTemplates section
has two parts. The <strong>source</strong> and <strong>pvc</strong></p>
</div>
<div class="paragraph">
<p>The <strong>source</strong> part declares that there is a disk image living on an http
server that we want to use as a volume for this VM. The <strong>pvc</strong> part
declares the spec that should be used to create the pvc that hosts the
<strong>source</strong> data.</p>
</div>
<div class="paragraph">
<p>When this VM manifest is posted to the cluster, as part of the launch
flow a pvc will be created using the spec provided and the source data
will be automatically imported into that pvc before the VM starts. When
the VM is deleted, the storage provisioned by the DataVolume will
automatically be deleted as well.</p>
</div>
</div>
<div class="sect4">
<h5 id="datavolume-vmi-behavior"><a class="anchor" href="#datavolume-vmi-behavior"></a>DataVolume VMI Behavior</h5>
<div class="paragraph">
<p>For a VMI object, DataVolumes can be referenced as a volume source for
the VMI. When this is done, it is expected that the referenced
DataVolume exists in the cluster. The VMI will consume the DataVolume,
but the DataVolume’s life-cycle will not be tied to the VMI.</p>
</div>
<div class="paragraph">
<p>Below is an example of a DataVolume being referenced by a VMI. It is
expected that the DataVolume <em>alpine-datavolume</em> was created prior to
posting the VMI manifest to the cluster. It is okay to post the VMI
manifest to the cluster while the DataVolume is still having data
imported. KubeVirt knows not to start the VMI until all referenced
DataVolumes have finished their clone and import phases.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachineInstance
metadata:
  labels:
    special: vmi-alpine-datavolume
  name: vmi-alpine-datavolume
spec:
  domain:
    devices:
      disks:
      - disk:
          bus: virtio
        name: disk1
    machine:
      type: ""
    resources:
      requests:
        memory: 64M
  terminationGracePeriodSeconds: 0
  volumes:
  - name: volume1
    dataVolume:
      name: alpine-datavolume</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="enabling-datavolume-support"><a class="anchor" href="#enabling-datavolume-support"></a>Enabling DataVolume support.</h5>
<div class="paragraph">
<p>A DataVolume is a custom resource provided by the Containerized Data
Importer (CDI) project. KubeVirt integrates with CDI in order to provide
users a workflow for dynamically creating pvcs and importing data into
those pvcs.</p>
</div>
<div class="paragraph">
<p>In order to take advantage of the DataVolume volume source on a VM or
VMI, the <strong>DataVolumes</strong> feature gate must be enabled in the
<strong>kubevirt-config</strong> config map before KubeVirt is installed. CDI must also
be installed.</p>
</div>
<div class="paragraph">
<p><strong>Installing CDI</strong></p>
</div>
<div class="paragraph">
<p>Go to the
<a href="https://github.com/kubevirt/containerized-data-importer/releases">CDI
release page</a></p>
</div>
<div class="paragraph">
<p>Pick the latest stable release and post the corresponding
cdi-controller-deployment.yaml manifest to your cluster.</p>
</div>
<div class="paragraph">
<p><strong>Enabling the DataVolumes feature gate</strong></p>
</div>
<div class="paragraph">
<p>Below is an example of how to enable DataVolume support using the
kubevirt-config config map.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &lt;&lt;EOF | kubectl create -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: kubevirt-config
  namespace: kubevirt
  labels:
    kubevirt.io: ""
data:
  feature-gates: "DataVolumes"
EOF</pre>
</div>
</div>
<div class="paragraph">
<p>This config map assumes KubeVirt will be installed in the kubevirt
namespace. Change the namespace to suite your installation.</p>
</div>
<div class="paragraph">
<p>First post the configmap above, then install KubeVirt. At that point
DataVolume integration will be enabled.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configmap"><a class="anchor" href="#configmap"></a>configMap</h4>
<div class="paragraph">
<p>A <code>configMap</code> is a reference to a
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">ConfigMap</a>
in Kubernetes. An extra <code>iso</code> disk will be allocated which has to be
mounted on a VM. To mount the <code>configMap</code> users can use <code>cloudInit</code> and
the disks serial number. The <code>name</code> needs to be set for a reference to
the created kubernetes <code>ConfigMap</code>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note:</strong> Currently, ConfigMap update propagation is not supported. If a
ConfigMap is updated, only a pod will be aware of changes, not running
VMIs.</p>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note:</strong> Due to a Kubernetes CRD
<a href="https://github.com/kubernetes/kubernetes/issues/68466">issue</a>, you cannot
control the paths within the volume where ConfigMap keys are projected.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Example: Attach the <code>configMap</code> to a VM and use <code>cloudInit</code> to mount the
<code>iso</code> disk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">metadata</span>:
  <span style="color:#606">labels</span>:
    <span style="color:#606">special</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-fedora</span></span>
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-fedora</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">containerdisk</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">cloudinitdisk</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk: {}</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">app-config-disk</span></span>
        <span style="color:#777"># set serial</span>
        <span style="color:#606">serial</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">CVLY623300HK240D</span></span>
    <span style="color:#606">machine</span>:
      <span style="color:#606">type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1024M</span></span>
  <span style="color:#606">terminationGracePeriodSeconds</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">0</span></span>
  <span style="color:#606">volumes</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: containerdisk</span></span>
    <span style="color:#606">containerDisk</span>:
      <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt/fedora-cloud-container-disk-demo:latest</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">cloudInitNoCloud:</span><span style="color:#D20">
      userData: |-
        #cloud-config
        password: fedora
        chpasswd: { expire: False }
        bootcmd:
          # mount the ConfigMap
          - &quot;mkdir /mnt/app-config&quot;
          - &quot;mount /dev/$(lsblk --nodeps -no name,serial | grep CVLY623300HK240D | cut -f1 -d' ') /mnt/app-config&quot;</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">cloudinitdisk</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">configMap:</span><span style="color:#D20">
      name: app-config</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">app-config-disk</span></span>
<span style="color:#606">status</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="secret"><a class="anchor" href="#secret"></a>secret</h4>
<div class="paragraph">
<p>A <code>secret</code> is a reference to a
<a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> in
Kubernetes. An extra <code>iso</code> disk will be allocated which has to be
mounted on a VM. To mount the <code>secret</code> users can use <code>cloudInit</code> and the
disks serial number. The <code>secretName</code> needs to be set for a reference to
the created kubernetes <code>Secret</code>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note:</strong> Currently, Secret update propagation is not supported. If a
Secret is updated, only a pod will be aware of changes, not running
VMIs.</p>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note:</strong> Due to a Kubernetes CRD
<a href="https://github.com/kubernetes/kubernetes/issues/68466">issue</a>, you cannot
control the paths within the volume where Secret keys are projected.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Example: Attach the <code>secret</code> to a VM and use <code>cloudInit</code> to mount the
<code>iso</code> disk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">metadata</span>:
  <span style="color:#606">labels</span>:
    <span style="color:#606">special</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-fedora</span></span>
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-fedora</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">containerdisk</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">cloudinitdisk</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk: {}</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">app-secret-disk</span></span>
        <span style="color:#777"># set serial</span>
        <span style="color:#606">serial</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">D23YZ9W6WA5DJ487</span></span>
    <span style="color:#606">machine</span>:
      <span style="color:#606">type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1024M</span></span>
  <span style="color:#606">terminationGracePeriodSeconds</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">0</span></span>
  <span style="color:#606">volumes</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: containerdisk</span></span>
    <span style="color:#606">containerDisk</span>:
      <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt/fedora-cloud-container-disk-demo:latest</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">cloudInitNoCloud:</span><span style="color:#D20">
      userData: |-
        #cloud-config
        password: fedora
        chpasswd: { expire: False }
        bootcmd:
          # mount the Secret
          - &quot;mkdir /mnt/app-secret&quot;
          - &quot;mount /dev/$(lsblk --nodeps -no name,serial | grep D23YZ9W6WA5DJ487 | cut -f1 -d' ') /mnt/app-secret&quot;</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">cloudinitdisk</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">secret:</span><span style="color:#D20">
      secretName: app-secret</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">app-secret-disk</span></span>
<span style="color:#606">status</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serviceaccount"><a class="anchor" href="#serviceaccount"></a>serviceAccount</h4>
<div class="paragraph">
<p>A <code>serviceAccount</code> volume references a Kubernetes
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/"><code>ServiceAccount</code></a>.
A new <code>iso</code> disk will be allocated with the content of the service
account (<code>namespace</code>, <code>token</code> and <code>ca.crt</code>), which needs to be mounted
in the VM. For automatic mounting, see the <code>configMap</code> and <code>secret</code>
examples above.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">metadata</span>:
  <span style="color:#606">labels</span>:
    <span style="color:#606">special</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-fedora</span></span>
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-fedora</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">containerdisk</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">serviceaccountdisk</span></span>
    <span style="color:#606">machine</span>:
      <span style="color:#606">type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1024M</span></span>
  <span style="color:#606">terminationGracePeriodSeconds</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">0</span></span>
  <span style="color:#606">volumes</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: containerdisk</span></span>
    <span style="color:#606">containerDisk</span>:
      <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt/fedora-cloud-container-disk-demo:latest</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: serviceaccountdisk</span></span>
    <span style="color:#606">serviceAccount</span>:
      <span style="color:#606">serviceAccountName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">default</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="high-performance-features"><a class="anchor" href="#high-performance-features"></a>High Performance Features</h3>
<div class="sect3">
<h4 id="iothreads"><a class="anchor" href="#iothreads"></a>IOThreads</h4>
<div class="paragraph">
<p>Libvirt has the ability to use IOThreads for dedicated disk access (for
supported devices). These are dedicated event loop threads that perform
block I/O requests and improve scalability on SMP systems. KubeVirt
exposes this libvirt feature through the <code>ioThreadsPolicy</code> setting.
Additionaly, each <code>Disk</code> device exposes a <code>dedicatedIOThread</code> setting.
This is a boolean that indicates the specified disk should be allocated
an exclusive IOThread that will never be shared with other disks.</p>
</div>
<div class="paragraph">
<p>Currently valid policies are <code>shared</code> and <code>auto</code>. If <code>ioThreadsPolicy</code>
is omitted entirely, use of IOThreads will be disabled. However, if any
disk requests a dedicated IOThread, <code>ioThreadsPolicy</code> will be enabled
and default to <code>shared</code>.</p>
</div>
<div class="sect4">
<h5 id="shared"><a class="anchor" href="#shared"></a>Shared</h5>
<div class="paragraph">
<p>An <code>ioThreadsPolicy</code> of <code>shared</code> indicates that KubeVirt should use one
thread that will be shared by all disk devices. This policy stems from
the fact that large numbers of IOThreads is generally not useful as
additional context switching is incurred for each thread.</p>
</div>
<div class="paragraph">
<p>Disks with <code>dedicatedIOThread</code> set to <code>true</code> will not use the shared
thread, but will instead be allocated an exclusive thread. This is
generally useful if a specific Disk is expected to have heavy I/O
traffic, e.g. a database spindle.</p>
</div>
</div>
<div class="sect4">
<h5 id="auto"><a class="anchor" href="#auto"></a>Auto</h5>
<div class="paragraph">
<p><code>auto</code> IOThreads indicates that KubeVirt should use a pool of IOThreads
and allocate disks to IOThreads in a round-robin fashion. The pool size
is generally limited to twice the number of VCPU’s allocated to the VM.
This essentially attempts to dedicate disks to separate IOThreads, but
only up to a reasonable limit. This would come in to play for systems
with a large number of disks and a smaller number of CPU’s for instance.</p>
</div>
<div class="paragraph">
<p>As a caveat to the size of the IOThread pool, disks with
<code>dedicatedIOThread</code> will always be guaranteed their own thread. This
effectively diminishes the upper limit of the number of threads
allocated to the rest of the disks. For example, a VM with 2 CPUs would
normally use 4 IOThreads for all disks. However if one disk had
<code>dedicatedIOThread</code> set to true, then KubeVirt would only use 3
IOThreads for the shared pool.</p>
</div>
<div class="paragraph">
<p>There is always guaranteed to be at least one thread for disks that will
use the shared IOThreads pool. Thus if a sufficiently large number of
disks have dedicated IOThreads assigned, <code>auto</code> and <code>shared</code> policies
would essentially result in the same layout.</p>
</div>
</div>
<div class="sect4">
<h5 id="iothreads-with-dedicated-pinned-cpus"><a class="anchor" href="#iothreads-with-dedicated-pinned-cpus"></a>IOThreads with Dedicated (pinned) CPUs</h5>
<div class="paragraph">
<p>When guest’s vCPUs are pinned to a host’s physical CPUs, it is also best
to pin the IOThreads to specific CPUs to prevent these from floating
between the CPUs. KubeVirt will automatically calculate and pin each
IOThread to a CPU or a set of CPUs, depending on the ration between
them. In case there are more IOThreads than CPUs, each IOThread will be
pinned to a CPU, in a round-robin fashion. Otherwise, when there are
fewer IOThreads than CPU, each IOThread will be pinned to a set of CPUs.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="examples"><a class="anchor" href="#examples"></a>Examples</h4>
<div class="sect4">
<h5 id="shared-iothreads"><a class="anchor" href="#shared-iothreads"></a>Shared IOThreads</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">metadata</span>:
  <span style="color:#606">labels</span>:
    <span style="color:#606">special</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-shared</span></span>
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-shared</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">ioThreadsPolicy</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">shared</span></span>
    <span style="color:#606">cpu</span>:
      <span style="color:#606">cores</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">2</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mydisk</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk</span></span>
        <span style="color:#606">dedicatedIOThread</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk2</span></span>
        <span style="color:#606">dedicatedIOThread</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk3</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk4</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk5</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk6</span></span>
    <span style="color:#606">machine</span>:
      <span style="color:#606">type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
  <span style="color:#606">volumes</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mydisk</span></span>
    <span style="color:#606">persistentVolumeClaim</span>:
      <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk2</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk3</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk4</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk5</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk6</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, emptydisk and emptydisk2 both request a dedicated
IOThread. mydisk, and emptydisk 3 through 6 will all shared one
IOThread.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mypvc:        1
emptydisk:    2
emptydisk2:   3
emptydisk3:   1
emptydisk4:   1
emptydisk5:   1
emptydisk6:   1</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="auto-iothreads"><a class="anchor" href="#auto-iothreads"></a>Auto IOThreads</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">metadata</span>:
  <span style="color:#606">labels</span>:
    <span style="color:#606">special</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-shared</span></span>
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-shared</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">ioThreadsPolicy</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">auto</span></span>
    <span style="color:#606">cpu</span>:
      <span style="color:#606">cores</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">2</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mydisk</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk</span></span>
        <span style="color:#606">dedicatedIOThread</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk2</span></span>
        <span style="color:#606">dedicatedIOThread</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk3</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk4</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk5</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk6</span></span>
    <span style="color:#606">machine</span>:
      <span style="color:#606">type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
  <span style="color:#606">volumes</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mydisk</span></span>
    <span style="color:#606">persistentVolumeClaim</span>:
      <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk2</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk3</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk4</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk5</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptyDisk:</span><span style="color:#D20">
      capacity: 1Gi</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">emptydisk6</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This VM is identical to the first, except it requests auto IOThreads.
<code>emptydisk</code> and <code>emptydisk2</code> will still be allocated individual
IOThreads, but the rest of the disks will be split across 2 separate
iothreads (twice the number of CPU cores is 4).</p>
</div>
<div class="paragraph">
<p>Disks will be assigned to IOThreads like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mypvc:        1
emptydisk:    3
emptydisk2:   4
emptydisk3:   2
emptydisk4:   1
emptydisk5:   2
emptydisk6:   1</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="virtio-block-multi-queue"><a class="anchor" href="#virtio-block-multi-queue"></a>Virtio Block Multi-Queue</h4>
<div class="paragraph">
<p>Block Multi-Queue is a framework for the Linux block layer that maps
Device I/O queries to multiple queues. This splits I/O processing up
across multiple threads, and therefor multiple CPUs. libvirt recommends
that the number of queues used should match the number of CPUs allocated
for optimal performance.</p>
</div>
<div class="paragraph">
<p>This feature is enabled by the <code>BlockMultiQueue</code> setting under
<code>Devices</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">devices</span>:
      <span style="color:#606">blockMultiQueue</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mydisk</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Due to the way KubeVirt implements CPU allocation,
blockMultiQueue can only be used if a specific CPU allocation is
requested. If a specific number of CPUs hasn’t been allocated to a
VirtualMachine, KubeVirt will use all CPU’s on the node on a best effort
basis. In that case the amount of CPU allocation to a VM at the host
level could change over time. If blockMultiQueue were to request a
number of queues to match all the CPUs on a node, that could lead to
over-allocation scenarios. To avoid this, KubeVirt enforces that a
specific slice of CPU resources is requested in order to take advantage
of this feature.</p>
</div>
<div class="sect4">
<h5 id="example"><a class="anchor" href="#example"></a>Example</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-disk</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
        <span style="color:#606">cpu</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">4</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">blockMultiQueue</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#606">disk</span>:
          <span style="color:#606">bus</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">virtio</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example will enable Block Multi-Queue for the disk <code>mypvcdisk</code> and
allocate 4 queues (to match the number of CPUs requested).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="disk-device-cache"><a class="anchor" href="#disk-device-cache"></a>Disk device cache</h4>
<div class="paragraph">
<p>KubeVirt supports <code>none</code> and <code>writethrough</code> KVM/QEMU cache modes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none</code> I/O from the guest is not cached on the host. Use this option
for guests with large I/O requirements. This option is generally the
best choice.</p>
</li>
<li>
<p><code>writethrough</code> I/O from the guest is cached on the host but written
through to the physical medium.</p>
</li>
</ul>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Important:</strong> <code>none</code> cache mode is set as default if the file system
supports direct I/O, otherwise, <code>writethrough</code> is used.</p>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Note:</strong> It is possible to force a specific cache mode, although if
<code>none</code> mode has been chosen and the file system does not support direct
I/O then started VMI will return an error.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Example: force <code>writethrough</code> cache mode</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha3</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">metadata</span>:
  <span style="color:#606">labels</span>:
    <span style="color:#606">special</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-pvc</span></span>
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">vmi-pvc</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">domain</span>:
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk:</span><span style="color:#D20">
          bus: virtio</span></span>
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">pvcdisk</span></span>
        <span style="color:#606">cache</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">writethrough</span></span>
    <span style="color:#606">machine</span>:
      <span style="color:#606">type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
  <span style="color:#606">terminationGracePeriodSeconds</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">0</span></span>
  <span style="color:#606">volumes</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: pvcdisk</span></span>
    <span style="color:#606">persistentVolumeClaim</span>:
      <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">disk-alpine</span></span>
<span style="color:#606">status</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script src="../../latest/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>