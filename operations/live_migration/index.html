
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for KubeVirt">
      
      
      
        <link rel="canonical" href="https://kubevirt.io/user-guide/operations/live_migration/">
      
      
        <link rel="prev" href="../virtctl_client_tool/">
      
      
        <link rel="next" href="../hotplug_volumes/">
      
      <link rel="icon" href="../../assets/favicon32x32.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.9">
    
    
      
        <title>Live Migration - KubeVirt user guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#live-migration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KubeVirt user guide" class="md-header__button md-logo" aria-label="KubeVirt user guide" data-md-component="logo">
      
  <img src="../../assets/KubeVirt_icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KubeVirt user guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Live Migration
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KubeVirt user guide" class="md-nav__button md-logo" aria-label="KubeVirt user guide" data-md-component="logo">
      
  <img src="../../assets/KubeVirt_icon.png" alt="logo">

    </a>
    KubeVirt user guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../quickstarts/" class="md-nav__link">
        Quickstarts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../release_notes/" class="md-nav__link">
        KubeVirt release notes
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Operations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Operations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../updating_and_deletion/" class="md-nav__link">
        Updating and deletion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic_use/" class="md-nav__link">
        Basic use
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../customize_components/" class="md-nav__link">
        Customize components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation/" class="md-nav__link">
        API Validation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debug/" class="md-nav__link">
        Debug
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../virtctl_client_tool/" class="md-nav__link">
        virtctl Client Tool
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Live Migration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Live Migration
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#enabling-the-live-migration-support" class="md-nav__link">
    Enabling the live-migration support
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initiate-live-migration" class="md-nav__link">
    Initiate live migration
  </a>
  
    <nav class="md-nav" aria-label="Initiate live migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-virtctl-to-initiate-live-migration" class="md-nav__link">
    Using virtctl to initiate live migration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-status-reporting" class="md-nav__link">
    Migration Status Reporting
  </a>
  
    <nav class="md-nav" aria-label="Migration Status Reporting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#condition-and-migration-method" class="md-nav__link">
    Condition and migration method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migration-status" class="md-nav__link">
    Migration Status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canceling-a-live-migration" class="md-nav__link">
    Canceling a live migration
  </a>
  
    <nav class="md-nav" aria-label="Canceling a live migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-virtctl-to-cancel-a-live-migration" class="md-nav__link">
    Using virtctl to cancel a live migration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-cluster-wide-migration-limits" class="md-nav__link">
    Changing Cluster Wide Migration Limits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-different-network-for-migrations" class="md-nav__link">
    Using a different network for migrations
  </a>
  
    <nav class="md-nav" aria-label="Using a different network for migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-migration-network-on-a-cluster" class="md-nav__link">
    Creating a migration network on a cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-kubevirt-to-migrate-vmis-over-that-network" class="md-nav__link">
    Configuring KubeVirt to migrate VMIs over that network
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-kubevirtci-for-testing-migration-networks" class="md-nav__link">
    Configuring KubeVirtCI for testing migration networks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-timeouts" class="md-nav__link">
    Migration timeouts
  </a>
  
    <nav class="md-nav" aria-label="Migration timeouts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#completion-time" class="md-nav__link">
    Completion time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#progress-timeout" class="md-nav__link">
    Progress timeout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disabling-secure-migrations" class="md-nav__link">
    Disabling secure migrations
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hotplug_volumes/" class="md-nav__link">
        Hotplug Volumes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client_passthrough/" class="md-nav__link">
        Client Passthrough
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../snapshot_restore_api/" class="md-nav__link">
        Snapshot Restore API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scheduler/" class="md-nav__link">
        KubeVirt Scheduler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hugepages/" class="md-nav__link">
        Hugepages support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../component_monitoring/" class="md-nav__link">
        Component monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../authorization/" class="md-nav__link">
        Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../annotations_and_labels/" class="md-nav__link">
        Annotations and labels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../node_assignment/" class="md-nav__link">
        Node assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../node_maintenance/" class="md-nav__link">
        Node maintenance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../node_overcommit/" class="md-nav__link">
        Node overcommit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../unresponsive_nodes/" class="md-nav__link">
        Unresponsive nodes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../containerized_data_importer/" class="md-nav__link">
        Containerized Data Importer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../activating_feature_gates/" class="md-nav__link">
        Activating feature gates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../export_api/" class="md-nav__link">
        Export API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../clone_api/" class="md-nav__link">
        Clone API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../memory_dump/" class="md-nav__link">
        Virtual machine memory dump
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mediated_devices_configuration/" class="md-nav__link">
        Mediated devices and virtual GPUs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../migration_policies/" class="md-nav__link">
        Migration Policies
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Virtual machines
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Virtual machines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/virtual_machine_instances/" class="md-nav__link">
        Virtual Machines Instances
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/lifecycle/" class="md-nav__link">
        Lifecycle
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/run_strategies/" class="md-nav__link">
        Run Strategies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/instancetypes/" class="md-nav__link">
        Instancetypes and preferences
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/presets/" class="md-nav__link">
        Presets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/virtual_hardware/" class="md-nav__link">
        Virtual hardware
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/dedicated_cpu_resources/" class="md-nav__link">
        Dedicated CPU resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/numa/" class="md-nav__link">
        NUMA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/disks_and_volumes/" class="md-nav__link">
        Disks and Volumes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/interfaces_and_networks/" class="md-nav__link">
        Interfaces and Networks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/istio_service_mesh/" class="md-nav__link">
        Istio service mesh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/networkpolicy/" class="md-nav__link">
        NetworkPolicy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/host-devices/" class="md-nav__link">
        Host Devices Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/windows_virtio_drivers/" class="md-nav__link">
        Windows virtio drivers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/guest_operating_system_information/" class="md-nav__link">
        Guest Operating System Information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/guest_agent_information/" class="md-nav__link">
        Guest Agent information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/liveness_and_readiness_probes/" class="md-nav__link">
        Liveness and Readiness Probes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/accessing_virtual_machines/" class="md-nav__link">
        Accessing Virtual Machines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/startup_scripts/" class="md-nav__link">
        Startup Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/service_objects/" class="md-nav__link">
        Service objects
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/templates/" class="md-nav__link">
        Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/tekton_tasks/" class="md-nav__link">
        KubeVirt Tekton
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/replicaset/" class="md-nav__link">
        VirtualMachineInstanceReplicaSet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/dns/" class="md-nav__link">
        DNS records
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/boot_from_external_source/" class="md-nav__link">
        Booting From External Source
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/confidential_computing/" class="md-nav__link">
        Confidential computing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/vsock/" class="md-nav__link">
        VSOCK
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../web_console/" class="md-nav__link">
        Web Console
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Appendix
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Appendix
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#enabling-the-live-migration-support" class="md-nav__link">
    Enabling the live-migration support
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initiate-live-migration" class="md-nav__link">
    Initiate live migration
  </a>
  
    <nav class="md-nav" aria-label="Initiate live migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-virtctl-to-initiate-live-migration" class="md-nav__link">
    Using virtctl to initiate live migration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-status-reporting" class="md-nav__link">
    Migration Status Reporting
  </a>
  
    <nav class="md-nav" aria-label="Migration Status Reporting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#condition-and-migration-method" class="md-nav__link">
    Condition and migration method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migration-status" class="md-nav__link">
    Migration Status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canceling-a-live-migration" class="md-nav__link">
    Canceling a live migration
  </a>
  
    <nav class="md-nav" aria-label="Canceling a live migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-virtctl-to-cancel-a-live-migration" class="md-nav__link">
    Using virtctl to cancel a live migration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-cluster-wide-migration-limits" class="md-nav__link">
    Changing Cluster Wide Migration Limits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-different-network-for-migrations" class="md-nav__link">
    Using a different network for migrations
  </a>
  
    <nav class="md-nav" aria-label="Using a different network for migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-migration-network-on-a-cluster" class="md-nav__link">
    Creating a migration network on a cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-kubevirt-to-migrate-vmis-over-that-network" class="md-nav__link">
    Configuring KubeVirt to migrate VMIs over that network
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-kubevirtci-for-testing-migration-networks" class="md-nav__link">
    Configuring KubeVirtCI for testing migration networks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-timeouts" class="md-nav__link">
    Migration timeouts
  </a>
  
    <nav class="md-nav" aria-label="Migration timeouts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#completion-time" class="md-nav__link">
    Completion time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#progress-timeout" class="md-nav__link">
    Progress timeout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disabling-secure-migrations" class="md-nav__link">
    Disabling secure migrations
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/kubevirt/user-guide/edit/main/docs/operations/live_migration.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/kubevirt/user-guide/raw/main/docs/operations/live_migration.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  



<h1 id="live-migration">Live Migration<a class="headerlink" href="#live-migration" title="Permanent link">&para;</a></h1>
<p>Live migration is a process during which a running Virtual Machine
Instance moves to another compute node while the guest workload
continues to run and remain accessible.</p>
<h2 id="enabling-the-live-migration-support">Enabling the live-migration support<a class="headerlink" href="#enabling-the-live-migration-support" title="Permanent link">&para;</a></h2>
<p>Live migration must be enabled in the feature gates to be supported. The
<a href="../activating_feature_gates/#how-to-activate-a-feature-gate">feature gates</a>
field in the KubeVirt CR must be expanded by adding the <code>LiveMigration</code> to it.</p>
<h2 id="limitations">Limitations<a class="headerlink" href="#limitations" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Virtual machines using a PersistentVolumeClaim (PVC) must have a
  shared ReadWriteMany (RWX) access mode to be live migrated.</p>
</li>
<li>
<p>Live migration is not allowed with a pod network binding of bridge
  interface type
  (<!--#/creation/interfaces-and-networks-->)</p>
</li>
<li>
<p>Live migration requires ports <code>49152, 49153</code> to be available in the virt-launcher pod.
  If these ports are explicitly specified in <a href="../../virtual_machines/interfaces_and_networks/#masquerade">masquarade interface</a>, live migration will not function.</p>
</li>
</ul>
<h2 id="initiate-live-migration">Initiate live migration<a class="headerlink" href="#initiate-live-migration" title="Permanent link">&para;</a></h2>
<p>Live migration is initiated by posting a VirtualMachineInstanceMigration
(VMIM) object to the cluster. The example below starts a migration
process for a virtual machine instance <code>vmi-fedora</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.io/v1</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachineInstanceMigration</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">migration-job</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="nt">vmiName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vmi-fedora</span>
</code></pre></div>
<h3 id="using-virtctl-to-initiate-live-migration">Using virtctl to initiate live migration<a class="headerlink" href="#using-virtctl-to-initiate-live-migration" title="Permanent link">&para;</a></h3>
<p>Live migration can also be initiated using virtctl
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="go">    virtctl migrate vmi-fedora</span>
</code></pre></div></p>
<h2 id="migration-status-reporting">Migration Status Reporting<a class="headerlink" href="#migration-status-reporting" title="Permanent link">&para;</a></h2>
<h3 id="condition-and-migration-method">Condition and migration method<a class="headerlink" href="#condition-and-migration-method" title="Permanent link">&para;</a></h3>
<p>When starting a virtual machine instance, it has also been calculated
whether the machine is live migratable. The result is being stored in
the VMI <code>VMI.status.conditions</code>. The calculation can be based on
multiple parameters of the VMI, however, at the moment, the calculation
is largely based on the <code>Access Mode</code> of the VMI volumes. Live migration
is only permitted when the volume access mode is set to <code>ReadWriteMany</code>.
Requests to migrate a non-LiveMigratable VMI will be rejected.</p>
<p>The reported <code>Migration Method</code> is also being calculated during VMI
start. <code>BlockMigration</code> indicates that some of the VMI disks require
copying from the source to the destination. <code>LiveMigration</code> means that
only the instance memory will be copied.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">Status</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nt">Conditions</span><span class="p">:</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="nt">Status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LiveMigratable</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="nt">Migration Method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BlockMigration</span>
</code></pre></div>
<h3 id="migration-status">Migration Status<a class="headerlink" href="#migration-status" title="Permanent link">&para;</a></h3>
<p>The migration progress status is being reported in the VMI <code>VMI.status</code>.
Most importantly, it indicates whether the migration has been
<code>Completed</code> or if it <code>Failed</code>.</p>
<p>Below is an example of a successful migration.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Migration State:
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    Completed:        true
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    End Timestamp:    2019-03-29T03:37:52Z
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    Migration Config:
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>      Completion Timeout Per GiB:  800
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>      Progress Timeout:             150
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    Migration UID:                  c64d4898-51d3-11e9-b370-525500d15501
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    Source Node:                    node02
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    Start Timestamp:                2019-03-29T04:02:47Z
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    Target Direct Migration Node Ports:
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>      35001:                      0
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>      41068:                      49152
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>      38284:                      49153
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    Target Node:                  node01
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>    Target Node Address:          10.128.0.46
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>    Target Node Domain Detected:  true
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>    Target Pod:                   virt-launcher-testvmimcbjgw6zrzcmp8wpddvztvzm7x2k6cjbdgktwv8tkq
</code></pre></div>
<h2 id="canceling-a-live-migration">Canceling a live migration<a class="headerlink" href="#canceling-a-live-migration" title="Permanent link">&para;</a></h2>
<p>Live migration can also be canceled by simply deleting the migration
object. A successfully aborted migration will indicate that the abort
has been requested <code>Abort Requested</code>, and that it succeeded:
<code>Abort Status: Succeeded</code>. The migration in this case will be <code>Completed</code>
and <code>Failed</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>Migration State:
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    Abort Requested:  true
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    Abort Status:     Succeeded
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    Completed:        true
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    End Timestamp:    2019-03-29T04:02:49Z
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    Failed:           true
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    Migration Config:
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>      Completion Timeout Per GiB:  800
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>      Progress Timeout:             150
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    Migration UID:                  57a693d6-51d7-11e9-b370-525500d15501
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    Source Node:                    node02
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    Start Timestamp:                2019-03-29T04:02:47Z
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    Target Direct Migration Node Ports:
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>      39445:                      0
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>      43345:                      49152
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>      44222:                      49153
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    Target Node:                  node01
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>    Target Node Address:          10.128.0.46
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    Target Node Domain Detected:  true
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    Target Pod:                   virt-launcher-testvmimcbjgw6zrzcmp8wpddvztvzm7x2k6cjbdgktwv8tkq
</code></pre></div>
<h3 id="using-virtctl-to-cancel-a-live-migration">Using virtctl to cancel a live migration<a class="headerlink" href="#using-virtctl-to-cancel-a-live-migration" title="Permanent link">&para;</a></h3>
<p>Live migration can also be canceled using virtctl, by specifying the name
of a VMI which is currently being migrated
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="go">    virtctl migrate-cancel vmi-fedora</span>
</code></pre></div></p>
<h2 id="changing-cluster-wide-migration-limits">Changing Cluster Wide Migration Limits<a class="headerlink" href="#changing-cluster-wide-migration-limits" title="Permanent link">&para;</a></h2>
<p>KubeVirt puts some limits in place, so that migrations don't overwhelm
the cluster. By default, it is configured to only run <code>5</code> migrations in
parallel with an additional limit of a maximum of <code>2</code> outbound
migrations per node. Finally, every migration is limited to a bandwidth
of <code>64MiB/s</code>.</p>
<p>These values can be changed in the <code>kubevirt</code> CR:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>    apiVersion: kubevirt.io/v1
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    kind: Kubevirt
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    metadata:
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>      name: kubevirt
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>      namespace: kubevirt
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    spec:
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>      configuration:
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>        developerConfiguration:
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>          featureGates:
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>          - LiveMigration
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>        migrations:
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>          parallelMigrationsPerCluster: 5
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>          parallelOutboundMigrationsPerNode: 2
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>          bandwidthPerMigration: 64Mi
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>          completionTimeoutPerGiB: 800
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>          progressTimeout: 150
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>          disableTLS: false
</code></pre></div>
<h2 id="using-a-different-network-for-migrations">Using a different network for migrations<a class="headerlink" href="#using-a-different-network-for-migrations" title="Permanent link">&para;</a></h2>
<p>Live migrations can be configured to happen on a different network than
the one Kubernetes is configured to use.
That potentially allows for more determinism, control and/or bandwidth,
depending on use-cases.</p>
<h3 id="creating-a-migration-network-on-a-cluster">Creating a migration network on a cluster<a class="headerlink" href="#creating-a-migration-network-on-a-cluster" title="Permanent link">&para;</a></h3>
<p>A separate physical network is required, meaning that every node on the
cluster has to have at least 2 NICs, and the NICs that will be used for
migrations need to be interconnected, i.e. all plugged to the same switch.
The examples below assume that <code>eth1</code> will be used for migrations.</p>
<p>It is also required for the Kubernetes cluster to have
<a href="https://github.com/k8snetworkplumbingwg/multus-cni.git">multus</a> installed.</p>
<p>If the desired network doesn't include a DHCP server, then
<a href="https://github.com/k8snetworkplumbingwg/whereabouts">whereabouts</a> will
be needed as well.</p>
<p>Finally, a NetworkAttachmentDefinition needs to be created in the
namespace where KubeVirt is installed. Here is an example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>apiVersion: &quot;k8s.cni.cncf.io/v1&quot;
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>kind: NetworkAttachmentDefinition
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>metadata:
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>  name: migration-network
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>  namespace: kubevirt
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>spec:
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>  config: &#39;{
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>      &quot;cniVersion&quot;: &quot;0.3.1&quot;,
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>      &quot;name&quot;: &quot;migration-bridge&quot;,
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>      &quot;type&quot;: &quot;macvlan&quot;,
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>      &quot;master&quot;: &quot;eth1&quot;,
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>      &quot;mode&quot;: &quot;bridge&quot;,
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>      &quot;ipam&quot;: {
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>        &quot;type&quot;: &quot;whereabouts&quot;,
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>        &quot;range&quot;: &quot;10.1.1.0/24&quot;
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>      }
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    }&#39;
</code></pre></div></p>
<h3 id="configuring-kubevirt-to-migrate-vmis-over-that-network">Configuring KubeVirt to migrate VMIs over that network<a class="headerlink" href="#configuring-kubevirt-to-migrate-vmis-over-that-network" title="Permanent link">&para;</a></h3>
<p>This is just a matter of adding the name of the
NetworkAttachmentDefinition to the KubeVirt CR, like so:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>    apiVersion: kubevirt.io/v1
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    kind: Kubevirt
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    metadata:
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>      name: kubevirt
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>      namespace: kubevirt
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    spec:
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>      configuration:
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>        developerConfiguration:
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>          featureGates:
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>          - LiveMigration
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>        migrations:
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>          network: migration-network
</code></pre></div></p>
<p>That change will trigger a restart of the virt-handler pods, as they
get connected to that new network.</p>
<p>From now on, migrations will happen over that network.</p>
<h3 id="configuring-kubevirtci-for-testing-migration-networks">Configuring KubeVirtCI for testing migration networks<a class="headerlink" href="#configuring-kubevirtci-for-testing-migration-networks" title="Permanent link">&para;</a></h3>
<p>Developers and people wanting to test the feature before deploying
it on a real cluster might want to configure a dedicated migration
network in KubeVirtCI.</p>
<p>KubeVirtCI can simply be configured to include a virtual secondary
network, as well as automatically install multus and whereabouts.
The following environment variables just have to be declared before
running <code>make cluster-up</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>export KUBEVIRT_NUM_NODES=2;
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>export KUBEVIRT_NUM_SECONDARY_NICS=1;
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>export KUBEVIRT_DEPLOY_ISTIO=true;
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>export KUBEVIRT_WITH_CNAO=true
</code></pre></div></p>
<h2 id="migration-timeouts">Migration timeouts<a class="headerlink" href="#migration-timeouts" title="Permanent link">&para;</a></h2>
<p>Depending on the type, the live migration process will copy virtual
machine memory pages and disk blocks to the destination. During this
process non-locked pages and blocks are being copied and become free for
the instance to use again. To achieve a successful migration, it is
assumed that the instance will write to the free pages and blocks
(pollute the pages) at a lower rate than these are being copied.</p>
<h3 id="completion-time">Completion time<a class="headerlink" href="#completion-time" title="Permanent link">&para;</a></h3>
<p>In some cases the virtual machine can write to different memory pages /
disk blocks at a higher rate than these can be copied, which will
prevent the migration process from completing in a reasonable amount of
time. In this case, live migration will be aborted if it is running for
a long period of time. The timeout is calculated base on the size of
the VMI, it's memory and the ephemeral disks that are needed to be
copied. The configurable parameter <code>completionTimeoutPerGiB</code>, which
defaults to 800s is the time for GiB of data to wait for the migration
to be completed before aborting it. A VMI with 8Gib of memory will time
out after 6400 seconds.</p>
<h3 id="progress-timeout">Progress timeout<a class="headerlink" href="#progress-timeout" title="Permanent link">&para;</a></h3>
<p>Live migration will also be aborted when it will be noticed that copying
memory doesn't make any progress. The time to wait for live migration to
make progress in transferring data is configurable by <code>progressTimeout</code>
parameter, which defaults to 150s</p>
<h2 id="disabling-secure-migrations">Disabling secure migrations<a class="headerlink" href="#disabling-secure-migrations" title="Permanent link">&para;</a></h2>
<p><strong>FEATURE STATE:</strong> KubeVirt v0.43</p>
<p>Sometimes it may be desirable to disable TLS encryption of migrations to
improve performance. Use <code>disableTLS</code> to do that:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>    apiVersion: kubevirt.io/v1
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    kind: Kubevirt
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    metadata:
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>      name: kubevirt
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>      namespace: kubevirt
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    spec:
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>      configuration:
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>        developerConfiguration:
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>          featureGates:
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>            - &quot;LiveMigration&quot;
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>        migrationConfiguration:
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>          disableTLS: true
</code></pre></div>
<p><strong>Note:</strong> While this increases performance it may allow MITM attacks. Be careful.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../virtctl_client_tool/" class="md-footer__link md-footer__link--prev" aria-label="Previous: virtctl Client Tool" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                virtctl Client Tool
              </div>
            </div>
          </a>
        
        
          
          <a href="../hotplug_volumes/" class="md-footer__link md-footer__link--next" aria-label="Next: Hotplug Volumes" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Hotplug Volumes
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.footer", "content.action.view", "content.action.edit"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
    
  </body>
</html>