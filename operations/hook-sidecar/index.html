
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for KubeVirt">
      
      
      
        <link rel="canonical" href="https://kubevirt.io/user-guide/operations/hook-sidecar/">
      
      
        <link rel="prev" href="../vm_rollout_strategies/">
      
      
        <link rel="next" href="../../virtual_machines/virtual_machine_instances/">
      
      
      <link rel="icon" href="../../assets/favicon32x32.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.23">
    
    
      
        <title>Hook Sidecar Container - KubeVirt user guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hook-sidecar-container" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KubeVirt user guide" class="md-header__button md-logo" aria-label="KubeVirt user guide" data-md-component="logo">
      
  <img src="../../assets/KubeVirt_icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KubeVirt user guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Hook Sidecar Container
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../architecture/" class="md-tabs__link">
        
  
    
  
  Architecture

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../quickstarts/" class="md-tabs__link">
        
  
    
  
  Quickstarts

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../installation/" class="md-tabs__link">
          
  
  Operations

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../virtual_machines/virtual_machine_instances/" class="md-tabs__link">
          
  
  Virtual Machines

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../release_notes/" class="md-tabs__link">
        
  
    
  
  Release Notes

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../debug_virt_stack/logging/" class="md-tabs__link">
          
  
  Virtualization Debugging

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KubeVirt user guide" class="md-nav__button md-logo" aria-label="KubeVirt user guide" data-md-component="logo">
      
  <img src="../../assets/KubeVirt_icon.png" alt="logo">

    </a>
    KubeVirt user guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstarts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstarts
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Operations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../updating_and_deletion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating and deletion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic_use/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic use
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customize_components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customize components
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deploy_common_instancetypes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploy common-instancetypes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../virtctl_client_tool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Download and Install the virtctl Command Line Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../live_migration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Live Migration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hotplug_interfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hotplug Network Interfaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hotplug_volumes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hotplug Volumes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client_passthrough/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client Passthrough
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../snapshot_restore_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Snapshot Restore API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KubeVirt Scheduler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hugepages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugepages support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../component_monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Component monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../authorization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annotations_and_labels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Annotations and labels
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../node_assignment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node assignment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../node_maintenance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node maintenance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../node_overcommit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node overcommit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../unresponsive_nodes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unresponsive nodes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../containerized_data_importer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containerized Data Importer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../activating_feature_gates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activating feature gates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../export_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Export API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../clone_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clone API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory_dump/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual machine memory dump
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mediated_devices_configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mediated devices and virtual GPUs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../migration_policies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Migration Policies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ksm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KSM Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gitops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Managing KubeVirt with GitOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operations_on_Arm64/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arm64 Operations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../feature_gate_status_on_Arm64/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Gate Status on Arm64
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpu_hotplug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CPU Hotplug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory_hotplug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memory Hotplug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vm_rollout_strategies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VM Rollout Strategies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Hook Sidecar Container
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Hook Sidecar Container
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-sidecar-feature-gate" class="md-nav__link">
    <span class="md-ellipsis">
      Enabling Sidecar feature gate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidecar-shim-container-image" class="md-nav__link">
    <span class="md-ellipsis">
      Sidecar-shim container image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go-python-shell-pick-any-one" class="md-nav__link">
    <span class="md-ellipsis">
      Go, Python, Shell - pick any one
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Go, Python, Shell - pick any one">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go-binary" class="md-nav__link">
    <span class="md-ellipsis">
      Go binary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-or-python-script" class="md-nav__link">
    <span class="md-ellipsis">
      Shell or Python script
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shell or Python script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configmap-with-shell-script" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigMap with shell script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configmap-with-python-script" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigMap with python script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-everything-works" class="md-nav__link">
    <span class="md-ellipsis">
      Verify everything works
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Virtual Machines
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Virtual Machines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/virtual_machine_instances/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual Machines Instances
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/creating_vms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating VirtualMachines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/lifecycle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lifecycle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/run_strategies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Strategies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/instancetypes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instance types and preferences
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/presets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/virtual_hardware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual hardware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/dedicated_cpu_resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dedicated CPU resources
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/numa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NUMA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/disks_and_volumes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Filesystems, Disks and Volumes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/interfaces_and_networks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interfaces and Networks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/network_binding_plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Binding Plugins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/istio_service_mesh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Istio service mesh
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/networkpolicy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkPolicy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/host-devices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Host Devices Assignment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/windows_virtio_drivers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows virtio drivers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/guest_operating_system_information/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guest Operating System Information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/guest_agent_information/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guest Agent information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/liveness_and_readiness_probes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Liveness and Readiness Probes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/accessing_virtual_machines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accessing Virtual Machines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/startup_scripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Startup Scripts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/service_objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/tekton_tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KubeVirt Tekton
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/replicaset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VirtualMachineInstanceReplicaSet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/pool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VirtualMachinePool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DNS records
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/boot_from_external_source/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Booting From External Source
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/confidential_computing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Confidential computing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/vsock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSOCK
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/virtual_machines_on_Arm64/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual Machines on Arm64
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/device_status_on_Arm64/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Device Status on Arm64
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/persistent_tpm_and_uefi_state/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Persistent TPM and UEFI state
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/resources_requests_and_limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resources requests and limits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/guestfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage of libguestfs-tools and virtctl guestfs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release Notes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Virtualization Debugging
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Virtualization Debugging
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Control libvirt logging for each component
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/privileged-node-debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Privileged debugging on the node
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/virsh-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Execute virsh commands in virt-launcher pod
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/launch-qemu-strace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch QEMU with strace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_virt_stack/launch-qemu-gdb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch QEMU with gdb and connect locally with gdb client
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-sidecar-feature-gate" class="md-nav__link">
    <span class="md-ellipsis">
      Enabling Sidecar feature gate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidecar-shim-container-image" class="md-nav__link">
    <span class="md-ellipsis">
      Sidecar-shim container image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go-python-shell-pick-any-one" class="md-nav__link">
    <span class="md-ellipsis">
      Go, Python, Shell - pick any one
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Go, Python, Shell - pick any one">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go-binary" class="md-nav__link">
    <span class="md-ellipsis">
      Go binary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-or-python-script" class="md-nav__link">
    <span class="md-ellipsis">
      Shell or Python script
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shell or Python script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configmap-with-shell-script" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigMap with shell script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configmap-with-python-script" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigMap with python script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-everything-works" class="md-nav__link">
    <span class="md-ellipsis">
      Verify everything works
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/kubevirt/user-guide/edit/main/docs/operations/hook-sidecar.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/kubevirt/user-guide/raw/main/docs/operations/hook-sidecar.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="hook-sidecar-container">Hook Sidecar Container<a class="headerlink" href="#hook-sidecar-container" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>In KubeVirt, a Hook Sidecar container is a sidecar container (a secondary container that runs along with the main
application container within the same Pod) used to apply customizations before the Virtual Machine is initialized. This
ability is provided since configurable elements in the VMI specification do not cover all of the <a href="https://libvirt.org/formatdomain.html">libvirt domain
XML</a> elements.</p>
<p>The sidecar containers communicate with the main container over a socket with a gRPC protocol. There are two main
sidecar hooks:</p>
<ol>
<li><code>onDefineDomain</code>: This hook helps to customize libvirt's XML and return the new XML over gRPC for the VM creation.</li>
<li><code>preCloudInitIso</code>: This hook helps to customize the cloud-init configuration. It operates on and returns JSON
   formatted cloud-init data.</li>
</ol>
<h2 id="enabling-sidecar-feature-gate">Enabling <code>Sidecar</code> feature gate<a class="headerlink" href="#enabling-sidecar-feature-gate" title="Permanent link">&para;</a></h2>
<p><code>Sidecar</code> feature gate can be enabled by following the steps mentioned in
<a href="../activating_feature_gates">Activating feature gates</a>.</p>
<p>In case of a development cluster created using kubevirtci, follow the steps mentioned in the 
<a href="https://github.com/kubevirt/kubevirt/blob/main/docs/getting-started.md#compile-and-run-it">developer doc</a> to enable 
the feature gate.</p>
<h2 id="sidecar-shim-container-image">Sidecar-shim container image<a class="headerlink" href="#sidecar-shim-container-image" title="Permanent link">&para;</a></h2>
<p>To run a VM with custom modifications, the <a href="https://quay.io/repository/kubevirt/sidecar-shim">sidecar-shim-image</a> 
takes care of implementing the communication with the main container.</p>
<p>The image contains the <code>sidecar-shim</code> binary built using
<a href="https://github.com/kubevirt/kubevirt/blob/main/cmd/sidecars/sidecar_shim.go"><code>sidecar_shim.go</code></a> which should be kept
as the entrypoint of the container. This binary will search in <code>$PATH</code> for binaries named after the hook names (e.g
<code>onDefineDomain</code> and <code>preCloudInitIso</code>) and run them. Users must provide the necessary arguments as command line options
(flags).</p>
<p>In the case of <code>onDefineDomain</code>, the arguments will be the VMI information as JSON string, (e.g <code>--vmi vmiJSON</code>) and
the current domain XML (e.g <code>--domain domainXML</code>). It outputs the modified domain XML on the standard output.</p>
<p>In the case of <code>preCloudInitIso</code>, the arguments will be the VMI information as JSON string, (e.g <code>--vmi vmiJSON</code>) and
the CloudInitData (e.g <code>--cloud-init cloudInitJSON</code>). It outputs the modified CloudInitData (as JSON) on the standard ouput.</p>
<p>Shell or python scripts can be used as alternatives to the binary, by making them available at the expected location 
(<code>/usr/bin/onDefineDomain</code> or <code>/usr/bin/preCloudInitIso</code> depending upon the hook).</p>
<p>A prebuilt image named <code>sidecar-shim</code> capable of running Shell or Python scripts is shipped as part of KubeVirt releases.</p>
<h2 id="go-python-shell-pick-any-one">Go, Python, Shell - pick any one<a class="headerlink" href="#go-python-shell-pick-any-one" title="Permanent link">&para;</a></h2>
<p>Although a binary doesn't strictly need to be generated from Go code, and a script doesn't strictly need to be one
among Shell or Python, for the purpose of this guide, we will use those as examples.</p>
<h3 id="go-binary">Go binary<a class="headerlink" href="#go-binary" title="Permanent link">&para;</a></h3>
<p>Example Go code modifiying the <a href="https://libvirt.org/formatdomain.html#smbios-system-information">SMBIOS system
information</a> can be found in the <a href="https://github.com/kubevirt/kubevirt/tree/main/cmd/sidecars/smbios">KubeVirt
repo</a>. Binary generated from this code, when
available under <code>/usr/bin/ondefinedomain</code> in the sidecar-shim-image, is run right before VMI creation and the baseboard
manufacturer value is modified to reflect what's provided in the <code>smbios.vm.kubevirt.io/baseBoardManufacturer</code>
annotation in <a href="https://github.com/kubevirt/kubevirt/blob/main/examples/vmi-with-sidecar-hook.yaml">VMI spec</a>.</p>
<h3 id="shell-or-python-script">Shell or Python script<a class="headerlink" href="#shell-or-python-script" title="Permanent link">&para;</a></h3>
<p>If you pefer writing a shell or python script instead of a Go program, create a Kubernetes ConfigMap and use
annotations to make sure the script is run before the VMI creation. The flow would be as below:</p>
<ol>
<li>Create a ConfigMap containing the shell or python script you want to run</li>
<li>Create a VMI containing the annotation <code>hooks.kubevirt.io/hookSidecars</code> and mention the ConfigMap information in it.</li>
<li>In this case a predefined image can be used to handle the communication with the main container.</li>
</ol>
<h4 id="configmap-with-shell-script">ConfigMap with shell script<a class="headerlink" href="#configmap-with-shell-script" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-config-map</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="nt">my_script.sh</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="no">#!/bin/sh</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="no">tempFile=`mktemp --dry-run`</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="no">echo $4 &gt; $tempFile</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="no">sed -i &quot;s|&lt;baseBoard&gt;&lt;/baseBoard&gt;|&lt;baseBoard&gt;&lt;entry name=&#39;manufacturer&#39;&gt;Radical Edward&lt;/entry&gt;&lt;/baseBoard&gt;|&quot; $tempFile</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span><span class="no">cat $tempFile</span>
</code></pre></div>
<h4 id="configmap-with-python-script">ConfigMap with python script<a class="headerlink" href="#configmap-with-python-script" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-config-map</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span><span class="nt">my_script.sh</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="no">#!/usr/bin/env python3</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="no">import xml.etree.ElementTree as ET</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="no">import sys</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="no">def main(s):</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="no"># write to a temporary file</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">        </span><span class="no">f = open(&quot;/tmp/orig.xml&quot;, &quot;w&quot;)</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">        </span><span class="no">f.write(s)</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">        </span><span class="no">f.close()</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">        </span><span class="no"># parse xml from file</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">        </span><span class="no">xml = ET.parse(&quot;/tmp/orig.xml&quot;)</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">        </span><span class="no"># get the root element</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">        </span><span class="no">root = xml.getroot()</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">        </span><span class="no"># find the baseBoard element</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">        </span><span class="no">baseBoard = root.find(&quot;sysinfo&quot;).find(&quot;baseBoard&quot;)</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">        </span><span class="no"># prepare new element to be inserted into the xml definition</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">        </span><span class="no">element = ET.Element(&quot;entry&quot;, {&quot;name&quot;: &quot;manufacturer&quot;})</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">        </span><span class="no">element.text = &quot;Radical Edward&quot;</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">        </span><span class="no"># insert the element</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">        </span><span class="no">baseBoard.insert(0, element)</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">        </span><span class="no"># write to a new file</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">        </span><span class="no">xml.write(&quot;/tmp/new.xml&quot;)</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">        </span><span class="no"># print file contents to stdout</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">        </span><span class="no">f = open(&quot;/tmp/new.xml&quot;)</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">        </span><span class="no">print(f.read())</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">        </span><span class="no">f.close()</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">    </span><span class="no">if __name__ == &quot;__main__&quot;:</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">        </span><span class="no">main(sys.argv[4])</span>
</code></pre></div>
<p>After creating one of the above ConfigMap, create the VMI using the manifest in <a href="https://github.com/kubevirt/kubevirt/blob/main/examples/vmi-with-sidecar-hook-configmap.yaml">this
example</a>. Of importance
here is the ConfigMap information stored in the annotations:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nt">hooks.kubevirt.io/hookSidecars</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="no">[</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">        </span><span class="no">{</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">            </span><span class="no">&quot;args&quot;: [&quot;--version&quot;, &quot;v1alpha2&quot;],</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">            </span><span class="no">&quot;configMap&quot;: {&quot;name&quot;: &quot;my-config-map&quot;, &quot;key&quot;: &quot;my_script.sh&quot;, &quot;hookPath&quot;: &quot;/usr/bin/onDefineDomain&quot;}</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">        </span><span class="no">}</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="no">]</span>
</code></pre></div>
<p>The <code>name</code> field indicates the name of the ConfigMap on the cluster which contains the script you want to execute. The
<code>key</code> field indicates the key in the ConfigMap which contains the script to be executed. Finally, <code>hookPath</code> indicates
the path where you want the script to be mounted. It could be either of <code>/usr/bin/onDefineDomain</code> or
<code>/usr/bin/preCloudInitIso</code> depending upon the hook you want to execute.
An optional value can be specified with the <code>"image"</code> key if a custom image is needed, if omitted the default Sidecar-shim image built together with the other KubeVirt images will be used.
The default Sidecar-shim image, if not override with a custom value, will also be updated as other images as for <a href="./updating_and_deletion/#updating-kubevirt-workloads">Updating KubeVirt Workloads</a>.</p>
<h3 id="verify-everything-works">Verify everything works<a class="headerlink" href="#verify-everything-works" title="Permanent link">&para;</a></h3>
<p>Whether you used the Go binary or a Shell/Python script from the above examples, you would be able to see the newly 
created VMI have the modified baseboard manufacturer information. After creating the VMI, verify that it is in the 
<code>Running</code> state, and connect to its console and see if the desired changes to baseboard manufacturer get reflected:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Once the VM is ready, connect to its display and login using name and password &quot;fedora&quot;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>cluster/virtctl.sh<span class="w"> </span>vnc<span class="w"> </span>vmi-with-sidecar-hook-configmap
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1"># Check whether the base board manufacturer value was successfully overwritten</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>sudo<span class="w"> </span>dmidecode<span class="w"> </span>-s<span class="w"> </span>baseboard-manufacturer
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../vm_rollout_strategies/" class="md-footer__link md-footer__link--prev" aria-label="Previous: VM Rollout Strategies">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                VM Rollout Strategies
              </div>
            </div>
          </a>
        
        
          
          <a href="../../virtual_machines/virtual_machine_instances/" class="md-footer__link md-footer__link--next" aria-label="Next: Virtual Machines Instances">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Virtual Machines Instances
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.footer", "navigation.tabs", "navigation.tabs.sticky", "content.action.view", "content.action.edit"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ebd0bdb7.min.js"></script>
      
    
  </body>
</html>