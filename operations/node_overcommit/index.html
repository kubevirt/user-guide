
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for KubeVirt">
      
      
      
        <link rel="canonical" href="https://kubevirt.io/user-guide/operations/node_overcommit/">
      
      
        <link rel="prev" href="../node_maintenance/">
      
      
        <link rel="next" href="../unresponsive_nodes/">
      
      <link rel="icon" href="../../assets/favicon32x32.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Node overcommit - KubeVirt user guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#node-overcommit" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KubeVirt user guide" class="md-header__button md-logo" aria-label="KubeVirt user guide" data-md-component="logo">
      
  <img src="../../assets/KubeVirt_icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KubeVirt user guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Node overcommit
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KubeVirt user guide" class="md-nav__button md-logo" aria-label="KubeVirt user guide" data-md-component="logo">
      
  <img src="../../assets/KubeVirt_icon.png" alt="logo">

    </a>
    KubeVirt user guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../quickstarts/" class="md-nav__link">
        Quickstarts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../release_notes/" class="md-nav__link">
        KubeVirt release notes
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="true">
          Operations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Operations" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Operations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../updating_and_deletion/" class="md-nav__link">
        Updating and deletion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic_use/" class="md-nav__link">
        Basic use
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../customize_components/" class="md-nav__link">
        Customize components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation/" class="md-nav__link">
        API Validation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debug/" class="md-nav__link">
        Debug
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../virtctl_client_tool/" class="md-nav__link">
        virtctl Client Tool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../live_migration/" class="md-nav__link">
        Live Migration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hotplug_volumes/" class="md-nav__link">
        Hotplug Volumes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client_passthrough/" class="md-nav__link">
        Client Passthrough
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../snapshot_restore_api/" class="md-nav__link">
        Snapshot Restore API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hugepages/" class="md-nav__link">
        Hugepages support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../component_monitoring/" class="md-nav__link">
        Component monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../authorization/" class="md-nav__link">
        Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../annotations_and_labels/" class="md-nav__link">
        Annotations and labels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../node_assignment/" class="md-nav__link">
        Node assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../node_maintenance/" class="md-nav__link">
        Node maintenance
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Node overcommit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Node overcommit
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#remove-the-graphical-devices" class="md-nav__link">
    Remove the Graphical Devices
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overcommit-the-guest-overhead" class="md-nav__link">
    Overcommit the Guest Overhead
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overcommit-guest-memory" class="md-nav__link">
    Overcommit Guest Memory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-memory-pressure-behavior-of-nodes" class="md-nav__link">
    Configuring the memory pressure behavior of nodes
  </a>
  
    <nav class="md-nav" aria-label="Configuring the memory pressure behavior of nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-soft-eviction-thresholds" class="md-nav__link">
    Configuring Soft Eviction Thresholds
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-hard-eviction-thresholds" class="md-nav__link">
    Configuring Hard Eviction Thresholds
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requesting-the-right-qos-class-for-virtualmachineinstances" class="md-nav__link">
    Requesting the right QoS Class for VirtualMachineInstances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-system-reserved-and-kubelet-reserved" class="md-nav__link">
    Setting --system-reserved and --kubelet-reserved
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-ksm" class="md-nav__link">
    Enabling KSM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-swap" class="md-nav__link">
    Enabling Swap
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../unresponsive_nodes/" class="md-nav__link">
        Unresponsive nodes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../containerized_data_importer/" class="md-nav__link">
        Containerized Data Importer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../activating_feature_gates/" class="md-nav__link">
        Activating feature gates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../export_api/" class="md-nav__link">
        Export API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../clone_api/" class="md-nav__link">
        Clone API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../memory_dump/" class="md-nav__link">
        Virtual machine memory dump
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mediated_devices_configuration/" class="md-nav__link">
        Mediated devices and virtual GPUs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../migration_policies/" class="md-nav__link">
        Migration Policies
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" tabindex="0" aria-expanded="false">
          Virtual machines
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Virtual machines" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Virtual machines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/virtual_machine_instances/" class="md-nav__link">
        Virtual Machines Instances
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/lifecycle/" class="md-nav__link">
        Lifecycle
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/run_strategies/" class="md-nav__link">
        Run Strategies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/instancetypes/" class="md-nav__link">
        Instancetypes and preferences
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/presets/" class="md-nav__link">
        Presets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/virtual_hardware/" class="md-nav__link">
        Virtual hardware
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/dedicated_cpu_resources/" class="md-nav__link">
        Dedicated CPU resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/numa/" class="md-nav__link">
        NUMA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/disks_and_volumes/" class="md-nav__link">
        Disks and Volumes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/interfaces_and_networks/" class="md-nav__link">
        Interfaces and Networks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/istio_service_mesh/" class="md-nav__link">
        Istio service mesh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/networkpolicy/" class="md-nav__link">
        NetworkPolicy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/host-devices/" class="md-nav__link">
        Host Devices Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/windows_virtio_drivers/" class="md-nav__link">
        Windows virtio drivers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/guest_operating_system_information/" class="md-nav__link">
        Guest Operating System Information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/guest_agent_information/" class="md-nav__link">
        Guest Agent information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/liveness_and_readiness_probes/" class="md-nav__link">
        Liveness and Readiness Probes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/accessing_virtual_machines/" class="md-nav__link">
        Accessing Virtual Machines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/startup_scripts/" class="md-nav__link">
        Startup Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/service_objects/" class="md-nav__link">
        Service objects
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/templates/" class="md-nav__link">
        Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/tekton_tasks/" class="md-nav__link">
        KubeVirt Tekton
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/replicaset/" class="md-nav__link">
        VirtualMachineInstanceReplicaSet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/dns/" class="md-nav__link">
        DNS records
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/boot_from_external_source/" class="md-nav__link">
        Booting From External Source
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/confidential_computing/" class="md-nav__link">
        Confidential computing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual_machines/vsock/" class="md-nav__link">
        VSOCK
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../web_console/" class="md-nav__link">
        Web Console
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" tabindex="0" aria-expanded="false">
          Appendix
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Appendix" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Appendix
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#remove-the-graphical-devices" class="md-nav__link">
    Remove the Graphical Devices
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overcommit-the-guest-overhead" class="md-nav__link">
    Overcommit the Guest Overhead
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overcommit-guest-memory" class="md-nav__link">
    Overcommit Guest Memory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-memory-pressure-behavior-of-nodes" class="md-nav__link">
    Configuring the memory pressure behavior of nodes
  </a>
  
    <nav class="md-nav" aria-label="Configuring the memory pressure behavior of nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-soft-eviction-thresholds" class="md-nav__link">
    Configuring Soft Eviction Thresholds
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-hard-eviction-thresholds" class="md-nav__link">
    Configuring Hard Eviction Thresholds
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requesting-the-right-qos-class-for-virtualmachineinstances" class="md-nav__link">
    Requesting the right QoS Class for VirtualMachineInstances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-system-reserved-and-kubelet-reserved" class="md-nav__link">
    Setting --system-reserved and --kubelet-reserved
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-ksm" class="md-nav__link">
    Enabling KSM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-swap" class="md-nav__link">
    Enabling Swap
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/kubevirt/user-guide/edit/main/docs/operations/node_overcommit.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/kubevirt/user-guide/raw/main/docs/operations/node_overcommit.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  



<h1 id="node-overcommit">Node overcommit<a class="headerlink" href="#node-overcommit" title="Permanent link">&para;</a></h1>
<p>KubeVirt does not yet support classical Memory Overcommit Management or
Memory Ballooning. In other words VirtualMachineInstances can't give
back memory they have allocated. However, a few other things can be
tweaked to reduce the memory footprint and overcommit the per-VMI memory
overhead.</p>
<h2 id="remove-the-graphical-devices">Remove the Graphical Devices<a class="headerlink" href="#remove-the-graphical-devices" title="Permanent link">&para;</a></h2>
<p>First the safest option to reduce the memory footprint, is removing the
graphical device from the VMI by setting
<code>spec.domain.devices.autottachGraphicsDevice</code> to <code>false</code>. See the video
and graphics device
<a href="../../virtual_machines/virtual_hardware/#video-and-graphics-device">documentation</a>
for further details and examples.</p>
<p>This will save a constant amount of <code>16MB</code> per VirtualMachineInstance
but also disable VNC access.</p>
<h2 id="overcommit-the-guest-overhead">Overcommit the Guest Overhead<a class="headerlink" href="#overcommit-the-guest-overhead" title="Permanent link">&para;</a></h2>
<p>Before you continue, make sure you make yourself comfortable with the
<a href="https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/">Out of Resource
Management</a>
of Kubernetes.</p>
<p>Every VirtualMachineInstance requests slightly more memory from
Kubernetes than what was requested by the user for the Operating System.
The additional memory is used for the per-VMI overhead consisting of our
infrastructure which is wrapping the actual VirtualMachineInstance
process.</p>
<p>In order to increase the VMI density on the node, it is possible to not
request the additional overhead by setting
<code>spec.domain.resources.overcommitGuestOverhead</code> to <code>true</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="go">    apiVersion: kubevirt.io/v1</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="go">    kind: VirtualMachineInstance</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">    metadata:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">      name: testvmi-nocloud</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">    spec:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">      terminationGracePeriodSeconds: 30</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go">      domain:</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">        resources:</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go">          overcommitGuestOverhead: true</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="go">          requests:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="go">            memory: 1024M</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="go">    [...]</span>
</code></pre></div>
<p>This will work fine for as long as most of the VirtualMachineInstances
will not request the whole memory. That is especially the case if you
have short-lived VMIs. But if you have long-lived
VirtualMachineInstances or do extremely memory intensive tasks inside
the VirtualMachineInstance, your VMIs will use all memory they are
granted sooner or later.</p>
<h2 id="overcommit-guest-memory">Overcommit Guest Memory<a class="headerlink" href="#overcommit-guest-memory" title="Permanent link">&para;</a></h2>
<p>The third option is real memory overcommit on the VMI. In this scenario
the VMI is explicitly told that it has more memory available than what
is requested from the cluster by setting <code>spec.domain.memory.guest</code> to a
value higher than <code>spec.domain.resources.requests.memory</code>.</p>
<p>The following definition requests <code>1024MB</code> from the cluster but tells
the VMI that it has <code>2048MB</code> of memory available:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="go">    apiVersion: kubevirt.io/v1alpha3</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="go">    kind: VirtualMachineInstance</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="go">    metadata:</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="go">      name: testvmi-nocloud</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="go">    spec:</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="go">      terminationGracePeriodSeconds: 30</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="go">      domain:</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="go">        resources:</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="go">          overcommitGuestOverhead: true</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="go">          requests:</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="go">            memory: 1024M</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="go">        memory:</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="go">          guest: 2048M</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="go">    [...]</span>
</code></pre></div>
<p>For as long as there is enough free memory available on the node, the
VMI can happily consume up to <code>2048MB</code>. This VMI will get the
<code>Burstable</code> resource class assigned by Kubernetes (See <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/#create-a-pod-that-gets-assigned-a-qos-class-of-burstable">QoS classes in
Kubernetes</a>
for more details). The same eviction rules like for Pods apply to the
VMI in case the node gets under memory pressure.</p>
<p>Implicit memory overcommit is disabled by default. This means that when
memory request is not specified, it is set to match
<code>spec.domain.memory.guest</code>. However, it can be enabled using
<code>spec.configuration.developerConfiguration.memoryOvercommit</code> in the <code>kubevirt</code> CR. For example, by setting
<code>memoryOvercommit: "150"</code> we define that when memory request is not
explicitly set, it will be implicitly set to achieve memory overcommit
of 150%. For instance, when <code>spec.domain.memory.guest: 3072M</code>, memory
request is set to 2048M, if omitted. Note that the actual memory request
depends on additional configuration options like
OvercommitGuestOverhead.</p>
<h2 id="configuring-the-memory-pressure-behavior-of-nodes">Configuring the memory pressure behavior of nodes<a class="headerlink" href="#configuring-the-memory-pressure-behavior-of-nodes" title="Permanent link">&para;</a></h2>
<p>If the node gets under memory pressure, depending on the <code>kubelet</code>
configuration the virtual machines may get killed by the OOM handler or
by the <code>kubelet</code> itself. It is possible to tweak that behaviour based on
the requirements of your VirtualMachineInstances by:</p>
<ul>
<li>Configuring <a href="https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/#soft-eviction-thresholds">Soft Eviction
    Thresholds</a></li>
<li>Configuring <a href="https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/#hard-eviction-thresholds">Hard Eviction
    Thresholds</a></li>
<li>Requesting the right QoS class for VirtualMachineInstances</li>
<li>Setting <code>--system-reserved</code> and <code>--kubelet-reserved</code></li>
<li>Enabling KSM</li>
<li>Enabling swap</li>
</ul>
<h3 id="configuring-soft-eviction-thresholds">Configuring Soft Eviction Thresholds<a class="headerlink" href="#configuring-soft-eviction-thresholds" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Note: Soft Eviction will effectively shutdown VirtualMachineInstances.
They are not paused, hibernated or migrated. Further, Soft Eviction is
disabled by default.</p>
</blockquote>
<p>If configured, VirtualMachineInstances get evicted once the available
memory falls below the threshold specified via <code>--eviction-soft</code> and the
VirtualmachineInstance is given the chance to perform a shutdown of the
VMI within a timespan specified via <code>--eviction-max-pod-grace-period</code>.
The flag <code>--eviction-soft-grace-period</code> specifies for how long a soft
eviction condition must be held before soft evictions are triggered.</p>
<p>If set properly according to the demands of the VMIs, overcommitting
should only lead to soft evictions in rare cases for some VMIs. They may
even get re-scheduled to the same node with less initial memory demand.
For some workload types, this can be perfectly fine and lead to better
overall memory-utilization.</p>
<h3 id="configuring-hard-eviction-thresholds">Configuring Hard Eviction Thresholds<a class="headerlink" href="#configuring-hard-eviction-thresholds" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Note: If unspecified, the kubelet will do hard evictions for Pods once
<code>memory.available</code> falls below <code>100Mi</code>.</p>
</blockquote>
<p>Limits set via <code>--eviction-hard</code> will lead to immediate eviction of
VirtualMachineInstances or Pods. This stops VMIs without a grace period
and is comparable with power-loss on a real computer.</p>
<p>If the hard limit is hit, VMIs may from time to time simply be killed.
They may be re-scheduled to the same node immediately again, since they
start with less memory consumption again. This can be a simple option,
if the memory threshold is only very seldom hit and the work performed
by the VMIs is reproducible or it can be resumed from some checkpoints.</p>
<h2 id="requesting-the-right-qos-class-for-virtualmachineinstances">Requesting the right QoS Class for VirtualMachineInstances<a class="headerlink" href="#requesting-the-right-qos-class-for-virtualmachineinstances" title="Permanent link">&para;</a></h2>
<p>Different QoS classes get <a href="https://kubernetes.io/docs/tasks/administer-cluster/cpu-management-policies/#static-policy">assigned to Pods and
VirtualMachineInstances</a>
based on the <code>requests.memory</code> and <code>limits.memory</code>. KubeVirt right now
supports the QoS classes <code>Burstable</code> and <code>Guaranteed</code>. <code>Burstable</code> VMIs
are evicted before <code>Guaranteed</code> VMIs.</p>
<p>This allows creating two classes of VMIs:</p>
<ul>
<li>One type can have equal <code>requests.memory</code> and <code>limits.memory</code> set
    and therefore gets the <code>Guaranteed</code> class assigned. This one will
    not get evicted and should never run into memory issues, but is more
    demanding.</li>
<li>One type can have no <code>limits.memory</code> or a <code>limits.memory</code> which is
    greater than <code>requests.memory</code> and therefore gets the <code>Burstable</code>
    class assigned. These VMIs will be evicted first.</li>
</ul>
<h2 id="setting-system-reserved-and-kubelet-reserved">Setting <code>--system-reserved</code> and <code>--kubelet-reserved</code><a class="headerlink" href="#setting-system-reserved-and-kubelet-reserved" title="Permanent link">&para;</a></h2>
<p>It may be important to reserve some memory for other daemons (not DaemonSets)
which are running on the same node (ssh, dhcp servers, etc). The reservation
can be done with the <code>--system reserved</code> switch. Further for the Kubelet and
Docker a special flag called <code>--kubelet-reserved</code> exists.</p>
<h2 id="enabling-ksm">Enabling KSM<a class="headerlink" href="#enabling-ksm" title="Permanent link">&para;</a></h2>
<p>The <a href="https://www.linux-kvm.org/page/KSM">KSM</a> (Kernel same-page merging)
daemon can be started on the node. Depending on its tuning parameters it
can more or less aggressively try to merge identical pages between
applications and VirtualMachineInstances. The more aggressive it is
configured the more CPU it will use itself, so the memory overcommit
advantages comes with a slight CPU performance hit.</p>
<p>Config file tuning allows changes to scanning frequency (how often will
KSM activate) and aggressiveness (how many pages per second will it
scan).</p>
<h2 id="enabling-swap">Enabling Swap<a class="headerlink" href="#enabling-swap" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Note: This will definitely make sure that your VirtualMachines can't
crash or get evicted from the node but it comes with the cost of
pretty unpredictable performance once the node runs out of memory and
the kubelet may not detect that it should evict Pods to increase the
performance again.</p>
</blockquote>
<p>Enabling swap is in general <a href="https://github.com/kubernetes/kubernetes/issues/53533">not
recommended</a> on
Kubernetes right now. However, it can be useful in combination with KSM,
since KSM merges identical pages over time. Swap allows the VMIs to
successfully allocate memory which will then effectively never be used
because of the later de-duplication done by KSM.</p>
<h1 id="node-cpu-allocation-ratio">Node CPU allocation ratio<a class="headerlink" href="#node-cpu-allocation-ratio" title="Permanent link">&para;</a></h1>
<p>KubeVirt runs Virtual Machines in a Kubernetes Pod. This pod requests a certain
amount of CPU time from the host. On the other hand, the Virtual Machine is
being created with a certain amount of vCPUs. The number of vCPUs may not
necessarily correlate to the number of requested CPUs by the POD. 
Depending on the <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/">QOS</a> of the POD, vCPUs can be scheduled on a variable amount
of physical CPUs; this depends on the available CPU resources on a node. When
there are fewer available CPUs on the node as the requested vCPU, vCPU will be
over committed.</p>
<p>By default, each pod requests 100mil of CPU time. The CPU requested on the pod
sets the cgroups cpu.shares which serves as a priority for the scheduler to
provide CPU time for vCPUs in this POD.
As the number of vCPUs increases, this will reduce the amount of CPU time each
vCPU may get when competing with other processes on the node or other Virtual
Machine Instances with a lower amount of vCPUs.</p>
<p>The <code>cpuAllocationRatio</code> comes to normalize the amount of CPU time the POD will
request based on the number of vCPUs.
For example, POD CPU request = number of vCPUs * 1/cpuAllocationRatio
When cpuAllocationRatio is set to 1, a full amount of vCPUs will be requested
for the POD.</p>
<blockquote>
<p>Note: In Kubernetes, one full core is 1000 of CPU time
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/">More Information</a></p>
</blockquote>
<p>Administrators can change this ratio by updating the KubeVirt CR</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>...
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    spec:
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>      configuration:
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        developerConfiguration:
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>          cpuAllocationRatio: 10
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../node_maintenance/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Node maintenance" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Node maintenance
              </div>
            </div>
          </a>
        
        
          
          <a href="../unresponsive_nodes/" class="md-footer__link md-footer__link--next" aria-label="Next: Unresponsive nodes" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Unresponsive nodes
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.footer", "content.action.view", "content.action.edit"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>