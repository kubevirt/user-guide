<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://kubevirt.io/docs/operations/node_assignment/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Node assignment - KubeVirt User-Guide</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Node assignment";
    var mkdocs_page_input_path = "operations/node_assignment.md";
    var mkdocs_page_url = "/docs/operations/node_assignment/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> KubeVirt User-Guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Welcome</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Operations</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../updating_and_deletion/">Updating and deletion</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../basic_use/">Basic use</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../api_validation/">API Validation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../virtctl_client_tool/">virtctl Client Tool</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../live_migration/">Live Migration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../hugepages/">Hugepages support</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../component_monitoring/">Component monitoring</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../authorization/">Authorization</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../annotations_and_labels/">Annotations and labels</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Node assignment</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#nodeselector">nodeSelector</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#affinity-and-anti-affinity">Affinity and anti-affinity</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#taints-and-tolerations">Taints and Tolerations</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../node_maintenance/">Node maintenance</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../node_overcommit/">Node overcommit</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../unresponsive_nodes/">Unresponsive nodes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../virtualmachineinstance_node_eviction/">VirtualMachineInstance Node Eviction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../vmctl/">Vmctl</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../containerized_data_importer/">Containerized Data Importer</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Virtual machines</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/virtual_machine_instances/">Virtual Machines Instances</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/lifecycle/">Lifecycle</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/run_strategies/">Run Strategies</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/presets/">Presets</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/virtual_hardware/">Virtual hardware</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/dedicated_cpu_resources/">Dedicated CPU resources</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/disks_and_volumes/">Disks and Volumes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/interfaces_and_networks/">Interfaces and Networks</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/networkpolicy/">NetworkPolicy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/windows_wirtio_drivers/">Windows virtio drivers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/guest_operating_system_information/">Guest Operating System Information</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/guest_agent_information/">Guest Agent information</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/liveness_and_readiness_probes/">Liveness and Readiness Probes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/graphical_and_console_access/">Graphical and Serial Console Access</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/startup_scripts/">Startup Scripts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/service_objects/">Service object</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/templates/">Templates</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/replicaset/">VirtualMachineInstanceReplicaSet</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../virtual_machines/dns/">DNS records</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../web_console/">Web Console</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Appendix</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../appendix/contributing/">Contributing</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">KubeVirt User-Guide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Operations &raquo;</li>
        
      
    
    <li>Node assignment</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/kubevirt/user-guide/edit/master/docs/operations/node_assignment.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="node-assignment">Node assignment<a class="headerlink" href="#node-assignment" title="Permanent link">&para;</a></h1>
<p>You can constrain the VM to only run on specific nodes or to prefer
running on specific nodes:</p>
<ul>
<li><strong>nodeSelector</strong></li>
<li><strong>Affinity and anti-affinity</strong></li>
<li><strong>Taints and Tolerations</strong></li>
</ul>
<h2 id="nodeselector">nodeSelector<a class="headerlink" href="#nodeselector" title="Permanent link">&para;</a></h2>
<p>Setting <code>spec.nodeSelector</code> requirements, constrains the scheduler to
only schedule VMs on nodes, which contain the specified labels. In the
following example the vmi contains the labels <code>cpu: slow</code> and
<code>storage: fast</code>:</p>
<pre><code>metadata:
  name: testvmi-ephemeral
apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachineInstance
spec:
  nodeSelector:
    cpu: slow
    storage: fast
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mypvcdisk
        lun: {}
  volumes:
    - name: mypvcdisk
      persistentVolumeClaim:
        claimName: mypvc
</code></pre>
<p>Thus the scheduler will only schedule the vmi to nodes which contain
these labels in their metadata. It works exactly like the Pods
<code>nodeSelector</code>. See the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector">Pod nodeSelector
Documentation</a>
for more examples.</p>
<h2 id="affinity-and-anti-affinity">Affinity and anti-affinity<a class="headerlink" href="#affinity-and-anti-affinity" title="Permanent link">&para;</a></h2>
<p>The <code>spec.affinity</code> field allows specifying hard- and soft-affinity for
VMs. It is possible to write matching rules agains workloads (VMs and
Pods) and Nodes. Since VMs are a workload type based on Pods,
Pod-affinity affects VMs as well.</p>
<p>An example for <code>podAffinity</code> and <code>podAntiAffinity</code> may look like this:</p>
<pre><code>metadata:
  name: testvmi-ephemeral
apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachineInstance
spec:
  nodeSelector:
    cpu: slow
    storage: fast
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mypvcdisk
        lun: {}
  affinity:
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: security
            operator: In
            values:
            - S1
        topologyKey: failure-domain.beta.kubernetes.io/zone
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: security
              operator: In
              values:
              - S2
          topologyKey: kubernetes.io/hostname
  volumes:
    - name: mypvcdisk
      persistentVolumeClaim:
        claimName: mypvc
</code></pre>
<p>Affinity and anti-affinity works exactly like the Pods <code>affinity</code>. This
includes <code>podAffinity</code>, <code>podAntiAffinity</code>, <code>nodeAffinity</code> and
<code>nodeAntiAffinity</code>. See the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity">Pod affinity and anti-affinity
Documentation</a>
for more examples and details.</p>
<h2 id="taints-and-tolerations">Taints and Tolerations<a class="headerlink" href="#taints-and-tolerations" title="Permanent link">&para;</a></h2>
<p>Affinity as described above, is a property of VMs that attracts them to
a set of nodes (either as a preference or a hard requirement). Taints
are the opposite â€“ they allow a node to repel a set of VMs.</p>
<p>Taints and tolerations work together to ensure that VMs are not
scheduled onto inappropriate nodes. One or more taints are applied to a
node; this marks that the node should not accept any VMs that do not
tolerate the taints. Tolerations are applied to VMs, and allow (but do
not require) the VMs to schedule onto nodes with matching taints.</p>
<p>You add a taint to a node using kubectl taint. For example,</p>
<pre><code>kubectl taint nodes node1 key=value:NoSchedule
</code></pre>
<p>An example for <code>tolerations</code> may look like this:</p>
<pre><code>metadata:
  name: testvmi-ephemeral
apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachineInstance
spec:
  nodeSelector:
    cpu: slow
    storage: fast
  domain:
    resources:
      requests:
        memory: 64M
    devices:
      disks:
      - name: mypvcdisk
        lun: {}
  tolerations:
  - key: "key"
    operator: "Equal"
    value: "value"
    effect: "NoSchedule"
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../node_maintenance/" class="btn btn-neutral float-right" title="Node maintenance">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../annotations_and_labels/" class="btn btn-neutral" title="Annotations and labels"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/kubevirt/user-guide/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../annotations_and_labels/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../node_maintenance/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
